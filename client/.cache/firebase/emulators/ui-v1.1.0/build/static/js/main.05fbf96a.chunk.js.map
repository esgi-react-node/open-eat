{"version":3,"sources":["store/database/index.ts","store/logviewer/actions.ts","store/config/index.ts","store/logviewer/index.ts","components/Firestore/Collection.module.scss","components/Home/StatusLabel.module.scss","store/config/reducer.ts","store/config/sagas.ts","store/database/reducer.ts","store/database/sagas.ts","store/logviewer/reducer.ts","components/Database/DataViewer/ImportDialog.module.scss","store/utils.ts","store/index.ts","components/common/icons.tsx","components/common/EmulatorDisabled.tsx","components/common/Spinner.tsx","firebase.ts","components/common/BreadCrumbs.tsx","components/common/CardActionBar.tsx","colors.tsx","components/common/InteractiveBreadCrumbBar.tsx","components/common/rest_api.ts","components/Database/api.ts","themes.tsx","components/Database/DataViewer/common/view_model.ts","components/common/Callout.tsx","components/common/Field.tsx","components/common/FileField.tsx","components/Database/DataViewer/ImportDialog.tsx","components/Database/DataViewer/common/fetch.ts","components/Firestore/models.ts","components/Firestore/ApiContext.tsx","components/Firestore/utils.ts","components/Firestore/DocumentEditor/actions.ts","components/Firestore/DocumentEditor/BooleanEditor.tsx","components/Firestore/DocumentEditor/GeoPointEditor.tsx","components/Firestore/DocumentEditor/JsonEditor.tsx","components/Firestore/DocumentEditor/NumberEditor.tsx","components/Firestore/DocumentEditor/types.ts","components/Firestore/DocumentEditor/ReferenceEditor.tsx","components/Firestore/DocumentEditor/utils.ts","components/Firestore/DocumentEditor/store.tsx","components/Firestore/DocumentEditor/StringEditor.tsx","components/Firestore/DocumentEditor/TimestampEditor.tsx","components/Firestore/DocumentEditor/index.tsx","components/Firestore/DocumentPreview/InlineEditor.tsx","components/Database/DataViewer/NodeLink.tsx","components/Database/DataViewer/ValueDisplay.tsx","components/Database/DataViewer/NodeLeaf.tsx","components/Database/DataViewer/CloneDialog.tsx","components/Database/DataViewer/InlineQuery.tsx","components/Database/DataViewer/RenameDialog.tsx","components/Database/DataViewer/NodeTabularDisplay.tsx","components/Database/DataViewer/NodeActions.tsx","components/Database/DataViewer/NodeParent.tsx","components/Database/DataViewer/NodeContainer.tsx","components/Database/Database.tsx","store/database/selectors.ts","components/Database/DatabasePicker.tsx","components/Database/DatabaseContainer.tsx","components/Database/index.tsx","components/Firestore/api.tsx","components/common/DialogQueue.tsx","components/Firestore/dialogs/clearAll.tsx","components/Firestore/actions.tsx","components/Firestore/store.tsx","components/Firestore/CollectionFilter/ConditionEntry.tsx","components/Firestore/CollectionFilter/ConditionEntries.tsx","components/Firestore/CollectionFilter/SortRadioGroup.tsx","components/Firestore/CollectionFilter/CollectionFilter.tsx","components/Firestore/dialogs/AddDocumentDialog.tsx","components/Firestore/PanelHeader.tsx","components/Firestore/useAutoSelect.tsx","components/Firestore/Collection.tsx","components/Firestore/dialogs/AddCollectionDialog.tsx","components/Firestore/CollectionList.tsx","components/Firestore/dialogs/deleteDocument.tsx","components/Firestore/dialogs/deleteDocumentFields.tsx","components/Firestore/DocumentPreview/api.tsx","components/Firestore/DocumentPreview/store.tsx","components/Firestore/DocumentPreview/FieldPreview.tsx","components/LogViewer/HighlightedJSON.tsx","components/Firestore/DocumentPreview/index.tsx","components/Firestore/Document.tsx","components/Firestore/index.tsx","components/Home/LocalWarningCallout.tsx","components/common/constants.ts","components/Home/StatusLabel.tsx","components/Home/index.tsx","components/LogViewer/CompiledGetterCache.ts","components/LogViewer/QueryBar.tsx","components/LogViewer/ReconnectingWebSocket.ts","components/LogViewer/History.tsx","components/LogViewer/index.tsx","routes.ts","components/common/Logo.tsx","components/App/AppBar.tsx","components/App/AppDisconnected.tsx","components/App/index.tsx","index.tsx","configureStore.ts","components/Firestore/CollectionFilter/CollectionFilter.module.scss","store/database/actions.ts","store/config/selectors.ts","store/config/actions.ts"],"names":["logReceived","createAction","logReset","module","exports","configReducer","createReducer","loading","handleAction","fetchRequest","state","produce","draft","fetchSuccess","payload","replaceIfChanged","data","fetchError","error","fetchConfig","pollConfig","configSaga","fetchConfigApi","a","fetch","res","status","Error","statusText","json","_","call","config","put","message","delay","all","takeLatest","getType","subscribe","databaseReducer","databases","databasesSubscribed","databasesFetchRequest","databasesFetchSuccess","sort","db1","db2","name","localeCompare","databasesFetchError","databasesSubscribe","databasesUnsubscribe","getDbConfig","fetchDatabases","pollDatabases","databaseSaga","fetchDatabasesApi","projectId","hostAndPort","getProjectIdAndDbConfig","createSelector","getProjectIdResult","getDatabaseConfigResult","combineData","select","result","hasError","getDatabasesSubscribed","database","take","logReducer","history","hasData","undefined","map","dataMapper","results","handle","mappers","onNone","onError","onData","squash","remoteResult","parent","key","newValue","oldValue","isDraft","original","deepEquals","rootSaga","fork","rootReducer","combineReducers","log","createStructuredSelector","selectors","reselect","FirestoreIcon","svgIcon","xmlns","viewBox","fill","d","fillRule","DatabaseIcon","FunctionsIcon","HostingIcon","PubSubIcon","cx","cy","r","DatabaseCircleIcon","clipRule","stroke","strokeOpacity","HintIcon","svgElement","size","props","icon","strategy","EmulatorDisabled","productName","desktop","tablet","phone","span","align","className","src","alt","use","tag","href","Spinner","cover","scrim","children","classnames","initDatabase","namespace","databaseURL","app","firebase","Math","random","applyAdminAuth","db","window","console","cleanup","delete","mockAuthComponent","Component","getToken","accessToken","getUid","addAuthTokenListener","listener","removeAuthTokenListener","_addOrOverwriteComponent","EMPTY_KEYS","BreadCrumbs","base","path","onEdit","normalizedPath","startsWith","substr","keys","split","hrefs","reduce","acc","prevLink","length","push","role","Link","to","i","aria-label","onClick","CardActionBar","options","surface","CardActionBarActions","style","flex","InteractiveBreadCrumbBar","onNavigate","inputPrefix","breadCrumbProps","useState","isEditing","setIsEditing","value","setValue","useEffect","handleCancel","inputRef","useRef","useKey","eventTypes","target","when","useLayoutEffect","current","z","wrap","onSubmit","handleSubmit","theme","fullwidth","type","onChange","e","currentTarget","label","ResponseError","response","RestApi","url","method","this","body","JSON","stringify","headers","Authorization","text","file","toFormData","append","formData","FormData","DatabaseApi","baseUrl","ref","params","URLSearchParams","ns","getUploadPath","toString","postFile","URL","pathname","replace","Type","tipTheme","background","primary","primaryRgb","textIconOnBackground","textPrimaryOnBackground","textSecondaryOnBackground","successTheme","noteTheme","cautionTheme","onPrimary","errorTheme","ChildrenDisplayType","THEME_MAP","CAUTION","NOTE","SUCCESS","TIP","WARNING","CustomThemeProvider","DEFAULT_ICON_MAP","Callout","actions","aside","iconName","asideClass","classes","aria-hidden","Field","fieldClassName","tip","outlined","textFieldProps","randomId","id","htmlFor","invalid","SelectField","selectProps","FileField","onFiles","accept","useDropzone","onDrop","isDragActive","getRootProps","getInputProps","isDragReject","data-testid","ImportDialog","api","reference","onComplete","droppedFile","setFile","isImporting","setIsImporting","setError","preventDefault","importFile","renderToPortal","open","onClose","styles","container","disabled","required","files","action","unelevated","DEFAULT_QUERY_PARAMS","limit","jsonIshValue","parse","getDbRootUrl","NO_CHILDREN","ADMIN_AUTH_HEADERS","createViewModel","canDoRealtime$","query","ReplaySubject","next","viewModel$","pipe","switchMap","queryParams","concatMap","realtime","from","once","snap","hasChildren","toObservable","applyQuery","val","Object","isRealtime","isLoading","realtimeToViewModel","realtimeRef","operator","orderBy","limitToFirst","equalTo","endAt","startAt","getRestQueryParams","shallow","restUrl","defer","fetchNonRealtime","nonRealtimeToViewModel","Observable","o","handler","on","snapshot","off","orderByChild","rootUrl","indexOf","entries","filter","encodeURIComponent","join","FieldType","ApiContext","createContext","ApiProvider","Provider","useApi","useContext","isSingleValueCollectionFilter","cf","isMultiValueCollectionFilter","isSortableCollectionFilter","NUMBER_REGEX","getParentPath","slice","lastFieldName","getFieldType","NULL","firestore","Timestamp","TIMESTAMP","Array","ARRAY","DocumentReference","REFERENCE","GeoPoint","GEOPOINT","Blob","BLOB","MAP","isBoolean","isNumber","isMap","isArray","isPrimitive","withFieldSet","get","Number","withFieldRemoved","splice","addToMap","addToArray","removeFromMap","removeFromArray","updateName","updateType","updateValue","BooleanEditor","GeoPointEditor","String","latitude","setLatitude","longitude","setLongitude","useFormContext","errors","touched","formState","register","unregister","latitudeName","longitudeName","min","max","lat","long","geoPoint","step","defaultValue","JsonEditor","initialValue","triggerValidation","validate","handleChange","NumberEditor","parseFloat","pattern","DocumentPath","isFirestoreMap","isFirestoreArray","isNativePrimitive","isMapField","field","isArrayField","isJSONField","assertStoreHasRoot","store","uuid","assertIsMapField","assertIsArrayField","ReferenceEditor","doc","getUniqueId","normalize","mapChildren","fields","child","valueId","normalizeMap","arrayChildren","normalizeArray","normalizePrimitive","defaultValueForPrimitiveType","BOOLEAN","NUMBER","STRING","fromDate","Date","getDescendantIds","ids","c","documentStoreContext","React","dispatch","reducer","normalized","find","childId","childField","isJson","assertIsPrimitiveField","storeReducer","handlers","DocumentStore","useDocumentStore","context","useStore","useDispatch","useField","StringEditor","dateToLocale","date","year","getFullYear","month","getMonth","padStart","dateOfMonth","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","TimestampEditor","toDate","setDate","isNaN","toMillis","getTime","timestamp","FIRESTORE_FIELD_TYPES","FIRESTORE_ARRAY_FIELD_TYPES","ft","RTDB_FIELD_TYPES","supportedFieldTypeSet","Set","FieldEditor","isRtdb","areNamesMutable","areFieldsMutable","startingIndex","supportNestedArrays","allowedChildTypes","readonly","allowedTypes","index","valueEditor","isGeoPoint","isTimestamp","ChildTypeSelect","getDocumentFieldType","NameEditor","clearError","formName","siblingNames","useMemo","isUnique","every","DocumentEditor","areRootNamesMutable","areRootFieldsMutable","rtdb","initialState","useReducer","methods","useForm","mode","denormalizedStore","denormalize","curr","errorCount","InlineEditor","onCancel","onSave","areRootKeysMutable","internalValue","setInternalValue","onClickOutside","onEscapeKey","stopPropagation","values","NodeLink","dbRef","absolutePath","match","useRouteMatch","withoutPath","matchPath","strict","useHrefWithinSameRoute","ValueDisplay","otherProps","trimmedValue","getClass","NodeLeaf","isAdding","setIsAdding","handleEdit","handleEditSuccess","set","handleAddSuccess","handleDelete","remove","showAddButton","content","getAbsoluteRefPath","CloneDialog","ok","hasQuery","originalKey","newDestinationPath","setNewDestinationPath","form","setForm","setIsLoading","isCloningWithFiltered","setCloningFiltered","forEach","loadData","updateField","root","checked","event","placeholder","InlineQuery","setValues","keyInputRef","valueInputRef","focus","toParams","onKeyDown","keyCode","keycode","danger","TableType","RenameDialog","isOpen","newKey","update","getNextDisplayType","Table","TreeView","getToggleIcon","ACTIVE_ICON","color","NodeActions","displayType","onDisplayTypeChange","updateQuery","onExpandRequested","isMenuOpen","setMenuOpen","showQueryUi","setShowQueryUi","cloneDialogIsOpen","setCloneDialogIsOpen","renameDialogIsOpen","setRenameDialogIsOpen","isActive","isRoot","pushId","removeNode","potentialQuery","onIcon","onOpen","NodeTabularDisplay","hasMoreRows","onLoadMore","rows","table","setTable","buildTable","header","row","idx","colIndex","pkId","KeyValue","getColumnValue","colSpan","getTableType","getHeaders","parseInt","KeyObject","NodeParent","isViewRoot","isExpanded","setIsExpanded","setDisplayType","hasMore","loadMore","currentPageSize","toggleExpansion","useCallback","NodeContainer","viewModel","setViewModel","querySubject","setQuerySubject","silent","print","timeout","mapTo","catchError","of","shareReplay","bufferSize","refCount","canDoRealtime","sub","vm","unsubscribe","setQueryParams","q","getPrefix","substring","Database","setRef","setApi","useHistory","importDialogOpen","setImportDialogOpen","setDroppedFile","urlBase","newPath","f","DatabaseDropZone","noClick","isDragAccept","getDatabaseNames","DatabaseListItem","navigation","activated","DatabasePicker","secondaryDbs","pickerClassName","mapStateToProps","connect","dbs","setDbs","hasNewDbs","projectIdResult","configResult","DatabaseRouteContent","exact","render","dbPath","DatabaseRouteDisabled","databaseId","baseEmulatorUrl","settings","host","ssl","initFirestore","jsonRequest","collectionIds","collection","docRef","encodedPath","getSubCollections","getRootCollections","createDialogQueue","dialogs","confirm","alert","promptClearAll","prompt","title","acceptLabel","cancelLabel","footer","isDefaultAction","addCollectionFilter","removeCollectionFilter","INIT_STATE","collectionFilters","firestoreStoreContext","FirestoreStore","initState","useFirestoreStore","useCollectionFilter","ConditionEntry","memo","watch","getConditionEntryType","fieldType","setFieldType","conditionEntry","evt","conditionEntryType","as","conditionEntryValue","rules","BooleanCondition","selectValue","ConditionEntries","useFieldArray","conditionEntries","conditionName","removeFilter","hidden","SortRadioGroup","CollectionFilter","collectionFilter","formMethods","defaultValues","nest","preview","defaultOpen","isValid","CollectionFilterTheme","ConditionPreview","Preview","collectionId","pop","previewFilter","ConditionSelect","FilterItem","expanded","setExpanded","listItem","headerTitle","metaIcon","AddDocumentStep","collectionRef","setId","setData","getValue","invalidData","AddDocumentDialog","onValue","dialogProps","document","setDocument","detail","PanelHeader","useAutoSelect","list","useLocation","autoSelect","setAutoSelect","isRootOrRootCollection","hasNothingSelected","firstChild","NO_DOCS","Presentation","Step","Collection","addDocument","docs","isFilterOpen","setIsFilterOpen","isAddDocumentDialogOpen","setAddDocumentDialogOpen","badge","dense","Button","NavLink","activeClassName","newDocumentId","setNewDocumentId","filteredCollection","where","applyCollectionFilter","useCollection","collectionSnapshot","redirectIfAutoSelectable","AddCollectionStep","documentRef","AddCollectionDialog","COLLECTION","setStep","setCollectionId","DOCUMENT","CollectionList","restCollections","collections","setCollections","getCollections","fetchCollections","useCollections","isAddCollectionDialogOpen","setAddCollectionDialogOpen","addCollection","newCollection","coll","promptDeleteDocument","promptDeleteDocumentFields","DELETE_FIELD","FieldValue","documentData","adjustPayloadForArray","addFieldToMissingDocument","exists","fieldPath","cur","parentPath","pathToUpdate","FieldPath","childPath","isEqual","DocumentStateContext","DocumentProvider","useDocumentState","useFieldState","documentState","summarize","maxLen","array","output","element","summarizeArray","summarizeMap","base64","toBase64","abs","FieldPreview","HierarchyReferenceMode","maxSummaryLen","parentState","isAddingField","setIsAddingField","childFields","childLeaf","has","deleteField","DocumentPreview","useDocumentData","Doc","collectionById","Root","Document","handleDeleteDocument","handleDeleteFields","getFirestoreConfigResult","Firestore","location","isRefreshing","setIsRefreshing","showCollectionShell","showDocumentShell","nukeDocuments","handleNavigate","handleClearData","FirestoreRouteDisabled","LocalWarningCallout","useLocalStorage","writeStorage","INACTIVE_ICON","StatusLabel","configRemote","getConfig","Overview","linkTo","testId","functions","linkLabel","hosting","linkToExternal","pubsub","EmulatorCard","port","CompiledGetterCache","getters","obj","Function","err","warn","toHierarchyStep","DOT","BRACKET","toHierarchyJS","hierarchy","NONE","INCREMENT","HighlightedJSON","appendToQuery","compiledGetters","lines","isObject","pluck","getOrCompile","user","elements","line","quote_count","isStart","isEnd","endsWith","isKeylessArrayStart","trim","isKeylessObjStart","isKeyedObjStart","isLiteral","isObjEnd","isArrayStart","isArrayEnd","start","splat","indent","v","hierarchy_chain","new_indent","queryFields","parseQuery","escapedQuery","isEscaped","char","sections","t","filters","queryChunks","position","quoted_section","section","isKeyPair","pairKey","search","WebSocketState","QueryBar","setQuery","temporaryQuery","setTemporaryQuery","parsedQuery","spellCheck","FilterTag","tagButton","metadata","function","emulator","originalFieldPath","toLowerCase","fieldValue","isQueryMatch","messagesEndRef","scrollIntoView","formattedQueryLines","filtersToQueryString","segment","number","formatTimestamp","level","toUpperCase","getUserData","ReconnectingWebSocket","DISCONNECTED","interval","ws","setInterval","WebSocket","PENDING","onopen","CONNECTED","onclose","onmessage","msg","clearInterval","close","mapDispatchToProps","routes","component","Home","showInNav","logging","qs","useQuery","webSocket","Logo","width","height","x1","y1","x2","y2","gradientTransform","gradientUnits","offset","stopColor","stopOpacity","clipPath","opacity","fillOpacity","AppBar","navRoutes","tabs","activeTabIndex","findIndex","onSurface","fixed","preventOutsideDismiss","App","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","sagaMiddleware","createSagaMiddleware","createStore","applyMiddleware","run","configureStore","RouterWithInit","subscribeToConfig","ReactDOM","StrictMode","ripple","secondary","getElementById","getConfigResult"],"mappings":"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","file":"static/js/main.05fbf96a.chunk.js","sourcesContent":["/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './types';\nexport * from './actions';\nexport * from './reducer';\nexport * from './sagas';\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createAction } from 'typesafe-actions';\n\nimport { LogEntry } from './types';\n\nexport const logReceived = createAction('@log/RECEIVED')<LogEntry>();\n\n// TODO: Remove this hack once it's not needed.\nexport const logReset = createAction('@log/RESET')();\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './types';\nexport * from './actions';\nexport * from './reducer';\nexport * from './sagas';\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './types';\nexport * from './actions';\nexport * from './reducer';\n// export * from './sagas';\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"query-panel\":\"Collection_query-panel__1MziT\",\"badge\":\"Collection_badge__B5KHa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"StatusLabel_container__2Y6KW\",\"icon\":\"StatusLabel_icon__34nuE\"};","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport produce from 'immer';\nimport { Action, createReducer } from 'typesafe-actions';\n\nimport { replaceIfChanged } from '../utils';\nimport { fetchError, fetchRequest, fetchSuccess } from './actions';\nimport { ConfigState } from './types';\n\nexport const configReducer = createReducer<ConfigState, Action>({\n  loading: false,\n})\n  .handleAction(fetchRequest, state =>\n    produce(state, draft => {\n      draft.loading = true;\n    })\n  )\n  .handleAction(fetchSuccess, (state, { payload }) =>\n    produce(state, draft => {\n      draft.loading = false;\n      replaceIfChanged(draft, 'result', { data: payload });\n    })\n  )\n  .handleAction(fetchError, (state, { payload }) =>\n    produce(state, draft => {\n      draft.loading = false;\n      replaceIfChanged(draft, 'result', { error: payload });\n    })\n  );\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { all, call, delay, put, takeLatest } from 'redux-saga/effects';\nimport { ActionType, getType } from 'typesafe-actions';\n\nimport { fetchError, fetchRequest, fetchSuccess, subscribe } from './actions';\nimport { Config } from './types';\n\nexport async function fetchConfigApi(): Promise<Config> {\n  const res = await fetch('/api/config');\n  if (res.status !== 200) {\n    throw new Error(`HTTP ${res.status}: ${res.statusText}`);\n  }\n  return res.json();\n}\n\nexport function* fetchConfig(_: ActionType<typeof fetchRequest>) {\n  try {\n    const config: Config = yield call(fetchConfigApi);\n    yield put(fetchSuccess(config));\n  } catch (e) {\n    yield put(fetchError({ message: e.message }));\n  }\n}\n\nexport const POLL_COOLDOWN_MS = 5000;\n\n// TODO: Refactor subscription and polling logic into a common util.\nexport function* pollConfig() {\n  while (true) {\n    yield put(fetchRequest());\n    yield delay(POLL_COOLDOWN_MS);\n  }\n}\n\nexport function* configSaga() {\n  yield all([\n    takeLatest(getType(fetchRequest), fetchConfig),\n    takeLatest(getType(subscribe), pollConfig),\n  ]);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport produce from 'immer';\nimport { Action, createReducer } from 'typesafe-actions';\n\nimport { replaceIfChanged } from '../utils';\nimport {\n  databasesFetchError,\n  databasesFetchRequest,\n  databasesFetchSuccess,\n  databasesSubscribe,\n  databasesUnsubscribe,\n} from './actions';\nimport { DatabaseState } from './types';\n\nexport const databaseReducer = createReducer<DatabaseState, Action>({\n  databases: { loading: false },\n  databasesSubscribed: false,\n})\n  .handleAction(databasesFetchRequest, (state, _) =>\n    produce(state, draft => {\n      draft.databases.loading = true;\n    })\n  )\n  .handleAction(databasesFetchSuccess, (state, { payload }) => {\n    const databases = [...payload];\n    databases.sort((db1, db2) => db1.name.localeCompare(db2.name));\n    return produce(state, draft => {\n      draft.databases.loading = false;\n      replaceIfChanged(draft.databases, 'result', { data: databases });\n    });\n  })\n  .handleAction(databasesFetchError, (state, { payload }) =>\n    produce(state, draft => {\n      draft.databases.loading = false;\n      replaceIfChanged(draft.databases, 'result', { error: payload });\n    })\n  )\n  .handleAction(databasesSubscribe, state =>\n    produce(state, draft => {\n      draft.databasesSubscribed = true;\n    })\n  )\n  .handleAction(databasesUnsubscribe, state =>\n    produce(state, draft => {\n      draft.databasesSubscribed = false;\n    })\n  );\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  all,\n  call,\n  delay,\n  put,\n  select,\n  take,\n  takeLatest,\n} from 'redux-saga/effects';\nimport { createSelector } from 'reselect';\nimport { ActionType, getType } from 'typesafe-actions';\n\nimport { DatabaseConfig } from '../config';\nimport {\n  getDatabaseConfigResult,\n  getProjectIdResult,\n} from '../config/selectors';\nimport { combineData, hasError } from '../utils';\nimport {\n  databasesFetchError,\n  databasesFetchRequest,\n  databasesFetchSuccess,\n  databasesSubscribe,\n} from './actions';\nimport { DatabaseInfo } from './types';\nimport { AppState } from '..';\n\nexport async function fetchDatabasesApi(\n  config: DatabaseConfig,\n  projectId: string\n): Promise<DatabaseInfo[]> {\n  const res = await fetch(\n    `http://${config.hostAndPort}/.inspect/databases.json?ns=${projectId}`\n  );\n  if (res.status !== 200) {\n    throw new Error(`HTTP ${res.status}: ${res.statusText}`);\n  }\n  return res.json();\n}\n\nexport interface GetDbConfigReturn {\n  config: DatabaseConfig;\n  projectId: string;\n}\n\nconst getProjectIdAndDbConfig = createSelector(\n  getProjectIdResult,\n  getDatabaseConfigResult,\n  combineData\n);\n\ntype ProjectIdAndDbConfigResult = ReturnType<typeof getProjectIdAndDbConfig>;\n\nexport function* getDbConfig(): Generator<unknown, GetDbConfigReturn> {\n  const result = (yield select(\n    getProjectIdAndDbConfig\n  )) as ProjectIdAndDbConfigResult;\n  if (!result) {\n    throw new Error('Database emulator config is not ready yet.');\n  }\n  if (hasError(result)) {\n    throw new Error(\n      'Error fetching Database emulator config: ' + result.error.message\n    );\n  }\n  const [projectId, config] = result.data;\n  if (!config) {\n    throw new Error('Database emulator is not started!');\n  }\n  return { projectId, config };\n}\n\nexport function* fetchDatabases(\n  _: ActionType<typeof databasesFetchRequest>\n): Generator<any> {\n  try {\n    const { projectId, config } = (yield call(\n      getDbConfig\n    )) as GetDbConfigReturn;\n    const databases = (yield call(\n      fetchDatabasesApi,\n      config,\n      projectId\n    )) as DatabaseInfo[];\n    yield put(databasesFetchSuccess(databases));\n  } catch (e) {\n    yield put(databasesFetchError({ message: e.message }));\n  }\n}\n\nexport const POLL_DATABASE_COOLDOWN_MS = 5000;\nexport const getDatabasesSubscribed = (state: AppState) =>\n  state.database.databasesSubscribed;\n\nexport function* pollDatabases(): Generator<any> {\n  while (true) {\n    yield take(getType(databasesSubscribe));\n    while (yield select(getDatabasesSubscribed)) {\n      yield put(databasesFetchRequest());\n      yield delay(POLL_DATABASE_COOLDOWN_MS);\n    }\n  }\n}\n\nexport function* databaseSaga() {\n  yield all([\n    takeLatest(getType(databasesFetchRequest), fetchDatabases),\n    pollDatabases(),\n  ]);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Action, createReducer } from 'typesafe-actions';\n\nimport { logReceived, logReset } from './actions';\nimport { LogState } from './types';\n\nexport const logReducer = createReducer<LogState, Action>({\n  history: [],\n})\n  .handleAction(logReceived, (state: LogState, { payload }) => {\n    return { ...state, history: [...state.history, payload] };\n  })\n  .handleAction(logReset, (state: LogState) => {\n    return { ...state, history: [] };\n  });\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ImportDialog_container__3M_uy\"};","import { isDraft, original } from 'immer';\nimport deepEquals from 'lodash.isequal';\n\nexport interface ErrorInfo {\n  message: string;\n}\n\n/* Represents result of a task, either success (with data) or error. */\nexport type Result<T, E = ErrorInfo> = DataResult<T> | ErrorResult<E>;\nexport type DataResult<T> = { data: T };\nexport type ErrorResult<E> = { error: E };\n\n// Type helper to extract the type of T.data.\nexport type DataTypeOf<T extends Result<any, any>> = T extends Result<\n  infer D,\n  any\n>\n  ? D\n  : any;\n\nexport type DataTypeIfPresent<\n  T extends Result<any, any> | undefined\n> = T extends DataResult<infer D> ? D : never;\n\n// Type helper to extract the type of T.error.\nexport type ErrorTypeOf<T extends Result<any, any>> = T extends Result<\n  any,\n  infer E\n>\n  ? E\n  : any;\n\nexport type ErrorTypeIfPresent<\n  T extends Result<any, any> | undefined\n> = T extends ErrorResult<infer E> ? E : never;\n\nexport function hasData<T, E>(\n  result: Result<T, E> | undefined\n): result is DataResult<T> {\n  return result !== undefined && 'data' in result;\n}\nexport function hasError<T, E>(\n  result: Result<T, E> | undefined\n): result is ErrorResult<E> {\n  return result !== undefined && 'error' in result;\n}\n\n// Transform data if present or return error unchanged.\nexport function map<T, E, R>(\n  result: Result<T, E>,\n  dataMapper: (data: T) => R\n): Result<R, E>;\n\n// Transform data if present or return error / undefined unchanged.\nexport function map<T, E, R>(\n  result: Result<T, E> | undefined,\n  dataMapper: (data: T) => R\n): Result<R, E> | undefined;\n\n// (Implementation of overloaded function. Not exposed.)\nexport function map<T, E, R>(\n  result: Result<T, E> | undefined,\n  dataMapper: (data: T) => R\n): Result<R, E> | undefined {\n  if (result === undefined) return undefined;\n  return 'error' in result ? result : { data: dataMapper(result.data) };\n}\n\n// Represents a piece of remote info, which may be\n// - No info and not loading (initial)\n// - No info and loading (fetching)\n// - Has info and not loading (completed)\n// - Has info and loading (refreshing)\nexport type Remote<T> = { result?: T; loading: boolean };\n\nexport type RemoteResult<T, E = ErrorInfo> = Remote<Result<T, E>>;\n\n// Transform result.data if present or return result.error unchanged.\nexport function mapResult<T, E, R>(\n  remoteResult: RemoteResult<T, E>,\n  dataMapper: (data: T) => R\n): RemoteResult<R, E> {\n  return {\n    loading: remoteResult.loading,\n    result: map(remoteResult.result, dataMapper),\n  };\n}\n\nexport type DataTypeOfEach<\n  T extends ReadonlyArray<Result<any, any> | undefined>\n> = {\n  [P in keyof T]: T[P] extends Result<any, any> | undefined\n    ? DataTypeIfPresent<T[P]>\n    : T[P];\n};\n\n/**\n * Combine data of the remote results, or return first error encountered.\n *\n * If there are no errors but any result is undefined, return undefined.\n */\nexport function combineData<\n  Arr extends ReadonlyArray<Result<any, any> | undefined>\n>(\n  ...results: Arr\n): Result<DataTypeOfEach<Arr>, ErrorTypeIfPresent<Arr[number]>> | undefined {\n  for (const result of results) {\n    if (hasError(result)) {\n      return result;\n    }\n  }\n  for (const result of results) {\n    if (result === undefined) {\n      return undefined;\n    }\n  }\n\n  return {\n    data: (results.map(\n      result => (result as DataResult<unknown>).data\n    ) as unknown) as DataTypeOfEach<Arr>,\n  };\n}\n\n// Handle missing / data / error cases of a result and return a single value.\nexport function handle<T, E, R>(\n  result: Result<T, E> | undefined,\n  mappers: {\n    onNone: () => R;\n    onData: (data: T) => R;\n    onError: (error: E) => R;\n  }\n): R {\n  if (result === undefined) {\n    return mappers.onNone();\n  } else {\n    if (hasError(result)) {\n      return mappers.onError(result.error);\n    } else {\n      return mappers.onData(result.data);\n    }\n  }\n}\n\n// Handle all loading / data cases of a remote and return a single value.\nexport function squash<T, E, R>(\n  remoteResult: RemoteResult<T, E>,\n  mappers: {\n    onNone: (loading: boolean) => R;\n    onData: (data: T, loading: boolean) => R;\n    onError: (error: E, loading: boolean) => R;\n  }\n): R {\n  return handle(remoteResult.result, {\n    onNone: () => mappers.onNone(remoteResult.loading),\n    onData: data => mappers.onData(data, remoteResult.loading),\n    onError: error => mappers.onError(error, remoteResult.loading),\n  });\n}\n\n// Set parent[key] to newValue unless exising value is deeply equal.\n// Can be used to set an immer draft property to a nested external object.\nexport function replaceIfChanged<Parent, Key extends keyof Parent>(\n  parent: Parent,\n  key: Key,\n  newValue: Parent[Key]\n): void {\n  const oldValue = isDraft(parent) ? original(parent)![key] : parent[key];\n  if (!deepEquals(oldValue, newValue)) {\n    parent[key] = newValue;\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { combineReducers } from 'redux';\nimport { all, fork } from 'redux-saga/effects';\nimport * as reselect from 'reselect';\n\nimport { ConfigState, configReducer, configSaga } from './config';\nimport { DatabaseState, databaseReducer, databaseSaga } from './database';\nimport { LogState, logReducer } from './logviewer';\n\nexport interface AppState {\n  config: ConfigState;\n  database: DatabaseState;\n  log: LogState;\n}\n\nexport function* rootSaga() {\n  yield all([fork(configSaga), fork(databaseSaga)]);\n}\n\nexport const rootReducer = combineReducers<AppState>({\n  config: configReducer,\n  database: databaseReducer,\n  log: logReducer,\n});\n\nexport function createStructuredSelector<T>(\n  selectors: { [K in keyof T]: reselect.Selector<AppState, T[K]> }\n) {\n  return reselect.createStructuredSelector<AppState, T>(selectors);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon, IconProps } from '@rmwc/icon';\nimport { ComponentProps } from '@rmwc/types';\nimport React from 'react';\n\n// Firebase products from https://firebase.google.com/brand-guidelines?hl=en\n// To adapt those icons and make them work nicely, follow steps below:\n// 1. Copy and paste full SVG source code (including the <svg> element).\n//    Prefer files with suffix \"(7- Raw Icon, Dark).svg\".\n// 2. Remove width and height from <svg> and add viewBox=\"0 0 192 192\" to make\n//    the icon resizable. (Replace 192 with actual width and height values.)\n// 3. Change fill=\"#000\" etc. to fill=\"currentColor\" everywhere for theming.\n// 4. Change kabab-case-attrs to snakeCaseAttrs to keep React happy.\n\nexport const FirestoreIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 192 192\">\n    <g fill=\"none\">\n      <path d=\"M0 0h192v192H0z\" />\n      <path\n        d=\"M96 104l-72 32v-32l72-32 72 32v28-6 10zm0-88l72 32v32L96 48 24 80V48zm27 116l36 16-63 28v-32z\"\n        fill=\"currentColor\"\n        fillRule=\"evenodd\"\n      />\n    </g>\n  </svg>\n);\n\nexport const DatabaseIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 192 192\">\n    <g fill=\"none\">\n      <path d=\"M0 0h192v192H0z\" />\n      <path\n        d=\"M24 120h144v32.016c0 8.832-7.144 15.984-15.96 15.984H39.96C31.144 168 24 160.816 24 152.016zm0-80.064C24 31.136 31.144 24 39.96 24h112.08c8.816 0 15.96 7.2 15.96 15.936v56.128c0 8.8-7.144 15.936-15.96 15.936H39.96C31.144 112 24 104.8 24 96.064zM40 40h112v24H40zm0 44.04C40 81.8 41.712 80 44.04 80h7.92C54.2 80 56 81.712 56 84.04v7.92C56 94.2 54.288 96 51.96 96h-7.92C41.8 96 40 94.288 40 91.96zm0 56c0-2.24 1.712-4.04 4.04-4.04h7.92c2.24 0 4.04 1.712 4.04 4.04v7.92c0 2.24-1.712 4.04-4.04 4.04h-7.92c-2.24 0-4.04-1.712-4.04-4.04z\"\n        fill=\"currentColor\"\n        fillRule=\"evenodd\"\n      />\n    </g>\n  </svg>\n);\n\nexport const FunctionsIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 192 192\">\n    <g fill=\"none\">\n      <path d=\"M0 0h192v192H0z\" />\n      <path\n        d=\"M160.056 134.048v-76.08l-26.944-26.944 16.952-16.96L184 48v86.16l-.056.032v9.832l-33.904 33.912L133.112 161zm-128.112-.024l26.944 26.952-16.952 16.96L8 144V57.84l.056-.032v-9.832L41.96 14.064 58.888 31 31.944 57.952v76.08zm28.064-26c-6.647 0-12.036-5.389-12.036-12.036 0-6.647 5.389-12.036 12.036-12.036 6.645 0 12.032 5.387 12.032 12.032 0 6.645-5.387 12.032-12.032 12.032zm35.984 0c-6.647 0-12.036-5.389-12.036-12.036 0-6.647 5.389-12.036 12.036-12.036 6.645 0 12.032 5.387 12.032 12.032 0 6.645-5.387 12.032-12.032 12.032zm35.984 0c-6.647 0-12.036-5.389-12.036-12.036 0-6.647 5.389-12.036 12.036-12.036 6.645 0 12.032 5.387 12.032 12.032 0 6.645-5.387 12.032-12.032 12.032z\"\n        fill=\"currentColor\"\n        fillRule=\"evenodd\"\n      />\n    </g>\n  </svg>\n);\n\nexport const HostingIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 192 192\">\n    <path\n      d=\"M96 16c-44.16 0-80 35.84-80 80s35.84 80 80 80 80-35.84 80-80-35.84-80-80-80zm-8 143.44c-31.6-3.92-56-30.8-56-63.44 0-4.96.64-9.68 1.68-14.32L72 120v8c0 8.8 7.2 16 16 16zm55.2-20.32c-2.08-6.48-8-11.12-15.2-11.12h-8v-24c0-4.4-3.6-8-8-8H64V80h16c4.4 0 8-3.6 8-8V56h16c8.8 0 16-7.2 16-16v-3.28c23.44 9.52 40 32.48 40 59.28 0 16.64-6.4 31.76-16.8 43.12z\"\n      fillRule=\"evenodd\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const PubSubIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n    <g>\n      <path\n        d=\"M19.83,9.7a1.72,1.72,0,1,0-2.36-.63A1.73,1.73,0,0,0,19.83,9.7Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M4.17,9.7a1.72,1.72,0,1,0-.63-2.35A1.72,1.72,0,0,0,4.17,9.7Z\"\n        fill=\"currentColor\"\n      />\n      <circle cx=\"12\" cy=\"20.28\" r=\"1.72\" fill=\"currentColor\" />\n      <path\n        d=\"M20.06,14.36a2.19,2.19,0,0,0-2.46.19l-2.9-1.68a2.67,2.67,0,0,0,.08-.64,2.77,2.77,0,0,0-2-2.65V6.22a2.19,2.19,0,1,0-1.6,0V9.58a2.77,2.77,0,0,0-2,2.65,2.67,2.67,0,0,0,.08.64L6.4,14.55a2.2,2.2,0,1,0,.79,1.38l2.9-1.68a2.75,2.75,0,0,0,3.82,0l2.9,1.68a2.18,2.18,0,1,0,3.25-1.57Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n  </svg>\n);\n\n// Other icons below:\n\n// TODO: Re-implement outer circle using CSS and dedupe with DatabaseIcon.\nexport const DatabaseCircleIcon = svgIcon(\n  <svg viewBox=\"0 0 38 38\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M19 37C28.9411 37 37 28.9411 37 19C37 9.05887 28.9411 1 19 1C9.05887 1 1 9.05887 1 19C1 28.9411 9.05887 37 19 37Z\"\n      fill=\"white\"\n      stroke=\"black\"\n      strokeOpacity=\"0.12\"\n    />\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M10 22H28V26.002C28.0005 26.5315 27.7906 27.0396 27.4164 27.4143C27.0423 27.7891 26.5345 27.9997 26.005 28H11.995C10.8929 27.9978 10.0005 27.1041 10 26.002V22ZM10 11.992C10 10.892 10.893 10 11.995 10H26.005C27.107 10 28 10.9 28 11.992V19.008C28 20.108 27.107 21 26.005 21H11.995C10.893 21 10 20.1 10 19.008V11.992ZM12 12H26V15H12V12ZM12 17.505C12 17.225 12.214 17 12.505 17H13.495C13.775 17 14 17.214 14 17.505V18.495C14 18.775 13.786 19 13.495 19H12.505C12.3704 19.0022 12.2407 18.9497 12.1455 18.8545C12.0503 18.7593 11.9978 18.6296 12 18.495V17.505ZM12 24.505C12 24.225 12.214 24 12.505 24H13.495C13.775 24 14 24.214 14 24.505V25.495C14 25.775 13.786 26 13.495 26H12.505C12.3704 26.0022 12.2407 25.9497 12.1455 25.8545C12.0503 25.7593 11.9978 25.6296 12 25.495V24.505Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const HintIcon = svgIcon(\n  <svg viewBox=\"0 0 10 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n      d=\"M2.99998 13C2.99998 13.3667 3.29998 13.6667 3.66665 13.6667H6.33331C6.69998 13.6667 6.99998 13.3667 6.99998 13V12.3334H2.99998V13ZM4.99998 0.333374C2.42665 0.333374 0.333313 2.42671 0.333313 5.00004C0.333313 6.58671 1.12665 7.98004 2.33331 8.82671V10.3334C2.33331 10.7 2.63331 11 2.99998 11H6.99998C7.36665 11 7.66665 10.7 7.66665 10.3334V8.82671C8.87331 7.98004 9.66665 6.58671 9.66665 5.00004C9.66665 2.42671 7.57331 0.333374 4.99998 0.333374ZM6.89998 7.73337L6.33331 8.13337V9.66671H3.66665V8.13337L3.09998 7.73337C2.65831 7.42718 2.29727 7.01867 2.04768 6.54271C1.79809 6.06675 1.66736 5.53747 1.66665 5.00004C1.66665 3.16004 3.15998 1.66671 4.99998 1.66671C6.83998 1.66671 8.33331 3.16004 8.33331 5.00004C8.33331 6.08671 7.79998 7.10671 6.89998 7.73337Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nfunction svgIcon(\n  svgElement: JSX.Element\n): React.FC<\n  { size?: string } & ComponentProps<Omit<IconProps, 'size'>, {}, 'svg'>\n> {\n  return ({ size = 'small', ...props }) => {\n    return (\n      <Icon\n        icon={{\n          strategy: 'component',\n          size,\n          icon: svgElement,\n        }}\n        {...props}\n      />\n    );\n  };\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport './EmulatorDisabled.scss';\n\nimport { Card } from '@rmwc/card';\nimport { GridCell } from '@rmwc/grid';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport { HintIcon } from './icons';\n\nexport const EmulatorDisabled: React.FC<{\n  productName: string;\n}> = ({ productName }) => (\n  <>\n    <GridCell desktop={2} tablet={0} phone={0}>\n      {/* Spacing */}\n    </GridCell>\n    <GridCell span={8} align=\"middle\">\n      <Card className=\"EmulatorDisabled\">\n        <div className=\"EmulatorDisabled-graphics\">\n          <img src=\"/assets/img/database.png\" alt=\"\" />\n        </div>\n        <div className=\"EmulatorDisabled-description\">\n          <Typography use=\"headline6\" tag=\"h3\">\n            The {productName} Emulator is currently not running.\n          </Typography>\n          <Typography use=\"body1\" tag=\"p\">\n            If you are not using {productName} in your testing, everything is\n            fine. If you want to use {productName} in your testing, then the\n            best way to set it up and start it is to run the following command\n            initialize the {productName} Emulator:{' '}\n            <code>firebase init emulators</code>. Followed by:{' '}\n            <code>firebase emulators:start</code>.\n          </Typography>\n          <Typography use=\"body1\" tag=\"p\">\n            <a href=\"https://firebase.google.com/docs/emulator-suite/install_and_configure#configure_emulator_suite\">\n              <HintIcon size=\"xsmall\" /> Learn more\n            </a>\n          </Typography>\n        </div>\n      </Card>\n    </GridCell>\n  </>\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './Spinner.scss';\n\nimport { CircularProgress } from '@rmwc/circular-progress';\nimport { GridCell } from '@rmwc/grid';\nimport { Typography } from '@rmwc/typography';\nimport classnames from 'classnames';\nimport React from 'react';\n\nexport const Spinner: React.FC<{\n  message?: string;\n  span?: number;\n  cover?: boolean;\n  scrim?: boolean;\n} & React.HTMLProps<any>> = ({ message, span, cover, scrim, ...props }) => {\n  const children = (\n    <>\n      <CircularProgress size=\"xlarge\" />\n      {message && (\n        <Typography use=\"body2\" tag=\"p\">\n          {message}\n        </Typography>\n      )}\n    </>\n  );\n  if (span === undefined) {\n    return (\n      <div className={classnames('Spinner', { cover, scrim })} {...props}>\n        {children}\n      </div>\n    );\n  } else {\n    return (\n      <GridCell span={span} align=\"middle\" className=\"Spinner\" {...props}>\n        {children}\n      </GridCell>\n    );\n  }\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// import-sort-ignore\nimport 'firebase/database';\nimport 'firebase/firestore';\n\nimport { _FirebaseApp } from '@firebase/app-types/private';\nimport { FirebaseAuthInternal } from '@firebase/auth-interop-types';\nimport { Component, ComponentType } from '@firebase/component';\nimport * as firebase from 'firebase/app';\n\nimport { DatabaseConfig, FirestoreConfig } from './store/config';\n\ninterface WindowWithDb extends Window {\n  database?: firebase.database.Database;\n  firestore?: firebase.firestore.Firestore;\n}\n\nexport function initDatabase(\n  config: DatabaseConfig,\n  namespace: string\n): [firebase.database.Database, { cleanup: () => Promise<void> }] {\n  const databaseURL = `http://${config.hostAndPort}/?ns=${namespace}`;\n  const app = firebase.initializeApp(\n    { databaseURL },\n    `Database Component: ${databaseURL} ${Math.random()}`\n  );\n  applyAdminAuth(app);\n  const db = app.database();\n  // only log the first time\n  if (!(window as WindowWithDb).database) {\n    console.log(` Realtime Database is available at window.database.\n\n    Try:\n    database.ref().set({hello: 'world!'});\n    database.ref().once('value').then( snap => console.log(snap.val()) );`);\n  }\n  (window as WindowWithDb).database = db;\n  return [db, { cleanup: () => app.delete() }];\n}\n\nexport function initFirestore(\n  projectId: string,\n  config: FirestoreConfig\n): [firebase.firestore.Firestore, { cleanup: () => Promise<void> }] {\n  const app = firebase.initializeApp(\n    { projectId },\n    `Firestore Component: ${Math.random()}`\n  );\n  applyAdminAuth(app);\n  const firestore = app.firestore();\n  firestore.settings({\n    host: config.hostAndPort,\n    ssl: false,\n  });\n  // only log the first time\n  if (!(window as WindowWithDb).firestore) {\n    console.log(` Firestore is available at window.firestore.\n\n    Try:\n    firestore.doc('hello/world').set({hello: 'world!'});\n    firestore.doc('hello/world').get().then( snap => console.log(snap.data()) );`);\n  }\n  (window as WindowWithDb).firestore = firestore;\n  return [firestore, { cleanup: () => app.delete() }];\n}\n\nfunction applyAdminAuth(app: firebase.app.App): void {\n  const accessToken = 'owner'; // Accepted as admin by emulators.\n  const mockAuthComponent = new Component(\n    'auth-internal',\n    () =>\n      ({\n        getToken: async () => ({ accessToken: accessToken }),\n        getUid: () => null,\n        addAuthTokenListener: listener => {\n          // Call listener once immediately with predefined\n          // accessToken.\n          listener(accessToken);\n        },\n        removeAuthTokenListener: () => {},\n      } as FirebaseAuthInternal),\n    'PRIVATE' as ComponentType\n  );\n\n  ((app as unknown) as _FirebaseApp)._addOrOverwriteComponent(\n    mockAuthComponent\n  );\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './BreadCrumbs.scss';\n\nimport { IconButton } from '@rmwc/icon-button';\nimport classnames from 'classnames';\nimport React from 'react';\nimport { Link } from 'react-router-dom';\n\nexport interface Props {\n  /** The base url to prepend when creating Router links */\n  base: string;\n  path: string;\n  onEdit?: () => void;\n}\n\nconst EMPTY_KEYS: string[] = [];\n\nexport const BreadCrumbs: React.FC<Props> = ({\n  base,\n  path,\n  onEdit,\n  children,\n}) => {\n  const normalizedPath = path.startsWith('/') ? path.substr(1) : path;\n  const keys = normalizedPath ? normalizedPath.split('/') : EMPTY_KEYS;\n\n  const hrefs = keys.reduce<string[]>((acc, key) => {\n    const prevLink = acc.length ? acc[acc.length - 1] : base;\n    acc.push(`${prevLink}/${key}`);\n    return acc;\n  }, []);\n\n  return (\n    <ul role=\"navigation\" className=\"BreadCrumbs\">\n      <li className=\"BreadCrumbs-crumb\">\n        <IconButton icon=\"home\" tag={Link} to={base} />\n      </li>\n\n      {keys.map((key, i) => (\n        <li\n          key={hrefs[i]}\n          className={classnames('BreadCrumbs-crumb', 'BreadCrumbs-link', {\n            'BreadCrumbs-active': i === keys.length - 1,\n          })}\n        >\n          <Link to={hrefs[i]}>{key}</Link>\n        </li>\n      ))}\n\n      <li\n        className=\"BreadCrumbs-edit\"\n        aria-label=\"Edit URL\"\n        onClick={() => onEdit && onEdit()}\n      >\n        <IconButton icon=\"edit\" />\n      </li>\n      <li>{children}</li>\n    </ul>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './CardActionBar.scss';\n\nimport { Theme, ThemeProvider } from '@rmwc/theme';\nimport classnames from 'classnames';\nimport React from 'react';\n\nimport { grey100 } from '../../colors';\n\nexport const CardActionBar: React.FC<{ className?: string }> = ({\n  className,\n  children,\n}) => {\n  return (\n    <ThemeProvider\n      options={{ surface: grey100 }}\n      className={classnames('CardActionBar', className)}\n    >\n      <Theme use={['surface']} className=\"CardActionBar-container\" tag=\"div\">\n        {children}\n      </Theme>\n    </ThemeProvider>\n  );\n};\n\nexport const CardActionBarActions: React.FC = ({ children }) => {\n  return (\n    <>\n      <span style={{ flex: '1 auto' }} />\n      <div className=\"CardActionBar-actions\">{children}</div>\n    </>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport const background = '#F6F7F9';\nexport const primary = '#681DA8'; // Google Purple 900.\nexport const secondary = 'rgba(0, 0, 0, .54)';\n\nexport const grey100 = '#F5F5F5';\n\nexport const navBarPrimary = '#D7AEFB'; // Google Purple 200.\nexport const navBarSurface = '#0c2d48'; // Navy 700\nexport const navBarOnSurface = '#FFF';\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './InteractiveBreadCrumbBar.scss';\n\nimport { Elevation } from '@rmwc/elevation';\nimport { IconButton } from '@rmwc/icon-button';\nimport { TextField } from '@rmwc/textfield';\nimport { Typography } from '@rmwc/typography';\nimport useKey from '@rooks/use-key';\nimport React, { useEffect, useLayoutEffect, useRef, useState } from 'react';\n\nimport { Props as BreadCrumbProps, BreadCrumbs } from './BreadCrumbs';\nimport { CardActionBar } from './CardActionBar';\n\ninterface Props extends BreadCrumbProps {\n  /** The input prefix to show before the editable input */\n  inputPrefix?: string;\n  onNavigate: (path: string) => void;\n}\n\nexport const InteractiveBreadCrumbBar: React.FC<Props> = ({\n  onNavigate,\n  children,\n  inputPrefix,\n  path,\n  ...breadCrumbProps\n}) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [value, setValue] = useState(path);\n\n  // Update input's path value if path prop changes\n  useEffect(() => setValue(path), [path]);\n\n  const handleSubmit = () => {\n    const normalizedPath = value.startsWith('/') ? value.substr(1) : value;\n    onNavigate(normalizedPath);\n    setIsEditing(false);\n  };\n\n  const handleEdit = () => {\n    setIsEditing(true);\n  };\n\n  const handleCancel = () => {\n    setIsEditing(false);\n    setValue(path);\n  };\n\n  const inputRef = useRef<HTMLInputElement>(null);\n  useKey(['Escape'], handleCancel, {\n    eventTypes: ['keypress', 'keydown', 'keyup'],\n    target: inputRef,\n    when: true,\n  });\n\n  useLayoutEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.select();\n    }\n  }, [isEditing, inputRef]);\n\n  return (\n    <div className=\"InteractiveBreadCrumbBar\">\n      {isEditing ? (\n        <Elevation z={1} wrap>\n          <form\n            className=\"InteractiveBreadCrumbBar-form\"\n            onSubmit={() => handleSubmit()}\n          >\n            {inputPrefix && (\n              <Typography\n                use=\"body2\"\n                className=\"InteractiveBreadCrumbBar-prefix\"\n                theme=\"secondary\"\n              >\n                {inputPrefix}\n              </Typography>\n            )}\n            <TextField\n              aria-label=\"Document path\"\n              fullwidth\n              className=\"value\"\n              type=\"text\"\n              value={value}\n              onChange={e => setValue(e.currentTarget.value)}\n              inputRef={inputRef}\n            />\n            <IconButton\n              label=\"Cancel\"\n              type=\"button\"\n              icon=\"close\"\n              onClick={handleCancel}\n              theme=\"secondary\"\n            />\n          </form>\n        </Elevation>\n      ) : (\n        <CardActionBar className=\"top\">\n          <BreadCrumbs path={path} {...breadCrumbProps} onEdit={handleEdit}>\n            {children}\n          </BreadCrumbs>\n        </CardActionBar>\n      )}\n    </div>\n  );\n};\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ntype RequestMethod = 'GET' | 'POST' | 'PUT' | 'DELETE';\n\nexport class ResponseError extends Error {\n  constructor(\n    message: string,\n    readonly response: Response,\n    readonly json?: {}\n  ) {\n    super(message);\n  }\n}\n\n/** Simple REST api helpers */\nexport abstract class RestApi {\n  protected async getToken() {\n    return { accessToken: 'owner' };\n  }\n\n  protected async jsonRequest(\n    url: string,\n    data: {},\n    method: RequestMethod = 'GET'\n  ) {\n    const { accessToken } = await this.getToken();\n\n    const res = await fetch(url, {\n      method,\n      body: JSON.stringify(data),\n      headers: {\n        Authorization: 'Bearer ' + accessToken,\n        'Content-Type': 'application/json',\n      },\n    });\n\n    const json = await res.json();\n\n    if (res.status >= 400 && res.status < 600) {\n      throw new ResponseError(await res.text(), res, json);\n    }\n\n    return { res, json };\n  }\n\n  /** Upload a file with multipart/form-data */\n  protected async postFile(\n    url: string,\n    file: File,\n    method: RequestMethod = 'POST'\n  ) {\n    const body = toFormData(file);\n\n    const { accessToken } = await this.getToken();\n    body.append('auth', accessToken);\n\n    // headers are NOT allowed or it breaks the multipart/form-data payload\n    const res = await fetch(url, { method, body });\n\n    const text = await res.text();\n\n    if (res.status >= 400 && res.status < 600) {\n      throw new ResponseError(text, res);\n    }\n\n    return { res, text };\n  }\n}\n\n/** build `multipart/form-data` payload */\nfunction toFormData(file: File) {\n  const formData = new FormData();\n  formData.append('upload', file);\n  return formData;\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { initDatabase } from '../../firebase';\nimport { DatabaseConfig } from '../../store/config';\nimport { RestApi } from '../common/rest_api';\n\nexport class DatabaseApi extends RestApi {\n  private readonly baseUrl: string;\n  private cleanup: () => Promise<void>;\n  readonly database: firebase.database.Database;\n\n  constructor(config: DatabaseConfig, private readonly namespace: string) {\n    super();\n    const [database, { cleanup }] = initDatabase(config, this.namespace);\n    this.database = database;\n    this.cleanup = cleanup;\n    this.baseUrl = `http://${config.hostAndPort}`;\n  }\n\n  delete(): Promise<void> {\n    return this.cleanup();\n  }\n\n  /**\n   * Import a file at a specific path within the current database.\n   */\n  async importFile(ref: firebase.database.Reference, file: File) {\n    const params = new URLSearchParams({ ns: this.namespace });\n    const path = getUploadPath(ref) + `?${params.toString()}`;\n    return await this.postFile(`${this.baseUrl}/${path}`, file);\n  }\n}\n\n/** Get absolute path for file upload (the path with `.upload` appended) */\nfunction getUploadPath(ref: firebase.database.Reference) {\n  const absolutePath = new URL(ref.toString()).pathname;\n  // trim leading and trailing slashes\n  let path = absolutePath.replace(/^\\//, '').replace(/\\/$/, '');\n  if (path !== '') {\n    path = path + '/';\n  }\n  path += '.upload';\n  return path;\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ThemeProvider } from '@rmwc/theme';\nimport React from 'react';\n\nimport { primary } from './colors';\n\n/** Error color used in global theme */\nexport const error = '#d32f2f'; // Red 700\n\nconst purple50 = '#f3e5f5';\nexport const tipTheme = {\n  background: purple50,\n  primary,\n  primaryRgb: '104, 29, 168',\n  textIconOnBackground: primary,\n  textPrimaryOnBackground: primary,\n  textSecondaryOnBackground: `rgba(${primary}, 0.7)`,\n};\n\nconst teal50 = '#e0f2f1';\nconst teal700 = '#00796b';\nconst teal800 = '#00695c';\nexport const successTheme = {\n  background: teal50,\n  primary: teal700,\n  primaryRgb: '0, 121, 107',\n  textIconOnBackground: teal700,\n  textPrimaryOnBackground: teal800,\n  textSecondaryOnBackground: `rgba(${teal800}, 0.7)`,\n};\n\nconst navy20 = '#e5eaf0';\nconst navy300 = '#476282';\nconst navy600 = '#1b3a57';\nexport const noteTheme = {\n  background: navy20,\n  primary: navy300,\n  primaryRgb: '71, 98, 130',\n  textIconOnBackground: navy300,\n  textPrimaryOnBackground: navy600,\n  textSecondaryOnBackground: `rgba(${navy600}, 0.7)`,\n};\n\nconst orange50 = '#fff3e0';\nconst amber800 = '#ff8f00';\nconst deepOrange900 = '#bf360c';\nexport const cautionTheme = {\n  background: orange50,\n  primary: amber800,\n  primaryRgb: '255, 143, 0',\n  onPrimary: 'white',\n  textIconOnBackground: amber800,\n  textPrimaryOnBackground: deepOrange900,\n  textSecondaryOnBackground: `rgba(${deepOrange900}, 0.7)`,\n};\n\nconst deepOrange50 = '#fbe9e7';\nconst red700 = '#d32f2f';\nconst red800 = '#c62828';\nexport const errorTheme = {\n  background: deepOrange50,\n  primary: red700,\n  primaryRgb: '211, 47, 47',\n  textIconOnBackground: red700,\n  textPrimaryOnBackground: red800,\n  textSecondaryOnBackground: `rgba(${red800}, 0.7)`,\n};\n\n/** Possible theme types */\nexport enum Type {\n  CAUTION = 'caution',\n  NOTE = 'note',\n  SUCCESS = 'success',\n  TIP = 'tip',\n  WARNING = 'warning',\n}\n\nconst THEME_MAP: Record<string, Record<string, string>> = {\n  [Type.CAUTION]: cautionTheme,\n  [Type.NOTE]: noteTheme,\n  [Type.SUCCESS]: successTheme,\n  [Type.TIP]: tipTheme,\n  [Type.WARNING]: errorTheme,\n};\n\nexport type CustomThemeType =\n  | 'caution'\n  | 'note'\n  | 'success'\n  | 'tip'\n  | 'warning';\n\ninterface Props {\n  use: CustomThemeType;\n  wrap?: boolean;\n}\n\nexport const CustomThemeProvider: React.FC<Props> = ({\n  use,\n  wrap,\n  children,\n}) => (\n  <ThemeProvider options={THEME_MAP[use]} wrap={wrap}>\n    {children}\n  </ThemeProvider>\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Max nodes shown underneath each\n */\nexport const DEFAULT_PAGE_SIZE = 50;\n\nexport const NO_CHILDREN: string[] = [];\n\nexport interface ViewModel {\n  isLoading: boolean;\n  isRealtime?: boolean;\n  value?: string;\n  children: string[];\n  query?: firebase.database.Query;\n}\n\nexport interface QueryParams {\n  key?: string;\n  operator?: '>=' | '==' | '<=';\n  value?: string;\n  limit?: number;\n}\n\nexport const DEFAULT_QUERY_PARAMS: QueryParams = {\n  limit: DEFAULT_PAGE_SIZE,\n};\n\nexport enum ChildrenDisplayType {\n  Table = 'table',\n  TreeView = 'tree',\n}\n\n/** Try to json parse a value, else assume string. */\nexport function jsonIshValue(value: string) {\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    return value;\n  }\n}\n\n/** Extra internal props on db Reference. */\ninterface RefWithInternals extends firebase.database.Reference {\n  database: firebase.database.Database;\n}\n\n/** Use some internals to determine the full url with `?ns=x` param. */\nexport function getDbRootUrl(ref: firebase.database.Reference) {\n  const options = (ref as RefWithInternals).database.app.options as Record<\n    string,\n    string\n  >;\n  return options['databaseURL'];\n}\n","import './Callout.scss';\n\nimport { Icon } from '@rmwc/icon';\nimport { Theme, ThemeProvider } from '@rmwc/theme';\nimport { Typography } from '@rmwc/typography';\nimport React, { ReactNode } from 'react';\n\nimport { CustomThemeProvider, CustomThemeType, Type } from '../../themes';\n\nexport interface CalloutProps {\n  /** Custom icon to override the default */\n  icon?: string;\n  /** Show a lighter version of the callout */\n  aside?: true;\n  /** The color scheme of the callout. Defaults to 'note' */\n  type?: CustomThemeType;\n\n  /** Action buttons */\n  actions?: ReactNode;\n}\n\nconst DEFAULT_ICON_MAP: Record<string, string> = {\n  [Type.CAUTION]: 'error',\n  [Type.NOTE]: 'info',\n  [Type.SUCCESS]: 'check_circle',\n  [Type.TIP]: 'star',\n  [Type.WARNING]: 'warning',\n};\n\nexport const Callout: React.FC<CalloutProps> = ({\n  children,\n  actions,\n  icon,\n  aside,\n  type = Type.NOTE,\n}) => {\n  const iconName = icon || DEFAULT_ICON_MAP[type];\n  const asideClass = aside ? ' Callout-aside' : '';\n  const classes = `Callout Callout-${type}${asideClass}`;\n\n  return (\n    <CustomThemeProvider use={type} wrap>\n      <Theme\n        className={classes}\n        use={aside ? [] : ['onPrimary', 'primaryBg']}\n        tag=\"div\"\n      >\n        <div className=\"Callout-body\">\n          <div className=\"Callout-message\">\n            {iconName && (\n              <Icon\n                icon={iconName}\n                aria-hidden=\"true\"\n                className=\"Callout-icon\"\n              />\n            )}\n            <Typography use=\"subtitle2\">{children}</Typography>\n          </div>\n        </div>\n        {/* Make \"white\" the new primary, just to invert buttons from props */}\n        <ThemeProvider wrap options={aside ? {} : { primary: '#fff' }}>\n          <div className=\"Callout-actions\">{actions}</div>\n        </ThemeProvider>\n      </Theme>\n    </CustomThemeProvider>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './Field.scss';\n\nimport { randomId } from '@rmwc/base';\nimport { Select, SelectProps } from '@rmwc/select';\nimport { TextField, TextFieldHTMLProps, TextFieldProps } from '@rmwc/textfield';\nimport { HTMLProps } from '@rmwc/types';\nimport { Typography } from '@rmwc/typography';\nimport classnames from 'classnames';\nimport React, { useState } from 'react';\n\ntype Props = {\n  fieldClassName?: string;\n  tip?: string;\n  error?: React.ReactNode | string;\n} & TextFieldProps &\n  TextFieldHTMLProps;\n\nexport const Field: React.FC<Props> = ({\n  fieldClassName,\n  label,\n  // strip fullwidth or outlined, always use outlined\n  fullwidth,\n  outlined,\n  tip,\n  error,\n  ...textFieldProps\n}) => {\n  const [id] = useState(randomId());\n  return (\n    <div className={classnames('Field', fieldClassName)}>\n      <Typography\n        className=\"Field-label\"\n        use=\"body2\"\n        theme=\"secondary\"\n        tag=\"label\"\n        htmlFor={id}\n      >\n        {label}\n      </Typography>\n      <TextField\n        outlined\n        invalid={!!error}\n        {...textFieldProps}\n        tag=\"div\"\n        id={id}\n      />\n      <div className=\"Field-subtext\">\n        {error ? (\n          <Typography className=\"Field-tip\" use=\"body2\" theme=\"error\">\n            {error}\n          </Typography>\n        ) : (\n          tip && (\n            <Typography className=\"Field-tip\" use=\"body2\" theme=\"secondary\">\n              {tip}\n            </Typography>\n          )\n        )}\n      </div>\n    </div>\n  );\n};\n\ntype SelectFieldProps = {\n  fieldClassName?: string;\n  tip?: string;\n  error?: string;\n} & SelectProps &\n  HTMLProps<HTMLSelectElement>;\n\nexport const SelectField: React.FC<SelectFieldProps> = ({\n  fieldClassName,\n  label,\n  // strip outlined bool, always use outlined\n  outlined,\n  tip,\n  theme, // TODO: 5.0 theme, incompatible with 6.0 remove at 6.0\n  error,\n  ...selectProps\n}) => {\n  const [id] = useState(randomId());\n  return (\n    <div className={classnames('Field', fieldClassName)}>\n      <Typography\n        className=\"Field-label\"\n        use=\"body2\"\n        theme=\"secondary\"\n        tag=\"label\"\n        htmlFor={id}\n      >\n        {label}\n      </Typography>\n      <Select outlined {...selectProps} id={id} />\n      <div className=\"Field-subtext\">\n        {error ? (\n          <Typography className=\"Field-tip\" use=\"body2\" theme=\"error\">\n            {error}\n          </Typography>\n        ) : (\n          tip && (\n            <Typography className=\"Field-tip\" use=\"body2\" theme=\"secondary\">\n              {tip}\n            </Typography>\n          )\n        )}\n      </div>\n    </div>\n  );\n};\n","import './Field.scss';\nimport './FileField.scss';\n\nimport { randomId } from '@rmwc/base';\nimport { Button } from '@rmwc/button';\nimport { HTMLProps } from '@rmwc/types';\nimport { Typography } from '@rmwc/typography';\nimport React, { useState } from 'react';\nimport { useDropzone } from 'react-dropzone';\n\ntype FileFieldProps = {\n  tip?: string;\n  error?: string;\n  onFiles?: (files: File[]) => void;\n} & HTMLProps<HTMLInputElement>;\n\nconst DROP_MESSAGE = 'Drop file(s) here';\nconst INVALID_FILE_MESSAGE = 'File type is not accepted';\n\nexport const FileField: React.FC<FileFieldProps> = ({\n  label,\n  tip,\n  error,\n  onFiles,\n  value,\n  accept,\n}) => {\n  const [id] = useState(randomId());\n\n  const {\n    isDragActive,\n    getRootProps,\n    getInputProps,\n    isDragReject,\n  } = useDropzone({\n    onDrop: onFiles,\n    accept,\n  });\n\n  return (\n    <div className=\"Field\">\n      {/* hidden input */}\n      <Typography\n        className=\"Field-label\"\n        use=\"body2\"\n        theme=\"secondary\"\n        tag=\"label\"\n        htmlFor={id}\n      >\n        {label}\n      </Typography>\n\n      <div\n        className=\"Field-filename\"\n        {...getRootProps()}\n        data-testid=\"dropzone\"\n      >\n        <input {...getInputProps({ id })} />\n        <Typography use=\"body2\" theme=\"secondary\">\n          {isDragActive\n            ? isDragReject\n              ? INVALID_FILE_MESSAGE\n              : DROP_MESSAGE\n            : value}\n        </Typography>\n        <Button type=\"button\">Browse</Button>\n      </div>\n      <div className=\"Field-subtext\">\n        {error ? (\n          <Typography className=\"Field-tip\" use=\"body2\" theme=\"error\">\n            {error}\n          </Typography>\n        ) : (\n          tip && (\n            <Typography className=\"Field-tip\" use=\"body2\" theme=\"secondary\">\n              {tip}\n            </Typography>\n          )\n        )}\n      </div>\n    </div>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport * as React from 'react';\nimport { useState } from 'react';\n\nimport { Callout } from '../../common/Callout';\nimport { Field } from '../../common/Field';\nimport { FileField } from '../../common/FileField';\nimport { Spinner } from '../../common/Spinner';\nimport { DatabaseApi } from '../api';\nimport styles from './ImportDialog.module.scss';\n\nexport interface Props {\n  api: DatabaseApi;\n  reference: firebase.database.Reference;\n  droppedFile?: File;\n  onComplete: (reference?: firebase.database.Reference, file?: File) => void;\n}\n\nexport const ImportDialog: React.FC<Props> = ({\n  api,\n  reference,\n  onComplete,\n  droppedFile,\n}) => {\n  const [file, setFile] = useState<File | undefined>(droppedFile);\n  const [isImporting, setIsImporting] = useState(false);\n  const [error, setError] = useState();\n\n  const onSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    if (file) {\n      try {\n        setIsImporting(true);\n        await api.importFile(reference, file);\n        onComplete(reference, file);\n      } catch (e) {\n        setError(e.message);\n      }\n      setIsImporting(false);\n    }\n  };\n\n  const path = new URL(reference.toString()).pathname;\n\n  return (\n    <Dialog renderToPortal open onClose={() => onComplete()}>\n      <form onSubmit={onSubmit} className={styles.container}>\n        <DialogTitle>Import JSON</DialogTitle>\n        <DialogContent onSubmit={onSubmit}>\n          <Callout aside type=\"warning\">\n            All data at this location will be overwritten\n          </Callout>\n          <Callout aside type=\"caution\">\n            If the Functions emulator is running, database functions will be\n            executed.\n          </Callout>\n          <Field\n            disabled\n            name=\"location\"\n            label=\"Data location\"\n            value={path}\n            type=\"text\"\n          />\n          <FileField\n            name=\"file\"\n            accept=\"application/json\"\n            label=\"Data (JSON)\"\n            required\n            value={file?.name || 'Drop a file, or click to select'}\n            onFiles={files => setFile(files[0])}\n            error={error}\n          />\n        </DialogContent>\n        <DialogActions>\n          <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n            Cancel\n          </DialogButton>\n          <DialogButton type=\"submit\" unelevated>\n            Import\n          </DialogButton>\n        </DialogActions>\n      </form>\n      {isImporting && <Spinner cover scrim message=\"Importing...\" />}\n    </Dialog>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as firebase from 'firebase/app';\nimport { Observable, ReplaySubject, defer, from, of } from 'rxjs';\nimport {\n  catchError,\n  concatMap,\n  map,\n  mapTo,\n  shareReplay,\n  switchMap,\n} from 'rxjs/operators';\n\nimport {\n  DEFAULT_PAGE_SIZE,\n  QueryParams,\n  ViewModel,\n  getDbRootUrl,\n} from './view_model';\n\n/**\n * Timeout for silent call, which should determine if the data is\n * safely loadable at the current node\n */\nconst REST_TIMEOUT = `1s`;\n\nconst NO_CHILDREN: string[] = [];\n\n// Accepted as admin by Realtime Database Emulator.\nconst ADMIN_AUTH_HEADERS = { Authorization: 'Bearer owner' };\n\n/**\n * Creates an observable view model and query subject. The view model will\n * update when the query emits/changes.\n */\nexport function createViewModel(\n  ref: firebase.database.Reference,\n  canDoRealtime$: Observable<boolean>\n) {\n  const query = new ReplaySubject<QueryParams>(1);\n  query.next({ limit: DEFAULT_PAGE_SIZE });\n  const viewModel$ = query.pipe(\n    switchMap(queryParams => {\n      return canDoRealtime$.pipe(\n        concatMap(realtime =>\n          realtime\n            ? realtimeToViewModel(ref, queryParams)\n            : nonRealtimeToViewModel(ref, queryParams)\n        )\n      );\n    })\n  );\n  return { query, viewModel$ };\n}\n\n/**\n * Checks if realtime is possible at the node. Only checks once for the current\n * node.\n */\nexport function canDoRealtime(\n  realtimeRef: firebase.database.Reference\n): Observable<boolean> {\n  const silent = restUrl(realtimeRef, {\n    print: 'silent',\n    timeout: REST_TIMEOUT,\n  });\n  return defer(() => fetch(silent, { headers: ADMIN_AUTH_HEADERS })).pipe(\n    mapTo(true),\n    catchError(() => of(false)),\n    shareReplay({ bufferSize: 1, refCount: true })\n  );\n}\n\nfunction realtimeToViewModel(\n  ref: firebase.database.Reference,\n  queryParams: QueryParams\n) {\n  let query: firebase.database.Query;\n  return once(ref).pipe(\n    switchMap(snap => {\n      // The \"default\" query contains limitToFirst(50), so we can not blindly\n      // apply the query to leaf nodes. leafNodeRef.limitToFirst(n) will yield\n      // null data.\n      if (snap.hasChildren()) {\n        query = applyQuery(ref, queryParams);\n        return toObservable(query);\n      }\n      return toObservable(ref);\n    }),\n    map(\n      (snap): ViewModel => ({\n        value: snap.hasChildren() ? undefined : snap.val(),\n        children: snap.hasChildren() ? Object.keys(snap.val()) : NO_CHILDREN,\n        isRealtime: true,\n        isLoading: false,\n        query,\n      })\n    )\n  );\n}\n\nfunction nonRealtimeToViewModel(\n  ref: firebase.database.Reference,\n  queryParams: QueryParams\n): Observable<ViewModel> {\n  return fetchNonRealtime(ref, queryParams).pipe(\n    map(\n      (children): ViewModel => ({\n        children,\n        isLoading: false,\n        isRealtime: false,\n      })\n    )\n  );\n}\n\nfunction once(query: firebase.database.Query) {\n  return from(query.once('value'));\n}\n\nfunction toObservable(query: firebase.database.Query) {\n  return new Observable<firebase.database.DataSnapshot>(o => {\n    const handler = query.on('value', snapshot => o.next(snapshot));\n    return () => query.off('value', handler);\n  });\n}\n\nexport function applyQuery(\n  ref: firebase.database.Reference,\n  params: QueryParams\n): firebase.database.Query {\n  const { key, operator, value, limit } = params;\n  // Check the existence value instead of it being falsy. This prevents bugs\n  // where the \"value\" is actually false.\n  // ex: { key: \"completed\", operator: \"==\", value: \"false\" }\n  if (key != null && operator != null && value != null) {\n    let query = ref.orderByChild(key).limitToFirst(limit || DEFAULT_PAGE_SIZE);\n    switch (operator) {\n      case '==':\n        return query.equalTo(value);\n      case '<=':\n        return query.endAt(value);\n      case '>=':\n        return query.startAt(value);\n    }\n  }\n  return ref.limitToFirst(limit || DEFAULT_PAGE_SIZE);\n}\n\n/** Use REST to fetch the children for a node */\nfunction fetchNonRealtime(\n  realtimeRef: firebase.database.Reference,\n  query: QueryParams\n): Observable<string[]> {\n  const params = getRestQueryParams(query);\n  const shallow = restUrl(realtimeRef, { ...params, shallow: 'true' });\n  return defer(() => fetch(shallow, { headers: ADMIN_AUTH_HEADERS })).pipe(\n    map(r => r.json()),\n    map(data => Object.keys(data))\n  );\n}\n\ninterface RestQueryParams {\n  orderBy?: string;\n  limitToFirst: string;\n  equalTo?: string;\n  endAt?: string;\n  startAt?: string;\n}\n\nfunction getRestQueryParams(query: QueryParams): RestQueryParams {\n  const { key, operator, value, limit } = query;\n\n  const params: RestQueryParams = {\n    orderBy: key,\n    limitToFirst: `${limit || DEFAULT_PAGE_SIZE}`,\n  };\n\n  if (key && operator && value) {\n    switch (operator) {\n      case '==':\n        params.equalTo = value;\n        break;\n      case '<=':\n        params.endAt = value;\n        break;\n      case '>=':\n        params.startAt = value;\n        break;\n    }\n  }\n\n  return params;\n}\n\nfunction restUrl(\n  ref: firebase.database.Reference,\n  params: Record<string, string | undefined>\n): string {\n  const rootUrl = getDbRootUrl(ref);\n\n  // TODO(yuchenshi): Find some cross-browser and lightweight way to parse query.\n  if (rootUrl.indexOf('?ns=') >= 0) {\n    const ns = rootUrl.split('?ns=')[1];\n    params = { ...params, ns };\n  }\n\n  const query = Object.entries(params)\n    .filter(([key, value]) => !!value)\n    .map(([key, value]) => `${key}=${encodeURIComponent(value!)}`)\n    .join('&');\n  return `${ref.toString()}.json?${query}`;\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { firestore } from 'firebase';\n\nexport interface DocumentCollectionDatabaseApi<U, V> {\n  projectId: string;\n  databaseId: string;\n\n  database: U;\n\n  delete(): Promise<void>;\n\n  getCollections(docRef?: V): Promise<firestore.CollectionReference[]>;\n}\n\nexport type FirestoreApi = DocumentCollectionDatabaseApi<\n  firestore.Firestore,\n  firestore.DocumentReference\n>;\n\n/** Field types supported by Firestore  */\nexport enum FieldType {\n  ARRAY = 'array',\n  BLOB = 'blob',\n  BOOLEAN = 'boolean',\n  GEOPOINT = 'geopoint',\n  JSON = 'json',\n  MAP = 'map',\n  NULL = 'null',\n  NUMBER = 'number',\n  REFERENCE = 'reference',\n  STRING = 'string',\n  TIMESTAMP = 'timestamp',\n}\n\nexport type FirestoreAny = FirestoreMap | FirestoreArray | FirestorePrimitive;\n\nexport type FirestorePrimitive =\n  | string\n  | number\n  | boolean\n  | null\n  | firestore.DocumentReference\n  | firestore.GeoPoint\n  | firestore.Blob\n  | firestore.Timestamp\n  | firestore.FieldValue;\n\nexport type FirestoreArray = Array<FirestorePrimitive | FirestoreMap>;\n\nexport type FirestoreMap = {\n  [field: string]: FirestoreAny;\n};\n\n/** Collection filter */\nexport type CollectionFilterSort = 'ascending' | 'descending';\n\ninterface Filter<T extends firestore.WhereFilterOp | undefined> {\n  field: string;\n  operator: T;\n}\n\ntype ConditionValue = number | boolean | string;\n\ninterface SingleValueCondition {\n  value: ConditionValue;\n}\n\ninterface MultiValueCondition {\n  values: ConditionValue[];\n}\n\ninterface SortableCondition {\n  sort?: 'asc' | 'desc';\n}\n\ntype Unspecified = Filter<undefined> & SortableCondition;\ntype Equal = Filter<'=='> & SingleValueCondition;\ntype GreaterThan = Filter<'>'> & SingleValueCondition & SortableCondition;\ntype GreaterThanEqual = Filter<'>='> & SingleValueCondition & SortableCondition;\ntype LessThanEqual = Filter<'<='> & SingleValueCondition & SortableCondition;\ntype LessThan = Filter<'<'> & SingleValueCondition & SortableCondition;\ntype In = Filter<'in'> & MultiValueCondition;\ntype ArrayContains = Filter<'array-contains'> & SingleValueCondition;\ntype ArrayContainsAny = Filter<'array-contains-any'> & MultiValueCondition;\n\nexport type CollectionFilter =\n  | Unspecified\n  | Equal\n  | GreaterThan\n  | GreaterThanEqual\n  | LessThanEqual\n  | LessThan\n  | In\n  | ArrayContains\n  | ArrayContainsAny;\n\nexport function isSingleValueCollectionFilter(\n  cf: CollectionFilter\n): cf is Extract<CollectionFilter, SingleValueCondition> {\n  return (\n    cf.operator === '==' ||\n    cf.operator === '>' ||\n    cf.operator === '>=' ||\n    cf.operator === '<=' ||\n    cf.operator === '<' ||\n    cf.operator === 'array-contains'\n  );\n}\n\nexport function isMultiValueCollectionFilter(\n  cf: CollectionFilter\n): cf is Extract<CollectionFilter, MultiValueCondition> {\n  return cf.operator === 'in' || cf.operator === 'array-contains-any';\n}\n\nexport function isSortableCollectionFilter(\n  cf: CollectionFilter\n): cf is Extract<CollectionFilter, SortableCondition> {\n  return (\n    !cf.operator ||\n    cf.operator === '>' ||\n    cf.operator === '>=' ||\n    cf.operator === '<=' ||\n    cf.operator === '<'\n  );\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useContext } from 'react';\n\nimport DatabaseApi from './api';\n\nconst ApiContext = createContext<DatabaseApi | null>(null);\n\nexport const ApiProvider = ApiContext.Provider;\nexport const useApi = () => {\n  const api = useContext(ApiContext);\n  if (!api) {\n    throw new Error('You are missing a <ApiProvider>.');\n  }\n  return api;\n};\n\n// TODO: need a better strategy to handle missing API in RTDB-documentEditor\nexport const useOptionalApi = () => {\n  return useContext(ApiContext);\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { firestore } from 'firebase';\nimport produce from 'immer';\nimport get from 'lodash.get';\n\nimport {\n  FieldType,\n  FirestoreAny,\n  FirestoreArray,\n  FirestoreMap,\n  FirestorePrimitive,\n} from './models';\n\n/** Firestore supported numbers */\nexport const NUMBER_REGEX = /^-?([\\d]*\\.?\\d+|Infinity|NaN)$/;\n\nexport function getParentPath(path: string[]) {\n  return path.slice(0, path.length - 1);\n}\n\nexport function lastFieldName(path: string[]): string {\n  if (!path.length)\n    throw new Error(`${path} is empty and has no _last_ field name`);\n  return path[path.length - 1];\n}\n\nexport function getFieldType(value: FirestoreAny): FieldType {\n  if (value === null) {\n    return FieldType.NULL;\n  }\n\n  if (value instanceof firestore.Timestamp) {\n    return FieldType.TIMESTAMP;\n  }\n\n  if (value instanceof Array) {\n    return FieldType.ARRAY;\n  }\n\n  if (value instanceof firestore.DocumentReference) {\n    return FieldType.REFERENCE;\n  }\n\n  if (value instanceof firestore.GeoPoint) {\n    return FieldType.GEOPOINT;\n  }\n\n  if (value instanceof firestore.Blob) {\n    return FieldType.BLOB;\n  }\n\n  if (typeof value === 'object') {\n    return FieldType.MAP;\n  }\n\n  return typeof value as FieldType;\n}\n\nexport function isBoolean(value: FirestoreAny): value is boolean {\n  return typeof value === 'boolean';\n}\n\nexport function isReference(\n  value: FirestoreAny\n): value is firestore.DocumentReference {\n  return value instanceof firestore.DocumentReference;\n}\n\nexport function isTimestamp(value: FirestoreAny): value is firestore.Timestamp {\n  return value instanceof firestore.Timestamp;\n}\n\nexport function isString(value: FirestoreAny): value is string {\n  return typeof value === 'string';\n}\n\nexport function isNumber(value: FirestoreAny): value is number {\n  return typeof value === 'number';\n}\n\nexport function isGeoPoint(value: FirestoreAny): value is firestore.GeoPoint {\n  return value instanceof firestore.GeoPoint;\n}\n\nexport function isMap(value: any): value is FirestoreMap {\n  return getFieldType(value) === FieldType.MAP;\n}\n\nexport function isArray(value: any): value is FirestoreArray {\n  return getFieldType(value) === FieldType.ARRAY;\n}\n\nexport function isPrimitive(value: any): value is FirestorePrimitive {\n  return !isMap(value) && !isArray(value);\n}\n\n/*\n  Return a copy of base with the field (specified by path) updated to value.\n  This function also works with array elements. base is never modified.\n*/\nexport const withFieldSet = produce((draft, path: string[], value: any) => {\n  const parent = get(draft, getParentPath(path)) || draft;\n  if (isMap(parent)) {\n    parent[lastFieldName(path)] = value;\n  } else if (isArray(parent)) {\n    parent[Number(lastFieldName(path))] = value;\n  } else {\n    return value;\n  }\n});\n\n/*\n  Return a copy of base with the field (specified by path) deleted.\n  This function also works with removing array elements. base is never modified.\n*/\nexport const withFieldRemoved = produce((draft, path: string[]) => {\n  const parent = get(draft, getParentPath(path)) || draft;\n  if (isMap(parent)) {\n    delete parent[lastFieldName(path)];\n  } else if (isArray(parent)) {\n    parent.splice(Number(lastFieldName(path)), 1);\n  }\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createAction } from 'typesafe-actions';\n\nimport { FieldType } from '../models';\nimport { JSONField, PrimitiveValue } from './types';\n\nexport const addToMap = createAction('@document/addToMap')<{\n  uuid: number;\n  name: string;\n  value: PrimitiveValue;\n}>();\nexport const addToArray = createAction('@document/addToArray')<{\n  uuid: number;\n  value: PrimitiveValue;\n}>();\n// TODO\nexport const removeFromMap = createAction('@document/removeFromMap')<{\n  uuid: number;\n  childId: number;\n}>();\n// TODO\nexport const removeFromArray = createAction('@document/removeFromArray')<{\n  uuid: number;\n  childId: number;\n}>();\nexport const updateName = createAction('@document/updateName')<{\n  uuid: number;\n  childId: number;\n  name: string;\n}>();\nexport const updateType = createAction('@document/updateType')<{\n  uuid: number;\n  type: FieldType;\n}>();\nexport const updateValue = createAction('@document/updateValue')<{\n  uuid: number;\n  value: PrimitiveValue | JSONField['value'];\n}>();\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { SelectField } from '../../common/Field';\n\nconst BooleanEditor: React.FC<{\n  value: boolean;\n  onChange: (value: boolean) => void;\n}> = ({ value, onChange }) => {\n  return (\n    <SelectField\n      label=\"Value\"\n      value={value.toString()}\n      options={['true', 'false']}\n      onChange={e => {\n        onChange(e.currentTarget.value === 'true');\n      }}\n    />\n  );\n};\n\nexport default BooleanEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { firestore } from 'firebase';\nimport React, { useEffect, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nimport { Field } from '../../common/Field';\n\nconst GeoPointEditor: React.FC<{\n  name: string;\n  value: firestore.GeoPoint;\n  onChange: (value: firestore.GeoPoint) => void;\n}> = ({ name, value, onChange }) => {\n  const [latitude, setLatitude] = useState(String(value.latitude));\n  const [longitude, setLongitude] = useState(String(value.longitude));\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n  } = useFormContext();\n\n  const latitudeName = `${name}-lat`;\n  const longitudeName = `${name}-long`;\n\n  useEffect(() => {\n    register(latitudeName, {\n      required: 'Required',\n      min: {\n        value: -90,\n        message: 'Must be >= -90',\n      },\n      max: {\n        value: 90,\n        message: 'Must be <= -90',\n      },\n    });\n\n    register(longitudeName, {\n      required: 'Required',\n      min: {\n        value: -180,\n        message: 'Must be >= -180',\n      },\n      max: {\n        value: 180,\n        message: 'Must be <= -180',\n      },\n    });\n\n    return () => unregister([latitudeName, longitudeName]);\n  }, [register, unregister, latitudeName, longitudeName]);\n\n  useEffect(() => {\n    const lat = Number(latitude);\n    const long = Number(longitude);\n    if (value.latitude === lat && value.longitude === long) {\n      return;\n    }\n\n    try {\n      // Update the parent when _both_ fields are valid\n      const geoPoint = new firestore.GeoPoint(lat, long);\n      onChange(geoPoint);\n    } catch {}\n  }, [value, latitude, longitude, onChange]);\n\n  return (\n    <div className=\"FieldEditor-geo-point\">\n      <Field\n        label=\"Latitude\"\n        type=\"number\"\n        step=\"any\"\n        defaultValue={latitude}\n        onChange={e => {\n          setValue(latitudeName, e.currentTarget.value, true);\n          setLatitude(e.currentTarget.value);\n        }}\n        error={touched[latitudeName] && errors[latitudeName]?.message}\n      />\n\n      <Field\n        label=\"Longitude\"\n        type=\"number\"\n        step=\"any\"\n        defaultValue={longitude}\n        onChange={e => {\n          setValue(longitudeName, e.currentTarget.value, true);\n          setLongitude(e.currentTarget.value);\n        }}\n        error={touched[longitudeName] && errors[longitudeName]?.message}\n      />\n    </div>\n  );\n};\n\nexport default GeoPointEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nimport { Field } from '../../common/Field';\nimport { FirestoreAny } from '../models';\n\nconst JsonEditor: React.FC<{\n  value: FirestoreAny;\n  onChange: (value: FirestoreAny) => void;\n  name: string;\n}> = ({ value, onChange, name }) => {\n  const [initialValue] = useState(JSON.stringify(value));\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n    triggerValidation,\n  } = useFormContext();\n\n  useEffect(() => {\n    register(name, {\n      validate: e => {\n        try {\n          JSON.parse(e);\n          return true;\n        } catch {\n          return 'Must be valid JSON';\n        }\n      },\n    });\n\n    return () => unregister(name);\n  }, [register, unregister, name]);\n\n  async function handleChange(value: string) {\n    if (await triggerValidation(name)) {\n      onChange(JSON.parse(value));\n    }\n  }\n\n  return (\n    <Field\n      label=\"JSON\"\n      defaultValue={initialValue}\n      onChange={e => {\n        setValue(name, e.currentTarget.value);\n        handleChange(e.currentTarget.value);\n      }}\n      error={touched[name] && errors[name]?.message}\n    />\n  );\n};\n\nexport default JsonEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nimport { Field } from '../../common/Field';\nimport { NUMBER_REGEX } from '../utils';\n\nconst NumberEditor: React.FC<{\n  value: number;\n  onChange: (value: number) => void;\n  name: string;\n}> = ({ value, onChange, name }) => {\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n    triggerValidation,\n  } = useFormContext();\n\n  useEffect(() => {\n    register(name, {\n      required: 'Required',\n      pattern: {\n        value: NUMBER_REGEX,\n        message: 'Must be a number',\n      },\n    });\n\n    return () => unregister(name);\n  }, [register, unregister, name]);\n\n  async function handleChange(value: string) {\n    if (await triggerValidation(name)) {\n      onChange(parseFloat(value));\n    }\n  }\n\n  return (\n    <Field\n      label=\"Value\"\n      defaultValue={value}\n      onChange={e => {\n        setValue(name, e.currentTarget.value);\n        handleChange(e.currentTarget.value);\n      }}\n      error={touched[name] && errors[name]?.message}\n    />\n  );\n};\n\nexport default NumberEditor;\n","import {\n  FirestoreAny,\n  FirestoreArray,\n  FirestoreMap,\n  FirestorePrimitive,\n} from '../models';\nimport { isPrimitive as isNativePrimitive } from '../utils';\n\nexport class DocumentPath {\n  constructor(readonly path: string) {}\n}\n\nexport type MapChildren = Array<{\n  readonly uuid: number;\n  name: string;\n  valueId: number;\n}>;\nexport interface MapField {\n  mapChildren: MapChildren;\n}\n\nexport type ArrayChildren = Array<{ readonly uuid: number; valueId: number }>;\nexport interface ArrayField {\n  arrayChildren: ArrayChildren;\n}\n\nexport interface JSONField {\n  isJson: boolean;\n  value: FirestoreAny;\n}\n\nexport type PrimitiveValue = FirestorePrimitive | DocumentPath;\nexport interface PrimitiveField {\n  value: PrimitiveValue;\n}\n\nexport type Field = MapField | ArrayField | JSONField | PrimitiveField;\nexport type Fields = {\n  [uuid: number]: Field;\n};\nexport type Store = {\n  uuid?: number;\n  fields: Fields;\n};\n\nexport function isPrimitive(\n  data: FirestoreAny | DocumentPath\n): data is PrimitiveValue {\n  return isNativePrimitive(data) || data instanceof DocumentPath;\n}\n\nexport function isFirestoreMap(data: FirestoreAny): data is FirestoreMap {\n  return !isFirestoreArray(data) && !isPrimitive(data);\n}\n\nexport function isFirestoreArray(data: FirestoreAny): data is FirestoreArray {\n  return data instanceof Array;\n}\n\nexport function isMapField(field: Field): field is MapField {\n  return 'mapChildren' in field;\n}\n\nexport function isArrayField(field: Field): field is ArrayField {\n  return 'arrayChildren' in field;\n}\n\nexport function isJSONField(field: Field): field is JSONField {\n  return 'isJson' in field;\n}\n\nexport function assertStoreHasRoot(\n  store: Store\n): asserts store is Store & { uuid: number } {\n  if (store.uuid === undefined) {\n    throw new Error('Store has no root');\n  }\n}\n\nexport function assertIsPrimitiveField(\n  field: Field\n): asserts field is PrimitiveField {\n  if (!('value' in field)) {\n    throw new Error('Field is not primitive');\n  }\n}\n\nexport function assertIsMapField(field: Field): asserts field is MapField {\n  if (!isMapField(field)) {\n    throw new Error('Field is not a map');\n  }\n}\n\nexport function assertIsArrayField(field: Field): asserts field is ArrayField {\n  if (!isArrayField(field)) {\n    throw new Error('Field is not an array');\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nimport { Field } from '../../common/Field';\nimport { useApi } from '../ApiContext';\nimport { DocumentPath } from './types';\n\nconst ReferenceEditor: React.FC<{\n  value: DocumentPath;\n  onChange: (value: DocumentPath) => void;\n  name: string;\n}> = ({ value, onChange, name }) => {\n  const [path] = useState(value.path);\n  const api = useApi();\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n    triggerValidation,\n  } = useFormContext();\n\n  useEffect(() => {\n    register(name, {\n      validate: e => {\n        try {\n          api.database.doc(e);\n          return true;\n        } catch {\n          return 'Must point to a document';\n        }\n      },\n    });\n\n    return () => unregister(name);\n  }, [register, unregister, name, api]);\n\n  async function handleChange(value: string) {\n    if (await triggerValidation(name)) {\n      onChange(new DocumentPath(value));\n    }\n  }\n\n  return (\n    <Field\n      label=\"Document path\"\n      defaultValue={path}\n      onChange={e => {\n        setValue(name, e.currentTarget.value);\n        handleChange(e.currentTarget.value);\n      }}\n      error={touched[name] && errors[name]?.message}\n    />\n  );\n};\n\n// api.doc(path)\n\nexport default ReferenceEditor;\n","import { firestore } from 'firebase';\n\nimport DatabaseApi from '../api';\nimport {\n  FieldType,\n  FirestoreAny,\n  FirestoreArray,\n  FirestoreMap,\n  FirestorePrimitive,\n} from '../models';\nimport {\n  ArrayChildren,\n  DocumentPath,\n  Fields,\n  MapChildren,\n  PrimitiveValue,\n  Store,\n  assertStoreHasRoot,\n  isArrayField,\n  isFirestoreArray,\n  isFirestoreMap,\n  isMapField,\n} from './types';\n\nlet uuid = 0;\nexport function getUniqueId() {\n  return uuid++;\n}\n\nfunction normalizeMap(data: FirestoreMap): Store {\n  const uuid = getUniqueId();\n\n  // reducer over object.entries -> childFields\n  const children = Object.entries(data).reduce(\n    (\n      { mapChildren, fields }: { mapChildren: MapChildren; fields: Fields },\n      [name, value]: [string, FirestoreAny]\n    ) => {\n      const child = normalize(value);\n      assertStoreHasRoot(child);\n      mapChildren.push({\n        uuid: getUniqueId(),\n        name,\n        valueId: child.uuid,\n      });\n      return { mapChildren, fields: { ...fields, ...child.fields } };\n    },\n    { mapChildren: [], fields: {} }\n  );\n  return {\n    uuid,\n    fields: {\n      ...children.fields,\n      // add item for current node\n      [uuid]: { mapChildren: children.mapChildren },\n    },\n  };\n}\n\nfunction normalizeArray(data: FirestoreArray): Store {\n  const uuid = getUniqueId();\n\n  // reducer over array elements -> childFields\n  const children = data.reduce(\n    (\n      {\n        arrayChildren,\n        fields,\n      }: { arrayChildren: ArrayChildren; fields: Fields },\n      value: FirestoreMap | FirestorePrimitive\n    ) => {\n      const child = normalize(value);\n      assertStoreHasRoot(child);\n      arrayChildren.push({\n        uuid: getUniqueId(),\n        valueId: child.uuid,\n      });\n      return { arrayChildren, fields: { ...fields, ...child.fields } };\n    },\n    { arrayChildren: [], fields: {} }\n  );\n  return {\n    uuid,\n    fields: {\n      ...children.fields,\n      // add item for current node\n      [uuid]: { arrayChildren: children.arrayChildren },\n    },\n  };\n}\n\nfunction normalizePrimitive(data: FirestorePrimitive): Store {\n  const uuid = getUniqueId();\n\n  if (data instanceof firestore.DocumentReference) {\n    return {\n      uuid,\n      fields: { [uuid]: { value: new DocumentPath(data.path) } },\n    };\n  }\n  return { uuid, fields: { [uuid]: { value: data } } };\n}\n\nexport function normalize(data: FirestoreAny): Store {\n  if (isFirestoreMap(data)) {\n    return normalizeMap(data);\n  } else if (isFirestoreArray(data)) {\n    return normalizeArray(data);\n  } else {\n    return normalizePrimitive(data);\n  }\n}\n\nexport function denormalize(\n  store: Store,\n  api: DatabaseApi | null\n): FirestoreAny {\n  assertStoreHasRoot(store);\n  const field = store.fields[store.uuid];\n  if (isMapField(field)) {\n    return field.mapChildren.reduce((acc, curr) => {\n      acc[curr.name] = denormalize(\n        {\n          uuid: curr.valueId,\n          fields: store.fields,\n        },\n        api\n      );\n      return acc;\n    }, {} as any);\n  } else if (isArrayField(field)) {\n    return field.arrayChildren.reduce((acc, curr) => {\n      acc.push(denormalize({ uuid: curr.valueId, fields: store.fields }, api));\n      return acc;\n    }, [] as any);\n  } else {\n    if (field.value instanceof DocumentPath) {\n      if (!api) {\n        throw new Error(\n          'Tried to denormalize a DocumentRef without the FirestoreAPI'\n        );\n      }\n      try {\n        return api.database.doc(field.value.path);\n      } catch {\n        // TODO: The store does not always have a valid DocRef, reconsider.\n        return '';\n      }\n    }\n    return field.value;\n  }\n}\n\nexport function defaultValueForPrimitiveType(type: FieldType): PrimitiveValue {\n  switch (type) {\n    case FieldType.BLOB:\n      // TODO\n      return '';\n    case FieldType.BOOLEAN:\n      return true;\n    case FieldType.GEOPOINT:\n      return new firestore.GeoPoint(0, 0);\n    case FieldType.NULL:\n      return null;\n    case FieldType.NUMBER:\n      return 0;\n    case FieldType.REFERENCE:\n      return new DocumentPath('');\n    case FieldType.STRING:\n      return '';\n    case FieldType.TIMESTAMP:\n      return firestore.Timestamp.fromDate(new Date());\n  }\n  return '';\n}\n\nexport function getDescendantIds(fields: Fields, ids: number[]): number[] {\n  return ids.reduce((acc, id) => {\n    acc.push(id);\n    const field = fields[id];\n    if (isMapField(field)) {\n      acc.push(\n        ...getDescendantIds(\n          fields,\n          field.mapChildren.map(c => c.valueId)\n        )\n      );\n    } else if (isArrayField(field)) {\n      acc.push(\n        ...getDescendantIds(\n          fields,\n          field.arrayChildren.map(c => c.valueId)\n        )\n      );\n    }\n    return acc;\n  }, [] as number[]);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport produce from 'immer';\nimport * as React from 'react';\nimport { Action, createReducer } from 'typesafe-actions';\n\nimport { FieldType } from '../models';\nimport * as actions from './actions';\nimport {\n  Field,\n  Store,\n  assertIsArrayField,\n  assertIsMapField,\n  assertIsPrimitiveField,\n  assertStoreHasRoot,\n} from './types';\nimport {\n  defaultValueForPrimitiveType,\n  getDescendantIds,\n  getUniqueId,\n  normalize,\n} from './utils';\n\nconst INIT_STATE = { fields: {} };\n\nconst documentStoreContext = React.createContext<{\n  store: Store;\n  dispatch: React.Dispatch<any>;\n}>({ store: INIT_STATE, dispatch: () => {} });\n\nexport const reducer = createReducer<Store, Action>({ fields: {} })\n  .handleAction(\n    actions.addToMap,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsMapField(field);\n      const normalized = normalize(payload.value);\n      assertStoreHasRoot(normalized);\n      draft.fields = {\n        ...draft.fields,\n        ...normalized.fields,\n      };\n      field.mapChildren.push({\n        uuid: getUniqueId(),\n        name: payload.name,\n        valueId: normalized.uuid,\n      });\n    })\n  )\n  .handleAction(\n    actions.addToArray,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsArrayField(field);\n      const normalized = normalize(payload.value);\n      assertStoreHasRoot(normalized);\n      draft.fields = {\n        ...draft.fields,\n        ...normalized.fields,\n      };\n      draft.fields[payload.uuid].arrayChildren.push({\n        uuid: getUniqueId(),\n        valueId: normalized.uuid,\n      });\n    })\n  )\n  .handleAction(\n    actions.removeFromMap,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsMapField(field);\n      const child = field.mapChildren.find(c => c.uuid === payload.childId);\n      if (!child) {\n        throw new Error('No map-child found with given ID');\n      }\n\n      // Remove any descendants\n      for (const uuid of getDescendantIds(draft.fields, [child.valueId])) {\n        delete draft.fields[uuid];\n      }\n\n      // Remove reference from parent\n      field.mapChildren = field.mapChildren.filter(\n        c => c.uuid !== payload.childId\n      );\n    })\n  )\n  .handleAction(\n    actions.removeFromArray,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsArrayField(field);\n      const child = field.arrayChildren.find(c => c.uuid === payload.childId);\n      if (!child) {\n        throw new Error('No array-child found with given ID');\n      }\n\n      // Remove any descendants\n      for (const uuid of getDescendantIds(draft.fields, [child.valueId])) {\n        delete draft.fields[uuid];\n      }\n\n      // Remove reference from parent\n      field.arrayChildren = field.arrayChildren.filter(\n        c => c.uuid !== payload.childId\n      );\n    })\n  )\n  .handleAction(\n    actions.updateName,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsMapField(field);\n      const childField = field.mapChildren.find(\n        c => c.uuid === payload.childId\n      );\n      if (!childField) {\n        throw new Error('No map-child found with given ID');\n      }\n      childField.name = payload.name;\n    })\n  )\n  .handleAction(\n    actions.updateType,\n    produce((draft, { payload }) => {\n      if (payload.type === FieldType.MAP) {\n        draft.fields[payload.uuid] = { mapChildren: [] };\n      } else if (payload.type === FieldType.ARRAY) {\n        draft.fields[payload.uuid] = { arrayChildren: [] };\n      } else if (payload.type === FieldType.JSON) {\n        draft.fields[payload.uuid] = { isJson: true, value: {} };\n      } else {\n        draft.fields[payload.uuid] = {\n          value: defaultValueForPrimitiveType(payload.type),\n        };\n      }\n    })\n  )\n  .handleAction(\n    actions.updateValue,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsPrimitiveField(field);\n      field.value = payload.value;\n    })\n  );\n\nexport const storeReducer: React.Reducer<Store, Action> = (state, action) => {\n  return (reducer.handlers as any)[action.type](state, action);\n};\n\nexport const DocumentStore: React.FC<{\n  store: Store;\n  dispatch: React.Dispatch<Action>;\n}> = ({ store, dispatch, children }) => {\n  return (\n    <documentStoreContext.Provider value={{ store, dispatch }}>\n      {children}\n    </documentStoreContext.Provider>\n  );\n};\n\nexport function useDocumentStore(): {\n  store: Store;\n  dispatch: React.Dispatch<Action>;\n} {\n  const context = React.useContext(documentStoreContext);\n  if (context === undefined) {\n    throw new Error('useDocumentStore must be used within a <DocumentStore>');\n  }\n  return context;\n}\n\nexport function useStore(): Store {\n  const { store } = useDocumentStore();\n  return React.useMemo(() => store, [store]);\n}\n\nexport function useDispatch(): React.Dispatch<Action> {\n  const { dispatch } = useDocumentStore();\n  return React.useMemo(() => dispatch, [dispatch]);\n}\n\nexport function useField(uuid: number): Field {\n  const store = useStore();\n  return React.useMemo(() => store.fields[uuid], [store, uuid]);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { Field } from '../../common/Field';\n\nconst StringEditor: React.FC<{\n  value: string;\n  onChange: (value: string) => void;\n}> = ({ value, onChange }) => {\n  return (\n    <Field\n      value={value}\n      outlined\n      label=\"Value\"\n      onChange={e => onChange(e.currentTarget.value)}\n    />\n  );\n};\n\nexport default StringEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { firestore } from 'firebase';\nimport React, { useEffect, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nimport { Field } from '../../common/Field';\n\nfunction dateToLocale(date: Date): string {\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const dateOfMonth = String(date.getDate()).padStart(2, '0');\n  const hours = String(date.getHours()).padStart(2, '0');\n  const minutes = String(date.getMinutes()).padStart(2, '0');\n  const seconds = String(date.getSeconds()).padStart(2, '0');\n\n  return `${year}-${month}-${dateOfMonth}T${hours}:${minutes}:${seconds}`;\n}\n\n// TODO: update to a date-picker that potentially supports time-zones\nconst TimestampEditor: React.FC<{\n  value: firestore.Timestamp;\n  onChange: (value: firestore.Timestamp) => void;\n  name: string;\n}> = ({ value, onChange, name }) => {\n  const [date, setDate] = useState(value.toDate());\n\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n  } = useFormContext();\n\n  useEffect(() => {\n    register(name, {\n      validate: e => !isNaN(e) || 'Must be a date-time',\n    });\n\n    return () => unregister(name);\n  }, [register, unregister, name]);\n\n  useEffect(() => {\n    if (value.toMillis() !== date.getTime()) {\n      onChange(firestore.Timestamp.fromDate(date));\n    }\n  }, [value, date, onChange]);\n\n  return (\n    <Field\n      label=\"Value\"\n      type=\"datetime-local\"\n      defaultValue={dateToLocale(date)}\n      onChange={e => {\n        const timestamp = Date.parse(e.currentTarget.value);\n        setValue(name, timestamp, true);\n        if (!isNaN(timestamp) && timestamp !== date.getTime()) {\n          setDate(new Date(timestamp));\n        }\n      }}\n      error={touched[name] && errors[name]?.message}\n    />\n  );\n};\n\nexport default TimestampEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { IconButton } from '@rmwc/icon-button';\nimport React, { useEffect } from 'react';\nimport { FormContext, useForm, useFormContext } from 'react-hook-form';\n\nimport { Field, SelectField } from '../../common/Field';\nimport { useOptionalApi } from '../ApiContext';\nimport { FieldType, FirestoreAny, FirestoreMap } from '../models';\nimport {\n  getFieldType,\n  isBoolean,\n  isGeoPoint,\n  isNumber,\n  isString,\n  isTimestamp,\n} from '../utils';\nimport * as actions from './actions';\nimport BooleanEditor from './BooleanEditor';\nimport GeoPointEditor from './GeoPointEditor';\nimport JsonEditor from './JsonEditor';\nimport NumberEditor from './NumberEditor';\nimport ReferenceEditor from './ReferenceEditor';\nimport {\n  DocumentStore,\n  storeReducer,\n  useDispatch,\n  useField,\n  useStore,\n} from './store';\nimport StringEditor from './StringEditor';\nimport TimestampEditor from './TimestampEditor';\nimport {\n  Field as DocumentField,\n  DocumentPath,\n  MapField,\n  isArrayField,\n  isJSONField,\n  isMapField,\n} from './types';\nimport { denormalize, normalize } from './utils';\n\nconst FIRESTORE_FIELD_TYPES = [\n  FieldType.STRING,\n  FieldType.NUMBER,\n  FieldType.BOOLEAN,\n  FieldType.MAP,\n  FieldType.ARRAY,\n  FieldType.NULL,\n  FieldType.TIMESTAMP,\n  FieldType.GEOPOINT,\n  FieldType.REFERENCE,\n];\n\n/**\n * Firestore does not support nested arrays\n * TODO(tlavelle): consider moving these upstream, and outside\n * of the \"DocumentEditor\"\n */\nconst FIRESTORE_ARRAY_FIELD_TYPES = FIRESTORE_FIELD_TYPES.filter(\n  ft => ft !== FieldType.ARRAY\n);\n\nconst RTDB_FIELD_TYPES = [\n  FieldType.STRING,\n  FieldType.NUMBER,\n  FieldType.BOOLEAN,\n  FieldType.MAP,\n  FieldType.ARRAY,\n  FieldType.JSON,\n];\n\nconst supportedFieldTypeSet = new Set(FIRESTORE_FIELD_TYPES);\n\nexport function supportsEditing(value: FirestoreAny): boolean {\n  return supportedFieldTypeSet.has(getFieldType(value));\n}\n\n/**\n * Entry point for a Document/Field editor\n *\n * areRootKeysMutable: can a root key be changed, this is generally not the case\n *     once a field has been persisted via the SDK.\n * areRootFielsMutable: can a root field be added/removed.\n */\nconst DocumentEditor: React.FC<{\n  value: FirestoreAny;\n  onChange?: (value?: FirestoreMap) => void;\n  areRootNamesMutable?: boolean;\n  areRootFieldsMutable?: boolean;\n  rtdb?: boolean;\n  startingIndex?: number;\n  supportNestedArrays?: boolean;\n}> = ({\n  value,\n  onChange,\n  areRootNamesMutable,\n  areRootFieldsMutable,\n  rtdb = false,\n  startingIndex,\n  supportNestedArrays,\n}) => {\n  const initialState = normalize(value);\n  const [store, dispatch] = React.useReducer(storeReducer, initialState);\n  const methods = useForm({ mode: 'onChange' });\n  const api = useOptionalApi();\n\n  const denormalizedStore = React.useMemo(() => denormalize(store, api), [\n    store,\n    api,\n  ]);\n\n  const errorCount = React.useMemo(() => Object.keys(methods.errors).length, [\n    methods,\n  ]);\n\n  useEffect(() => {\n    if (errorCount === 0) {\n      onChange && onChange(denormalizedStore as FirestoreMap);\n    } else {\n      onChange && onChange(undefined);\n    }\n  }, [denormalizedStore, errorCount, onChange]);\n\n  return (\n    <FormContext {...methods}>\n      <DocumentStore store={store} dispatch={dispatch}>\n        <div className=\"DocumentEditor\">\n          {\n            <>\n              {store.uuid !== undefined && (\n                <FieldEditor\n                  uuid={store.uuid}\n                  isRtdb={rtdb}\n                  areNamesMutable={areRootNamesMutable}\n                  areFieldsMutable={areRootFieldsMutable}\n                  startingIndex={startingIndex}\n                  supportNestedArrays={supportNestedArrays}\n                />\n              )}\n            </>\n          }\n        </div>\n      </DocumentStore>\n    </FormContext>\n  );\n};\n\n/**\n * Field with call-to-actions for editing as well as rendering applicable child-nodes\n */\nconst FieldEditor: React.FC<{\n  uuid: number;\n  isRtdb: boolean;\n  areNamesMutable?: boolean;\n  areFieldsMutable?: boolean;\n  startingIndex?: number;\n  supportNestedArrays?: boolean;\n  isJson?: boolean;\n}> = ({\n  uuid,\n  isRtdb,\n  areNamesMutable = true,\n  areFieldsMutable = true,\n  startingIndex = 0,\n  supportNestedArrays = true,\n  isJson = false,\n}) => {\n  const store = useStore();\n  const dispatch = useDispatch();\n  const field = useField(uuid);\n\n  if (isMapField(field)) {\n    const allowedChildTypes = isRtdb ? RTDB_FIELD_TYPES : FIRESTORE_FIELD_TYPES;\n\n    return (\n      <div className=\"DocumentEditor-Map\">\n        <div className=\"DocumentEditor-MapEntries\">\n          {field.mapChildren.map(c => {\n            return (\n              <div className=\"DocumentEditor-MapEntry\" key={c.uuid}>\n                <div className=\"DocumentEditor-MapEntryMetadata\">\n                  <NameEditor\n                    uuid={uuid}\n                    field={field}\n                    childId={c.uuid}\n                    readonly={!areNamesMutable && uuid === store.uuid}\n                  />\n                  <span className=\"Document-TypeSymbol\">=</span>\n                  <ChildTypeSelect\n                    uuid={c.valueId}\n                    allowedTypes={allowedChildTypes}\n                  />\n                </div>\n                <FieldEditor uuid={c.valueId} isRtdb={isRtdb} isJson={isJson} />\n                {areFieldsMutable && (\n                  <IconButton\n                    className=\"DocumentEditor-MapEntryDelete\"\n                    type=\"button\"\n                    icon=\"delete\"\n                    label=\"Remove field\"\n                    onClick={() =>\n                      dispatch(actions.removeFromMap({ uuid, childId: c.uuid }))\n                    }\n                  />\n                )}\n              </div>\n            );\n          })}\n          {areFieldsMutable && (\n            <IconButton\n              label=\"Add field\"\n              type=\"button\"\n              icon=\"add\"\n              onClick={() =>\n                dispatch(\n                  actions.addToMap({\n                    uuid,\n                    name: '',\n                    value: '',\n                  })\n                )\n              }\n            />\n          )}\n        </div>\n      </div>\n    );\n  } else if (isArrayField(field)) {\n    const allowedChildTypes = isRtdb\n      ? RTDB_FIELD_TYPES\n      : supportNestedArrays\n      ? FIRESTORE_FIELD_TYPES\n      : FIRESTORE_ARRAY_FIELD_TYPES;\n\n    return (\n      <div className=\"DocumentEditor-Array\">\n        <div className=\"DocumentEditor-ArrayEntries\">\n          {field.arrayChildren.map((c, index) => {\n            return (\n              <div className=\"DocumentEditor-ArrayEntry\" key={c.uuid}>\n                <div className=\"DocumentEditor-ArrayEntryMetadata\">\n                  <div className=\"DocumentEditor-ArrayIndex\">\n                    <Field\n                      value={index + startingIndex}\n                      label=\"Index\"\n                      disabled\n                    />\n                  </div>\n                  <span className=\"Document-TypeSymbol\">=</span>\n                  <ChildTypeSelect\n                    uuid={c.valueId}\n                    allowedTypes={allowedChildTypes}\n                  />\n                </div>\n                <FieldEditor uuid={c.valueId} isRtdb={isRtdb} />\n                {areFieldsMutable && (\n                  <IconButton\n                    className=\"DocumentEditor-ArrayEntryDelete\"\n                    type=\"button\"\n                    icon=\"delete\"\n                    label=\"Remove field\"\n                    onClick={() =>\n                      dispatch(\n                        actions.removeFromArray({ uuid, childId: c.uuid })\n                      )\n                    }\n                  />\n                )}\n              </div>\n            );\n          })}\n          {areFieldsMutable && (\n            <IconButton\n              label=\"Add field\"\n              type=\"button\"\n              icon=\"add\"\n              onClick={() =>\n                dispatch(\n                  actions.addToArray({\n                    uuid,\n                    value: '',\n                  })\n                )\n              }\n            />\n          )}\n        </div>\n      </div>\n    );\n  } else if (isJSONField(field)) {\n    return (\n      <JsonEditor\n        name={`${uuid}`}\n        value={field.value}\n        onChange={value => dispatch(actions.updateValue({ uuid, value }))}\n      />\n    );\n  } else {\n    const valueEditor =\n      field.value instanceof DocumentPath ? (\n        <ReferenceEditor\n          name={`${uuid}`}\n          value={field.value}\n          onChange={value => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isString(field.value) ? (\n        <StringEditor\n          value={field.value}\n          onChange={value => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isBoolean(field.value) ? (\n        <BooleanEditor\n          value={field.value}\n          onChange={value => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isNumber(field.value) ? (\n        <NumberEditor\n          name={`${uuid}`}\n          value={field.value}\n          onChange={value => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isGeoPoint(field.value) ? (\n        <GeoPointEditor\n          name={`${uuid}`}\n          value={field.value}\n          onChange={value => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isTimestamp(field.value) ? (\n        <TimestampEditor\n          name={`${uuid}`}\n          value={field.value}\n          onChange={value => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : null;\n\n    return <div className=\"DocumentEditor-Primitive\">{valueEditor}</div>;\n  }\n};\n\nconst ChildTypeSelect: React.FC<{\n  uuid: number;\n  allowedTypes: FieldType[];\n}> = ({ uuid, allowedTypes }) => {\n  const field = useField(uuid);\n  const dispatch = useDispatch();\n\n  return (\n    <SelectField\n      label=\"Type\"\n      outlined\n      options={allowedTypes}\n      value={getDocumentFieldType(field)}\n      onChange={e => {\n        dispatch(\n          actions.updateType({ uuid, type: e.currentTarget.value as FieldType })\n        );\n      }}\n    />\n  );\n};\n\nconst NameEditor: React.FC<{\n  uuid: number;\n  field: MapField;\n  childId: number;\n  readonly: boolean;\n}> = ({ uuid, field, childId, readonly }) => {\n  const {\n    register,\n    unregister,\n    errors,\n    clearError,\n    setValue,\n    setError,\n    formState: { touched },\n  } = useFormContext();\n\n  const dispatch = useDispatch();\n  const child = field.mapChildren.find(c => c.uuid === childId);\n  if (!child) {\n    throw new Error('Tried to render a name-edtior for a non-map-child');\n  }\n\n  const formName = `${childId}`;\n\n  const siblingNames = React.useMemo(() => {\n    return field.mapChildren.filter(c => c.uuid !== childId).map(c => c.name);\n  }, [field, childId]);\n\n  useEffect(() => {\n    register(formName);\n    return () => unregister(formName);\n  }, [register, unregister, formName]);\n\n  useEffect(() => {\n    // Validate `name` when siblings change\n    const isUnique = siblingNames.every(name => name !== child.name);\n    if (!child.name) {\n      setError(formName, 'required', 'Required');\n    } else if (!isUnique) {\n      setError(formName, 'unique', 'Must be unique');\n    } else {\n      clearError(formName);\n    }\n  }, [child, siblingNames, formName, setError, clearError]);\n\n  return (\n    <Field\n      label=\"Field\"\n      outlined\n      value={child.name}\n      disabled={readonly}\n      onChange={e => {\n        setValue(formName, e.currentTarget.value);\n        dispatch(\n          actions.updateName({\n            uuid,\n            childId,\n            name: e.currentTarget.value,\n          })\n        );\n      }}\n      // Show the `unique` error regardless of the field having been\n      // touched; in case another field's name was updated to now conflict\n      error={\n        (touched[formName] || errors[formName]?.type === 'unique') &&\n        errors[formName]?.message\n      }\n    />\n  );\n};\n\nfunction getDocumentFieldType(field: DocumentField): FieldType {\n  if (isMapField(field)) {\n    return FieldType.MAP;\n  } else if (isArrayField(field)) {\n    return FieldType.ARRAY;\n  } else if (isJSONField(field)) {\n    return FieldType.JSON;\n  } else {\n    if (field.value instanceof DocumentPath) {\n      return FieldType.REFERENCE;\n    }\n    return getFieldType(field.value);\n  }\n}\n\n//\nexport default DocumentEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './InlineEditor.scss';\n\nimport {\n  Card,\n  CardActionButton,\n  CardActionButtons,\n  CardActions,\n} from '@rmwc/card';\nimport { Elevation } from '@rmwc/elevation';\nimport React, { useState } from 'react';\nimport { FocusOn } from 'react-focus-on';\n\nimport DocumentEditor from '../DocumentEditor';\nimport { FirestoreAny } from '../models';\n\n/** Editor entry point for a selected field */\nconst InlineEditor: React.FC<{\n  value: FirestoreAny;\n  onCancel: () => void;\n  onSave: (key: string, value: FirestoreAny) => void;\n  areRootKeysMutable: boolean;\n  rtdb?: boolean;\n  startingIndex?: number;\n}> = ({ value, onCancel, onSave, areRootKeysMutable, rtdb, startingIndex }) => {\n  const [internalValue, setInternalValue] = useState<\n    FirestoreAny | undefined\n  >();\n\n  function handleChange(value: FirestoreAny | undefined) {\n    setInternalValue(value);\n  }\n\n  function handleCancel() {\n    onCancel();\n  }\n\n  function handleSubmit(e: React.MouseEvent<HTMLButtonElement>) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (internalValue) {\n      onSave(Object.keys(internalValue)[0], Object.values(internalValue)[0]);\n    }\n  }\n\n  return (\n    <FocusOn\n      className=\"Firestore-InlineEditor-relative-anchor\"\n      onClickOutside={handleCancel}\n      onEscapeKey={handleCancel}\n    >\n      <Elevation z={8} wrap>\n        <Card\n          className=\"Firestore-InlineEditor\"\n          tag=\"form\"\n          onSubmit={handleSubmit}\n        >\n          <div className=\"Firestore-InlineEditorContent\">\n            <DocumentEditor\n              value={value}\n              onChange={handleChange}\n              areRootNamesMutable={areRootKeysMutable}\n              areRootFieldsMutable={false}\n              rtdb={rtdb}\n              startingIndex={startingIndex}\n              supportNestedArrays={false}\n            />\n          </div>\n          <CardActions className=\"Firestore-InlineEditorActions\">\n            <CardActionButtons>\n              <CardActionButton type=\"button\" onClick={handleCancel}>\n                Cancel\n              </CardActionButton>\n              <CardActionButton\n                type=\"submit\"\n                unelevated\n                disabled={!internalValue}\n              >\n                Save\n              </CardActionButton>\n            </CardActionButtons>\n          </CardActions>\n        </Card>\n      </Elevation>\n    </FocusOn>\n  );\n};\n\nexport default InlineEditor;\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './NodeLink.scss';\n\nimport { Typography } from '@rmwc/typography';\nimport * as React from 'react';\nimport { Link, matchPath, useRouteMatch } from 'react-router-dom';\n\nimport { getDbRootUrl } from './common/view_model';\n\nexport interface Props {\n  dbRef: firebase.database.Reference;\n}\n\nexport const NodeLink = React.memo<Props>(function NodeLink$({ dbRef }) {\n  const key = dbRef.key || getDbRootUrl(dbRef);\n  const path = new URL(dbRef.toString()).pathname;\n  const href = useHrefWithinSameRoute(path);\n  return (\n    <Typography\n      className=\"NodeLink\"\n      use=\"body1\"\n      aria-label=\"Key name\"\n      tag={Link}\n      to={href}\n    >\n      {key}\n    </Typography>\n  );\n});\n\n/**\n * Creates a href that replaces the `/:path*` part of the current `<Route>`\n *\n * e.g. `/database/sample/data/a/b/c` -> `/database/sample/data/x/y/z`\n */\nfunction useHrefWithinSameRoute(absolutePath: string) {\n  const match = useRouteMatch();\n\n  // remove the wildcard :path param, so we can append it manually\n  const withoutPath = match.path.replace('/:path*', '');\n\n  const result = matchPath(match.url, { path: withoutPath, strict: true });\n  const baseUrl = result?.url || '';\n  return baseUrl === '/' ? absolutePath : `${baseUrl}${absolutePath}`;\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './ValueDisplay.scss';\n\nimport { Typography, TypographyProps } from '@rmwc/typography';\nimport * as React from 'react';\nimport { DOMAttributes } from 'react';\n\nexport interface Props extends DOMAttributes<HTMLSpanElement>, TypographyProps {\n  value: string | number | boolean | null;\n}\n\nexport const ValueDisplay = React.memo<Props>(function ValueDisplay$({\n  value,\n  use,\n  ...otherProps\n}) {\n  const trimmedValue =\n    typeof value === 'string' && value.length >= 24\n      ? `${value.substr(0, 21)}...`\n      : value;\n\n  const getClass = (value: Props['value']) =>\n    `ValueDisplay ValueDisplay__${typeof value}`;\n  return (\n    <Typography\n      use=\"body1\"\n      className={getClass(value)}\n      {...otherProps}\n      aria-label=\"Node value\"\n    >\n      {JSON.stringify(trimmedValue)}\n    </Typography>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './NodeLeaf.scss';\n\nimport { IconButton } from '@rmwc/icon-button';\nimport { Tooltip } from '@rmwc/tooltip';\nimport * as React from 'react';\nimport { useState } from 'react';\n\nimport InlineEditor from '../../Firestore/DocumentPreview/InlineEditor';\nimport { FirestoreAny } from '../../Firestore/models';\nimport { NodeLink } from './NodeLink';\nimport { ValueDisplay } from './ValueDisplay';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  value: string | boolean | number | null;\n}\n\nexport const NodeLeaf = React.memo<Props>(function NodeLeaf$({\n  value,\n  realtimeRef,\n}) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const handleEdit = () => {\n    setIsEditing(!isEditing);\n  };\n\n  const handleEditSuccess = async (key: string, value: FirestoreAny) => {\n    await realtimeRef.set(value);\n    setIsEditing(false);\n  };\n\n  const handleAdd = () => {\n    setIsAdding(!isAdding);\n  };\n\n  const handleAddSuccess = async (key: string, value: FirestoreAny) => {\n    await realtimeRef.child(key).set(value);\n    setIsAdding(false);\n  };\n\n  const handleDelete = async () => {\n    try {\n      await realtimeRef.remove();\n    } catch (e) {\n      throw e;\n    }\n  };\n\n  const showAddButton = !realtimeRef.parent && value === null;\n  return (\n    <div className=\"NodeLeaf\">\n      <div className=\"NodeLeaf__key\">\n        <NodeLink dbRef={realtimeRef} />\n        {': '}\n        <ValueDisplay use=\"body1\" value={value} onClick={handleEdit} />\n      </div>\n      <span className=\"NodeLeaf__actions\">\n        <Tooltip content=\"Edit value\">\n          <IconButton\n            icon=\"edit\"\n            onClick={handleEdit}\n            aria-label=\"Edit value\"\n          />\n        </Tooltip>\n        {showAddButton && (\n          <Tooltip content=\"Add child\">\n            <IconButton icon=\"add\" onClick={handleAdd} aria-label=\"Add child\" />\n          </Tooltip>\n        )}\n        <Tooltip content=\"Delete value\">\n          <IconButton\n            icon=\"delete\"\n            onClick={handleDelete}\n            aria-label=\"Delete value\"\n          />\n        </Tooltip>\n      </span>\n      <div className=\"NodeLeaf__edit-ui\">\n        {isEditing && (\n          <InlineEditor\n            rtdb\n            value={{\n              [realtimeRef.key || realtimeRef.toString()]:\n                value === null ? '' : value,\n            }}\n            onCancel={() => setIsEditing(false)}\n            onSave={handleEditSuccess}\n            areRootKeysMutable={false}\n          />\n        )}\n        {isAdding && (\n          <InlineEditor\n            rtdb\n            value={{ [realtimeRef.push().key!]: '' }}\n            onCancel={() => setIsAdding(false)}\n            onSave={handleAddSuccess}\n            areRootKeysMutable={true}\n          />\n        )}\n      </div>\n    </div>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ok } from 'assert';\n\nimport { Checkbox } from '@rmwc/checkbox';\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport { TextField } from '@rmwc/textfield';\nimport { Typography } from '@rmwc/typography';\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\n\nimport { Field } from '../../common/Field';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  query?: firebase.database.Query;\n  /**\n   * Called when complete, if the data was cloned the key is returned, else\n   * undefined.\n   */\n  onComplete: (string?: string) => void;\n}\n\n/**\n * Strips protocol and domain name (usually http://localhost:9000/)\n * from the ref's path\n * @example \"localhost:9000/todos/one\" -> \"/todos/one\"\n * @param ref\n */\nconst getAbsoluteRefPath = (ref: firebase.database.Reference) => {\n  return new URL(ref.toString()).pathname;\n};\n\n/**\n * Returns a key value that is either a new push id if the current\n * ref's key is a push id or a \"copy\" key if not.\n * @param key\n * @param ref\n */\nconst cloneKey = (key: string, ref: firebase.database.Reference) => {\n  return key.startsWith('-')\n    ? `${getAbsoluteRefPath(ref.parent!)}/${ref.push().key!}`\n    : `${getAbsoluteRefPath(ref)}_copy`;\n};\n\nexport const CloneDialog = React.memo<Props>(function CloneDialog$({\n  realtimeRef,\n  query,\n  onComplete,\n}) {\n  ok(realtimeRef.parent, 'Cannot clone the root node!');\n\n  // queries only exist if queryParams are passed into the dialog\n  let hasQuery = query != null;\n\n  const originalKey = realtimeRef.key!;\n  const [newDestinationPath, setNewDestinationPath] = useState('');\n\n  const [form, setForm] = useState<Record<string, string>>({});\n  const [isLoading, setIsLoading] = useState(true);\n  const [isCloningWithFiltered, setCloningFiltered] = useState(hasQuery);\n\n  useEffect(() => {\n    const loadData = async () => {\n      let snapshot = null;\n      // only apply the query if the user has selected the checkbox\n      // and the query has been passed as a prop\n      if (query != null && isCloningWithFiltered) {\n        snapshot = await query.once('value');\n      } else {\n        snapshot = await realtimeRef.once('value');\n      }\n      const data: Record<string, string> = {};\n      Object.entries(snapshot.val() || {}).forEach(([key, val]) => {\n        data[key] = JSON.stringify(val);\n      });\n      setForm(data);\n      setNewDestinationPath(cloneKey(originalKey, realtimeRef));\n      setIsLoading(false);\n    };\n    loadData();\n  }, [\n    setIsLoading,\n    setForm,\n    setNewDestinationPath,\n    originalKey,\n    realtimeRef,\n    isCloningWithFiltered,\n    query,\n  ]);\n\n  const updateField = (e: React.FormEvent<HTMLInputElement>) => {\n    const target = e.target as HTMLInputElement;\n    setForm({\n      ...form,\n      [target.name]: target.value,\n    });\n  };\n\n  const handleSubmit = (e: React.FormEvent<HTMLElement>) => {\n    e.preventDefault();\n    const data: Record<string, any> = {};\n    Object.entries(form).forEach(([key, value]) => {\n      data[key] = JSON.parse(value);\n    });\n    realtimeRef.root.child(newDestinationPath).set(data);\n\n    onComplete(newDestinationPath);\n  };\n\n  return (\n    <Dialog open>\n      <form onSubmit={handleSubmit}>\n        <DialogTitle>Clone \"{originalKey}\"</DialogTitle>\n        <DialogContent>\n          <Field\n            label=\"New destination path:\"\n            value={newDestinationPath}\n            onChange={e =>\n              setNewDestinationPath((e.target as HTMLInputElement).value)\n            }\n            type=\"text\"\n          />\n\n          {hasQuery ? (\n            <div>\n              <Checkbox\n                label=\"Clone filtered data set\"\n                checked={isCloningWithFiltered}\n                onChange={event => {\n                  setCloningFiltered(!!event.currentTarget.checked);\n                }}\n              />\n            </div>\n          ) : null}\n\n          <Typography use=\"headline6\">Data</Typography>\n          {isLoading\n            ? 'Loading...'\n            : Object.entries(form).map(([key, val]) => (\n                <div key={key}>\n                  <label>\n                    {key}:\n                    <TextField\n                      name={key}\n                      type=\"text\"\n                      value={val}\n                      onChange={updateField}\n                      placeholder=\"JSON or simple text\"\n                    />\n                  </label>\n                </div>\n              ))}\n        </DialogContent>\n        <DialogActions>\n          <DialogButton\n            type=\"button\"\n            action=\"close\"\n            theme=\"secondary\"\n            onClick={() => onComplete()}\n          >\n            Cancel\n          </DialogButton>\n          <DialogButton unelevated action=\"accept\">\n            Clone\n          </DialogButton>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './InlineQuery.scss';\n\nimport {\n  Card,\n  CardActionButton,\n  CardActionButtons,\n  CardActions,\n} from '@rmwc/card';\nimport keycode from 'keycode';\nimport * as React from 'react';\nimport { useEffect, useRef, useState } from 'react';\n\nimport { Field, SelectField } from '../../common/Field';\nimport {\n  DEFAULT_PAGE_SIZE,\n  DEFAULT_QUERY_PARAMS,\n  QueryParams,\n  jsonIshValue,\n} from './common/view_model';\n\nexport interface Props {\n  params?: QueryParams;\n  onSubmit: (params: QueryParams) => void;\n  onCancel: () => void;\n}\n\ntype FormData = { [K in keyof QueryParams]: string };\n\nexport const InlineQuery = React.memo<Props>(function InlineQuery$({\n  params = {},\n  onSubmit,\n  onCancel,\n}) {\n  const {\n    key = '',\n    operator = '==',\n    value = '',\n    limit = DEFAULT_PAGE_SIZE,\n  } = params;\n\n  const [form, setValues] = useState<FormData>({\n    key,\n    operator,\n    value: JSON.stringify(value),\n    limit: `${limit}`,\n  });\n\n  const updateField = (\n    e: React.FormEvent<HTMLInputElement | HTMLSelectElement>\n  ) => {\n    const target = e.target as HTMLInputElement;\n    setValues({\n      ...form,\n      [target.name]: target.value,\n    });\n  };\n\n  const submitForm = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    onSubmit && onSubmit(toParams(form));\n  };\n\n  const cancelOnEscape = (e: React.KeyboardEvent) => {\n    if (e.keyCode === keycode('esc')) {\n      onCancel && onCancel();\n    }\n  };\n\n  const keyInputRef = useRef<HTMLInputElement>(null);\n  const valueInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (key) {\n      valueInputRef.current!.focus();\n      valueInputRef.current!.select();\n    } else {\n      keyInputRef.current!.focus();\n      keyInputRef.current!.select();\n    }\n  }, [key]);\n\n  return (\n    <Card\n      className=\"InlineQuery InlineQuery__card\"\n      tag=\"form\"\n      onSubmit={submitForm}\n      onKeyDown={cancelOnEscape}\n    >\n      <div className=\"InlineQuery__form-fields\">\n        <Field\n          outlined\n          label=\"Key\"\n          name=\"key\"\n          value={form.key}\n          onChange={updateField}\n          inputRef={keyInputRef}\n        />\n        <SelectField\n          label=\"Condition\"\n          name=\"operator\"\n          options={['==', '>=', '<=']}\n          value={form.operator}\n          onChange={updateField}\n        />\n        <Field\n          label=\"Value\"\n          name=\"value\"\n          value={form.value}\n          onChange={updateField}\n          inputRef={valueInputRef}\n          placeholder=\"JSON or plain text\"\n        />\n        <Field\n          label=\"limit\"\n          name=\"limit\"\n          value={form.limit}\n          onChange={updateField}\n        />\n      </div>\n      <CardActions className=\"InlineQuery__actions\">\n        <CardActionButtons>\n          {params !== DEFAULT_QUERY_PARAMS && (\n            <CardActionButton\n              type=\"button\"\n              label=\"Reset\"\n              danger\n              onClick={() => onSubmit(DEFAULT_QUERY_PARAMS)}\n            />\n          )}\n          <CardActionButton\n            theme=\"secondary\"\n            type=\"button\"\n            label=\"Cancel\"\n            onClick={() => onCancel && onCancel()}\n          />\n          <CardActionButton unelevated type=\"submit\" label=\"Search\" />\n        </CardActionButtons>\n      </CardActions>\n    </Card>\n  );\n});\n\nfunction toParams(form: FormData): QueryParams {\n  const { key, operator, value, limit } = form;\n  return {\n    key,\n    operator: operator as QueryParams['operator'],\n    value: jsonIshValue(value || 'null'),\n    limit: Number(limit),\n  };\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport * as React from 'react';\nimport { useState } from 'react';\n\nimport { Field } from '../../common/Field';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  isOpen: boolean;\n  onComplete: (didRename: boolean) => void;\n}\n\nexport const RenameDialog = React.memo<Props>(function RenameDialog$({\n  realtimeRef,\n  isOpen,\n  onComplete,\n}) {\n  const originalKey = realtimeRef.key!;\n  const [form, setForm] = useState<Record<string, string>>({\n    newKey: originalKey,\n  });\n\n  const updateField = (e: React.FormEvent<HTMLInputElement>) => {\n    const target = e.target as HTMLInputElement;\n    setForm({\n      ...form,\n      [target.name]: target.value,\n    });\n  };\n\n  const onSubmit = async (e: React.FormEvent<HTMLElement>) => {\n    e.preventDefault();\n    const snap = await realtimeRef.once('value');\n    try {\n      await realtimeRef.parent!.update({\n        [form.newKey]: snap.val(),\n        [originalKey]: null,\n      });\n    } catch (e) {\n      // TODO: handle error state\n    }\n    onComplete(true);\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={() => onComplete(false)}>\n      <form onSubmit={onSubmit}>\n        <DialogTitle>Rename \"{originalKey}\"</DialogTitle>\n        <DialogContent onSubmit={onSubmit}>\n          <Field\n            name=\"newKey\"\n            label=\"New key:\"\n            value={form.newKey}\n            onChange={updateField}\n            type=\"text\"\n          />\n        </DialogContent>\n        <DialogActions>\n          <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n            Cancel\n          </DialogButton>\n          <DialogButton type=\"submit\" unelevated>\n            Rename\n          </DialogButton>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport '@material/data-table/dist/mdc.data-table.css';\nimport '@rmwc/data-table/styles';\n\nimport './NodeTabularDisplay.scss';\n\nimport { Button } from '@rmwc/button';\nimport {\n  DataTable,\n  DataTableBody,\n  DataTableCell,\n  DataTableContent,\n  DataTableHead,\n  DataTableHeadCell,\n  DataTableRow,\n} from '@rmwc/data-table';\nimport { Typography } from '@rmwc/typography';\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\n\nimport { DEFAULT_PAGE_SIZE } from './common/view_model';\nimport { NodeLink } from './NodeLink';\nimport { ValueDisplay } from './ValueDisplay';\n\nexport interface Props {\n  hasMoreRows?: boolean;\n  query: firebase.database.Query;\n  onLoadMore?: () => void;\n}\n\nenum TableType {\n  KeyValue = 'kvp',\n  KeyObject = 'ko',\n  Array = 'arr',\n}\n\ninterface Table {\n  type: TableType;\n  headers: string[];\n  rows: { pkId: string; value: any }[];\n}\n\nexport const NodeTabularDisplay = React.memo<Props>(\n  function NodeTabularDisplay$({ query, hasMoreRows, onLoadMore }) {\n    const [table, setTable] = useState<Table>({\n      type: TableType.Array,\n      headers: [],\n      rows: [],\n    });\n\n    const raiseOnLoadMore = () => onLoadMore && onLoadMore();\n\n    useEffect(() => {\n      (async () => {\n        setTable(await buildTable(query));\n      })();\n    }, [query]);\n\n    return (\n      <DataTable className=\"NodeTabularDisplay\">\n        <DataTableContent>\n          <DataTableHead>\n            <DataTableRow>\n              {table.headers.map((header, i) => (\n                <DataTableHeadCell key={i}>\n                  <Typography use=\"body1\">{header}</Typography>\n                </DataTableHeadCell>\n              ))}\n            </DataTableRow>\n          </DataTableHead>\n          <DataTableBody>\n            {table.rows.map((row, idx) => (\n              <DataTableRow key={idx}>\n                {table.headers.map((header, i) =>\n                  getColumnValue(table, row, header, i, query.ref)\n                )}\n              </DataTableRow>\n            ))}\n          </DataTableBody>\n          {hasMoreRows && (\n            <DataTableHead>\n              <DataTableRow>\n                <DataTableCell colSpan={table.headers.length}>\n                  <Button onClick={() => raiseOnLoadMore()}>Load More</Button>\n                </DataTableCell>\n              </DataTableRow>\n            </DataTableHead>\n          )}\n        </DataTableContent>\n      </DataTable>\n    );\n  }\n);\n\nfunction getColumnValue(\n  table: Table,\n  row: { pkId: string; value: any },\n  key: string,\n  colIndex: number,\n  ref: firebase.database.Reference\n) {\n  if (colIndex === 0) {\n    return (\n      <DataTableCell key={key}>\n        <Typography use=\"body2\" className=\"NodeTabularDisplay__key\">\n          <NodeLink dbRef={ref.child(row.pkId)} />\n        </Typography>\n      </DataTableCell>\n    );\n  }\n\n  const value =\n    table.type === TableType.KeyValue || table.type === TableType.Array\n      ? row.value\n      : row.value[key];\n\n  switch (typeof value) {\n    case 'undefined':\n      return <DataTableCell className=\"undef\" key={key} />;\n    case 'object':\n      return (\n        <DataTableCell className=\"object\" key={key}>\n          <Typography use=\"body2\">{'{ ... }'}</Typography>\n        </DataTableCell>\n      );\n    default:\n      return (\n        <DataTableCell className={typeof value} key={key}>\n          <ValueDisplay value={value} use=\"body2\" />\n        </DataTableCell>\n      );\n  }\n}\n\nasync function buildTable(query: firebase.database.Query): Promise<Table> {\n  const snap = await query.once('value');\n  const data = snap.val();\n\n  // empty filter results\n  if (data === undefined || data === null) {\n    return {\n      type: TableType.KeyValue,\n      headers: ['No Data Available'],\n      rows: [{ pkId: 'value is undefined', value: 'Value is undefined' }],\n    };\n  }\n\n  const entries = Object.entries(data);\n  const type = getTableType(entries);\n\n  return {\n    type,\n    headers: getHeaders(type, entries),\n    rows: entries.map(([key, value]) => ({ pkId: key, value })),\n  };\n}\n\nfunction getTableType(entries: [string, unknown][]) {\n  const [key, value] = entries[0];\n\n  if (!isNaN(parseInt(key))) {\n    return TableType.Array;\n  } else if (typeof value === 'object') {\n    return TableType.KeyObject;\n  } else {\n    return TableType.KeyValue;\n  }\n}\n\nfunction getHeaders(type: TableType, entries: [string, any][]) {\n  const [, value] = entries[0];\n  switch (type) {\n    case TableType.KeyValue:\n      return ['key', 'value'];\n    case TableType.Array:\n      return ['', 'value'];\n    default:\n      return ['key', ...Object.keys(value)];\n  }\n}\n\nexport function isArrayLike(childKeys: string[]) {\n  if (childKeys.length <= 1) {\n    return false;\n  }\n\n  const halfOfList = childKeys.slice(0, DEFAULT_PAGE_SIZE * 2).sort();\n\n  const isArrayIndex = (v: string, i: number) => v === i.toString();\n  const isPushId = (v: string) => v.length === 20 && v[0] === '-';\n\n  return halfOfList.every(isPushId) || halfOfList.every(isArrayIndex);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon } from '@rmwc/icon';\nimport { IconButton } from '@rmwc/icon-button';\nimport { MenuItem, SimpleMenu } from '@rmwc/menu';\nimport { Tooltip } from '@rmwc/tooltip';\nimport * as React from 'react';\nimport { useState } from 'react';\n\nimport InlineEditor from '../../Firestore/DocumentPreview/InlineEditor';\nimport { FirestoreAny } from '../../Firestore/models';\nimport { CloneDialog } from './CloneDialog';\nimport { applyQuery } from './common/fetch';\nimport {\n  ChildrenDisplayType,\n  DEFAULT_QUERY_PARAMS,\n  QueryParams,\n} from './common/view_model';\nimport { InlineQuery } from './InlineQuery';\nimport { RenameDialog } from './RenameDialog';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  displayType: ChildrenDisplayType;\n  queryParams?: QueryParams;\n  updateQuery?: (params: QueryParams) => void;\n  onDisplayTypeChange: (displayType: ChildrenDisplayType) => void;\n  onExpandRequested: () => void;\n}\n\nconst getNextDisplayType = (current: ChildrenDisplayType) => {\n  return current === ChildrenDisplayType.Table\n    ? ChildrenDisplayType.TreeView\n    : ChildrenDisplayType.Table;\n};\n\nconst getToggleIcon = (current: ChildrenDisplayType) => {\n  switch (current) {\n    case ChildrenDisplayType.Table:\n      return 'view_comfy';\n    case ChildrenDisplayType.TreeView:\n      return 'view_list';\n    default:\n      throw new Error(`Display type is unrecognized`);\n  }\n};\n\nconst ACTIVE_ICON = { color: '#09d3ac' };\n\nexport const NodeActions = React.memo<Props>(function NodeActions$({\n  displayType,\n  onDisplayTypeChange,\n  realtimeRef,\n  updateQuery,\n  onExpandRequested,\n  queryParams,\n}) {\n  const [isMenuOpen, setMenuOpen] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const [showQueryUi, setShowQueryUi] = useState(false);\n  const [cloneDialogIsOpen, setCloneDialogIsOpen] = useState(false);\n  const [renameDialogIsOpen, setRenameDialogIsOpen] = useState(false);\n\n  const isActive =\n    isMenuOpen ||\n    isAdding ||\n    showQueryUi ||\n    cloneDialogIsOpen ||\n    renameDialogIsOpen ||\n    queryParams !== DEFAULT_QUERY_PARAMS;\n  const isRoot = realtimeRef.parent === null;\n\n  const pushId = realtimeRef.push().key!;\n  const handleAddSuccess = async (key: string, value: FirestoreAny) => {\n    await realtimeRef.child(key).set(value);\n    setIsAdding(false);\n  };\n  const addChild = () => {\n    onExpandRequested();\n    setIsAdding(!isAdding);\n  };\n\n  const removeNode = async () => {\n    try {\n      await realtimeRef.remove();\n    } catch (e) {\n      throw e;\n    }\n  };\n\n  const showQueryUiAndExpand = () => {\n    onExpandRequested();\n    setShowQueryUi(true);\n  };\n\n  const toggleTable = () => {\n    onDisplayTypeChange(getNextDisplayType(displayType));\n  };\n\n  const potentialQuery = React.useMemo(\n    () => applyQuery(realtimeRef, queryParams || {}),\n    [realtimeRef, queryParams]\n  );\n\n  return (\n    <aside className={'NodeActions' + (isActive ? ' NodeActions--active' : '')}>\n      <Tooltip content=\"Filter children\">\n        <IconButton\n          icon=\"filter_list\"\n          onIcon={<span style={ACTIVE_ICON}>filter_list</span>}\n          onClick={() => showQueryUiAndExpand()}\n          checked={queryParams !== DEFAULT_QUERY_PARAMS}\n        />\n      </Tooltip>\n      <Tooltip content=\"Add child\">\n        <IconButton icon=\"add\" onClick={addChild} />\n      </Tooltip>\n      {!isRoot ? (\n        <Tooltip content=\"Switch view\">\n          <IconButton\n            icon={getToggleIcon(getNextDisplayType(displayType))}\n            onClick={() => toggleTable()}\n          />\n        </Tooltip>\n      ) : null}\n      <SimpleMenu\n        renderToPortal={\n          /*\n           * Actions show on hover, so hoisting has some weird effects, popping\n           * in and out of the top left corner\n           */\n          false\n        }\n        handle={<IconButton icon=\"more_vert\" />}\n        onOpen={() => setMenuOpen(true)}\n        onClose={() => setMenuOpen(false)}\n      >\n        <MenuItem onClick={removeNode}>\n          <Icon icon=\"delete\" /> Remove\n        </MenuItem>\n        {!isRoot && (\n          <MenuItem onClick={() => setCloneDialogIsOpen(true)}>\n            <Icon icon=\"file_copy\" /> Clone\n          </MenuItem>\n        )}\n        {!isRoot && (\n          <MenuItem onClick={() => setRenameDialogIsOpen(true)}>\n            <Icon icon=\"edit\" /> Rename\n          </MenuItem>\n        )}\n      </SimpleMenu>\n\n      {/* Extra UI that shows when actions are triggered */}\n      <div className=\"NodeActions__additional-ui\">\n        {isAdding && (\n          <InlineEditor\n            rtdb\n            value={{ [pushId]: '' }}\n            onCancel={() => setIsAdding(false)}\n            onSave={handleAddSuccess}\n            areRootKeysMutable={true}\n          />\n        )}\n        {showQueryUi && (\n          <InlineQuery\n            params={queryParams}\n            onSubmit={params => {\n              updateQuery && updateQuery(params);\n              setShowQueryUi(false);\n            }}\n            onCancel={() => setShowQueryUi(false)}\n          />\n        )}\n        {cloneDialogIsOpen && (\n          <CloneDialog\n            realtimeRef={realtimeRef}\n            query={potentialQuery}\n            onComplete={() => setCloneDialogIsOpen(false)}\n          />\n        )}\n        {!isRoot && (\n          <RenameDialog\n            realtimeRef={realtimeRef}\n            isOpen={renameDialogIsOpen}\n            onComplete={() => setRenameDialogIsOpen(false)}\n          />\n        )}\n      </div>\n    </aside>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './NodeParent.scss';\n\nimport { Button } from '@rmwc/button';\nimport * as React from 'react';\nimport { useCallback, useState } from 'react';\n\nimport {\n  ChildrenDisplayType,\n  DEFAULT_PAGE_SIZE,\n  QueryParams,\n} from './common/view_model';\nimport { NodeActions } from './NodeActions';\nimport { NodeContainer } from './NodeContainer';\nimport { NodeLink } from './NodeLink';\nimport { NodeTabularDisplay } from './NodeTabularDisplay';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  children: string[];\n  isRealtime?: boolean;\n  queryParams?: QueryParams;\n  /**\n   * This node is the top most visible node in viewer (not the same as the real\n   * db root). It will show breadcrumbs of all hidden parent nodes to the root.\n   */\n  isViewRoot?: boolean;\n  updateQuery?: (params: QueryParams) => void;\n  query?: firebase.database.Query;\n}\n\nexport const NodeParent = React.memo<Props>(function NodeParent$({\n  realtimeRef,\n  children,\n  queryParams,\n  updateQuery,\n  isViewRoot,\n  query,\n}) {\n  const isRoot = realtimeRef.parent === null;\n  const hasChildren = !!children.length;\n  const [isExpanded, setIsExpanded] = useState(\n    isRoot || isViewRoot ? true : false\n  );\n  const [displayType, setDisplayType] = useState(ChildrenDisplayType.TreeView);\n\n  const hasMore =\n    queryParams && queryParams.limit\n      ? children.length >= queryParams.limit\n      : children.length >= DEFAULT_PAGE_SIZE;\n\n  const loadMore = () => {\n    const currentPageSize = queryParams\n      ? queryParams.limit || DEFAULT_PAGE_SIZE\n      : DEFAULT_PAGE_SIZE;\n    updateQuery &&\n      updateQuery({\n        ...queryParams,\n        limit: currentPageSize + DEFAULT_PAGE_SIZE,\n      });\n  };\n\n  const toggleExpansion = useCallback(() => setIsExpanded(!isExpanded), [\n    setIsExpanded,\n    isExpanded,\n  ]);\n\n  return (\n    <div className=\"NodeParent\">\n      {/* Label */}\n      <div className=\"NodeParent__label\">\n        {isExpanded ? (\n          <button\n            className=\"NodeParent__tree-button material-icons\"\n            aria-label=\"less\"\n            onClick={toggleExpansion}\n          >\n            arrow_drop_down\n          </button>\n        ) : (\n          <button\n            className=\"NodeParent__tree-button material-icons\"\n            aria-label=\"more\"\n            onClick={toggleExpansion}\n          >\n            arrow_right\n          </button>\n        )}\n        <NodeLink dbRef={realtimeRef} />\n        <NodeActions\n          realtimeRef={realtimeRef}\n          displayType={displayType}\n          onDisplayTypeChange={type => {\n            setDisplayType(type);\n            setIsExpanded(true);\n          }}\n          onExpandRequested={() => setIsExpanded(true)}\n          queryParams={queryParams}\n          updateQuery={updateQuery}\n        />\n      </div>\n      <div className=\"NodeParent__children-container\">\n        {hasChildren &&\n          isExpanded &&\n          (displayType === ChildrenDisplayType.Table ? (\n            <NodeTabularDisplay\n              query={query || realtimeRef}\n              hasMoreRows={hasMore}\n              onLoadMore={loadMore}\n            />\n          ) : (\n            <ul className=\"NodeParent__children\">\n              {children.map(key => (\n                <li key={key}>\n                  <NodeContainer realtimeRef={realtimeRef.child(key)} />\n                </li>\n              ))}\n              {hasMore && (\n                <li className=\"load-more\">\n                  <Button onClick={loadMore}>Load more...</Button>\n                </li>\n              )}\n            </ul>\n          ))}\n      </div>\n    </div>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as firebase from 'firebase/app';\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { Subject } from 'rxjs';\n\nimport { canDoRealtime, createViewModel } from './common/fetch';\nimport {\n  DEFAULT_QUERY_PARAMS,\n  QueryParams,\n  ViewModel,\n} from './common/view_model';\nimport { NodeLeaf } from './NodeLeaf';\nimport { NodeParent } from './NodeParent';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  /**\n   * This node is the top most visible node in viewer (not the same as the real\n   * db root). It will show breadcrumbs of all hidden parent nodes to the root.\n   */\n  isViewRoot?: boolean;\n}\n\nconst initialState: ViewModel = {\n  isLoading: true,\n  children: [],\n};\n\nexport const NodeContainer = React.memo<Props>(function NodeContainer$({\n  realtimeRef,\n  isViewRoot,\n}) {\n  const [viewModel, setViewModel] = useState<ViewModel>(initialState);\n  const [querySubject, setQuerySubject] = useState<\n    Subject<QueryParams> | undefined\n  >(undefined);\n\n  useEffect(() => {\n    const canDoRealtime$ = canDoRealtime(realtimeRef);\n    const { query, viewModel$ } = createViewModel(realtimeRef, canDoRealtime$);\n    setQuerySubject(query);\n    const sub = viewModel$.subscribe(vm => setViewModel(vm));\n    return () => sub.unsubscribe();\n  }, [realtimeRef]);\n\n  const updateQuery = (q: QueryParams) => {\n    setQueryParams(q);\n    querySubject && querySubject.next(q);\n  };\n\n  const [queryParams, setQueryParams] = useState(DEFAULT_QUERY_PARAMS);\n\n  const { children, query } = viewModel;\n  const hasChildren = !!children.length;\n  const isFiltered = queryParams !== DEFAULT_QUERY_PARAMS;\n  return !hasChildren && !isFiltered ? (\n    <NodeLeaf realtimeRef={realtimeRef} value={viewModel.value!} />\n  ) : (\n    <NodeParent\n      realtimeRef={realtimeRef}\n      children={children}\n      queryParams={queryParams}\n      updateQuery={updateQuery}\n      isViewRoot={isViewRoot}\n      query={query}\n    />\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconButton } from '@rmwc/icon-button';\nimport { MenuItem, SimpleMenu } from '@rmwc/menu';\nimport * as firebase from 'firebase/app';\nimport React, { useEffect, useState } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { useHistory } from 'react-router-dom';\n\nimport { initDatabase } from '../../firebase';\nimport { DatabaseConfig } from '../../store/config';\nimport { InteractiveBreadCrumbBar } from '../common/InteractiveBreadCrumbBar';\nimport { DatabaseApi } from './api';\nimport { ImportDialog } from './DataViewer/ImportDialog';\nimport { NodeContainer } from './DataViewer/NodeContainer';\n\nexport interface PropsFromState {\n  namespace: string;\n  path?: string;\n  config: DatabaseConfig;\n}\n\nexport type Props = PropsFromState;\n\nconst getPrefix = (ref: firebase.database.Reference) => {\n  const base = ref.root.toString();\n  return base.substring(0, base.length - 1);\n};\n\nexport const Database: React.FC<Props> = ({ config, namespace, path }) => {\n  const [ref, setRef] = useState<firebase.database.Reference | undefined>(\n    undefined\n  );\n  const [api, setApi] = useState<DatabaseApi | undefined>(undefined);\n\n  const history = useHistory();\n\n  const [importDialogOpen, setImportDialogOpen] = useState(false);\n  const [droppedFile, setDroppedFile] = useState<File | undefined>();\n\n  const closeImportDialog = () => {\n    setDroppedFile(undefined);\n    setImportDialogOpen(false);\n  };\n\n  useEffect(() => {\n    const [db, { cleanup }] = initDatabase(config, namespace);\n    setRef(path ? db.ref(path) : db.ref());\n\n    const api = new DatabaseApi(config, namespace);\n    setApi(api);\n\n    return function cleanupDb() {\n      cleanup();\n      api.delete();\n    };\n  }, [config, namespace, path]);\n\n  const urlBase = `/database/${namespace}/data`;\n  const handleNavigate = (newPath: string) => {\n    if (newPath.startsWith('/')) {\n      newPath = newPath.substr(1);\n    }\n    history.push(`${urlBase}/${newPath}`);\n  };\n\n  return (\n    <div className=\"Database-Database\">\n      {ref && api ? (\n        <>\n          <InteractiveBreadCrumbBar\n            base={urlBase}\n            path={path || '/'}\n            inputPrefix={getPrefix(ref)}\n            onNavigate={handleNavigate}\n          >\n            <SimpleMenu\n              handle={<IconButton icon=\"more_vert\" label=\"Open menu\" />}\n              renderToPortal\n            >\n              <MenuItem onClick={() => setImportDialogOpen(true)}>\n                Import JSON\n              </MenuItem>\n            </SimpleMenu>\n          </InteractiveBreadCrumbBar>\n\n          <DatabaseDropZone onDrop={f => setDroppedFile(f)}>\n            <NodeContainer realtimeRef={ref} isViewRoot />\n          </DatabaseDropZone>\n\n          {(importDialogOpen || droppedFile) && (\n            <ImportDialog\n              api={api}\n              reference={ref}\n              droppedFile={droppedFile}\n              onComplete={closeImportDialog}\n            />\n          )}\n        </>\n      ) : (\n        <p>Loading</p>\n      )}\n    </div>\n  );\n};\n\nexport default Database;\n\n/**\n * Renders child content inside a dropzone that will show a scrim and accept\n * JSON files\n */\nconst DatabaseDropZone: React.FC<{ onDrop: (file: File) => void }> = ({\n  onDrop,\n  children,\n}) => {\n  const {\n    getInputProps,\n    getRootProps,\n    isDragActive,\n    isDragAccept,\n  } = useDropzone({\n    onDrop: files => onDrop(files[0]),\n    noClick: true,\n    accept: 'application/json',\n  });\n\n  return (\n    <div className=\"Database-Content\" {...getRootProps()}>\n      {children}\n\n      {isDragActive && (\n        <div className=\"Database-Content-Dragging\">\n          {isDragAccept ? (\n            'Drop JSON file to import'\n          ) : (\n            <span className=\"invalid\">\n              Only JSON files are supported for data import.\n            </span>\n          )}\n        </div>\n      )}\n\n      <input {...getInputProps()} />\n    </div>\n  );\n};\n","import { createSelector } from 'reselect';\n\nimport { hasData } from '../utils';\nimport { AppState } from '..';\n\nexport function getDatabases(state: AppState) {\n  return state.database.databases;\n}\n\n// Get the names of the databases or undefined, if not ready for any reason.\nexport const getDatabaseNames = createSelector(getDatabases, databases =>\n  hasData(databases.result)\n    ? databases.result.data.map(db => db.name)\n    : undefined\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './DatabasePicker.scss';\n\nimport {\n  List,\n  ListDivider,\n  ListGroup,\n  ListGroupSubheader,\n  ListItem,\n  ListItemGraphic,\n  ListItemText,\n} from '@rmwc/list';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { Link } from 'react-router-dom';\n\nimport { DatabaseCircleIcon } from '../common/icons';\n\nexport interface PropsFromState {\n  databases: string[] | undefined;\n}\n\nexport type Props = PropsFromState & {\n  primary: string;\n  current: string;\n  navigation: (db: string) => string;\n};\n\nconst DatabaseListItem: React.FC<{\n  name: string;\n  navigation: (db: string) => string;\n  activated: boolean;\n}> = ({ name, navigation, activated }) => {\n  const to = navigation(name);\n  return (\n    <ListItem\n      activated={activated}\n      tag={Link}\n      to={to}\n      data-testid={`nav-${name}`}\n    >\n      <ListItemGraphic tag={DatabaseCircleIcon} size=\"large\" theme=\"primary\" />\n      <ListItemText>{name}</ListItemText>\n    </ListItem>\n  );\n};\n\nexport const DatabasePicker: React.FC<Props> = ({\n  primary,\n  current,\n  navigation,\n  databases,\n}) => {\n  const secondaryDbs = databases ? databases.filter(db => db !== primary) : [];\n\n  // Always show current database, which may not be in the list.\n  if (current !== primary && secondaryDbs.indexOf(current) < 0) {\n    secondaryDbs.push(current);\n  }\n\n  let pickerClassName = 'Database-Picker';\n  if (secondaryDbs.length === 0) {\n    pickerClassName += ' Database-Picker--primary-only';\n  }\n\n  return (\n    <div className={pickerClassName}>\n      <List>\n        <ListGroup>\n          <ListGroupSubheader>\n            <Typography use=\"caption\">Databases</Typography>\n          </ListGroupSubheader>\n          <DatabaseListItem\n            activated={current === primary}\n            name={primary}\n            navigation={navigation}\n          />\n          <ListDivider tag=\"div\" />\n          {secondaryDbs.map(db => (\n            <DatabaseListItem\n              key={db}\n              activated={current === db}\n              name={db}\n              navigation={navigation}\n            />\n          ))}\n        </ListGroup>\n      </List>\n    </div>\n  );\n};\n\nexport default DatabasePicker;\n","import { Button } from '@rmwc/button';\nimport { Card } from '@rmwc/card';\nimport { Elevation } from '@rmwc/elevation';\nimport { GridCell } from '@rmwc/grid';\nimport React, { useEffect, useState } from 'react';\nimport { MapDispatchToPropsFunction, connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../store';\nimport { databasesSubscribe, databasesUnsubscribe } from '../../store/database';\nimport { getDatabaseNames } from '../../store/database/selectors';\nimport { Callout } from '../common/Callout';\nimport DatabasePicker from './DatabasePicker';\n\nexport const mapStateToProps = createStructuredSelector({\n  databases: getDatabaseNames,\n});\n\nexport interface PropsFromState {\n  databases: string[] | undefined;\n}\n\nexport interface PropsFromDispatch {\n  databasesSubscribe: () => void;\n  databasesUnsubscribe: () => void;\n}\n\nexport type Props = PropsFromState &\n  PropsFromDispatch & {\n    children?: React.ReactNode;\n    current: string;\n    primary: string;\n    navigation: (db: string) => string;\n  };\n\nexport const DatabaseContainer: React.FC<Props> = ({\n  current,\n  primary,\n  navigation,\n  databases,\n  children,\n  databasesSubscribe,\n  databasesUnsubscribe,\n}) => {\n  useEffect(() => {\n    databasesSubscribe();\n    return databasesUnsubscribe; // Unsubscribe when unmounting.\n  }, [databasesSubscribe, databasesUnsubscribe]);\n  const [dbs, setDbs] = useState(databases);\n\n  let hasNewDbs = false;\n  if (databases !== dbs) {\n    if (\n      dbs === undefined ||\n      databases === undefined ||\n      dbs.join('|') === databases.join('|') // databases from state are sorted\n    ) {\n      // Don't show reload button for initial data or unchanged.\n      setDbs(databases);\n    } else {\n      hasNewDbs = true;\n    }\n  }\n\n  return (\n    <>\n      {hasNewDbs && (\n        <GridCell span={12}>\n          <Callout\n            icon=\"info\"\n            actions={\n              <Button theme=\"secondary\" onClick={() => setDbs(databases)}>\n                Reload\n              </Button>\n            }\n          >\n            There are new databases that have been created. Reload the page to\n            view them.\n          </Callout>\n        </GridCell>\n      )}\n      <GridCell span={12}>\n        <Elevation z={2} wrap>\n          <Card className=\"canvas-card\">\n            <div className=\"Database\">\n              <DatabasePicker\n                current={current}\n                primary={primary}\n                navigation={navigation}\n                databases={dbs}\n              />\n              {children}\n            </div>\n          </Card>\n        </Elevation>\n      </GridCell>\n    </>\n  );\n};\n\nexport const mapDispatchToProps: MapDispatchToPropsFunction<\n  PropsFromDispatch,\n  {}\n> = dispatch => ({\n  databasesSubscribe: () => void dispatch(databasesSubscribe()),\n  databasesUnsubscribe: () => void dispatch(databasesUnsubscribe()),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DatabaseContainer);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { Redirect, Route, Switch, useRouteMatch } from 'react-router-dom';\n\nimport { createStructuredSelector } from '../../store';\nimport { DatabaseConfig } from '../../store/config';\nimport {\n  getDatabaseConfigResult,\n  getProjectIdResult,\n} from '../../store/config/selectors';\nimport { combineData, handle } from '../../store/utils';\nimport { EmulatorDisabled } from '../common/EmulatorDisabled';\nimport { Spinner } from '../common/Spinner';\nimport Database from './Database';\nimport DatabaseContainer from './DatabaseContainer';\n\nexport const mapStateToProps = createStructuredSelector({\n  projectIdResult: getProjectIdResult,\n  configResult: getDatabaseConfigResult,\n});\n\nexport type PropsFromState = ReturnType<typeof mapStateToProps>;\n\nexport const DatabaseRoute: React.FC<PropsFromState> = ({\n  projectIdResult,\n  configResult,\n}) => {\n  return handle(combineData(projectIdResult, configResult), {\n    onNone: () => (\n      <Spinner span={12} message=\"Realtime Database Emulator Loading...\" />\n    ),\n    onError: () => <DatabaseRouteDisabled />,\n    onData: ([projectId, config]) =>\n      config === undefined ? (\n        <DatabaseRouteDisabled />\n      ) : (\n        <DatabaseRouteContent projectId={projectId} config={config} />\n      ),\n  });\n};\n\nexport default connect(mapStateToProps)(DatabaseRoute);\n\n// Components for different loading cases:\n\nexport type ContentProps = {\n  projectId: string;\n  config: DatabaseConfig;\n};\n\nexport const DatabaseRouteContent: React.FC<ContentProps> = ({\n  projectId,\n  config,\n}) => {\n  let { path, url } = useRouteMatch()!;\n  const primary = projectId;\n\n  return (\n    <Switch>\n      <Route exact path={path}>\n        <Redirect to={`${url}/${primary}/data`} />;\n      </Route>\n      <Route\n        path={`${path}/:namespace/data/:path*`}\n        render={({ match }: any) => {\n          const current = match.params.namespace;\n          const dbPath = `/${match.params.path || ''}`;\n          return (\n            <DatabaseContainer\n              primary={primary}\n              current={current}\n              navigation={db => `${url}/${db}/data`}\n            >\n              <Database namespace={current} path={dbPath} config={config} />\n            </DatabaseContainer>\n          );\n        }}\n      ></Route>\n    </Switch>\n  );\n};\n\nexport const DatabaseRouteDisabled: React.FC = () => (\n  <EmulatorDisabled productName=\"RTDB\" />\n);\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { firestore } from 'firebase';\n\nimport { initFirestore } from '../../firebase';\nimport { FirestoreConfig } from '../../store/config';\nimport { RestApi } from '../common/rest_api';\nimport { FirestoreApi } from './models';\n\nexport default class DatabaseApi extends RestApi implements FirestoreApi {\n  private baseUrl: string;\n  private baseEmulatorUrl: string;\n  private cleanup: () => Promise<void>;\n  readonly database: firestore.Firestore;\n\n  constructor(\n    public readonly projectId: string,\n    public readonly databaseId: string,\n    config: FirestoreConfig\n  ) {\n    super();\n    const [database, { cleanup }] = initFirestore(projectId, config);\n    this.database = database;\n    this.cleanup = cleanup;\n\n    this.baseUrl = `http://${config.hostAndPort}/v1/projects/${projectId}/databases/${databaseId}`;\n    this.baseEmulatorUrl = `http://${config.hostAndPort}/emulator/v1/projects/${projectId}/databases/${databaseId}`;\n  }\n\n  delete(): Promise<void> {\n    return this.cleanup();\n  }\n\n  private async getRootCollections(): Promise<firestore.CollectionReference[]> {\n    const { json } = await this.jsonRequest(\n      `${this.baseUrl}/documents:listCollectionIds`,\n      {},\n      'POST'\n    );\n    const collectionIds = json.collectionIds || [];\n    return collectionIds.map((id: string) => this.database.collection(id));\n  }\n\n  private async getSubCollections(\n    docRef: firestore.DocumentReference\n  ): Promise<firestore.CollectionReference[]> {\n    const encodedPath = docRef.path; // TODO: Encode each segment.\n    const { json } = await this.jsonRequest(\n      `${this.baseUrl}/documents/${encodedPath}:listCollectionIds`,\n      {},\n      'POST'\n    );\n    const collectionIds = json.collectionIds || [];\n    return collectionIds.map((id: string) => docRef.collection(id));\n  }\n\n  async getCollections(\n    docRef?: firestore.DocumentReference\n  ): Promise<firestore.CollectionReference[]> {\n    return docRef\n      ? await this.getSubCollections(docRef)\n      : await this.getRootCollections();\n  }\n\n  async nukeDocuments() {\n    await this.jsonRequest(`${this.baseEmulatorUrl}/documents`, {}, 'DELETE');\n    return [];\n  }\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createDialogQueue } from '@rmwc/dialog';\n\nexport const { dialogs, alert, confirm, prompt } = createDialogQueue();\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DialogButton } from '@rmwc/dialog';\nimport React from 'react';\n\nimport { confirm } from '../../common/DialogQueue';\n\nexport const promptClearAll = () =>\n  confirm({\n    title: 'Delete all data?',\n    body: `Proceeding will delete all your collections, sub-collections and\n             documents within your database.`,\n    // hide standard buttons so as to use `danger` button\n    acceptLabel: null,\n    cancelLabel: null,\n    footer: (\n      <>\n        <DialogButton type=\"button\" theme=\"secondary\" action=\"close\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Clear\n        </DialogButton>\n      </>\n    ),\n  });\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createAction } from 'typesafe-actions';\n\nimport { CollectionFilter } from './models';\n\nexport const addCollectionFilter = createAction(\n  '@firestore/addCollectionFilter'\n)<\n  {\n    path: string;\n  } & CollectionFilter\n>();\nexport const removeCollectionFilter = createAction(\n  '@firestore/removeCollectionFilter'\n)<{\n  path: string;\n}>();\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport produce from 'immer';\nimport * as React from 'react';\nimport { Action, createReducer } from 'typesafe-actions';\n\nimport * as actions from './actions';\nimport { CollectionFilter } from './models';\n\nexport interface CollectionFilters {\n  [path: string]: CollectionFilter;\n}\n\nexport interface Store {\n  collectionFilters: CollectionFilters;\n}\n\nconst INIT_STATE: Store = { collectionFilters: {} };\n\nconst firestoreStoreContext = React.createContext<{\n  store: Store;\n  dispatch: React.Dispatch<any>;\n}>({ store: INIT_STATE, dispatch: () => {} });\n\nconst reducer = createReducer<Store, Action>(INIT_STATE)\n  .handleAction(\n    actions.addCollectionFilter,\n    produce((draft, { payload }) => {\n      const { path, ...filter } = payload;\n      draft.collectionFilters[payload.path] = filter;\n    })\n  )\n  .handleAction(\n    actions.removeCollectionFilter,\n    produce((draft, { payload }) => {\n      delete draft.collectionFilters[payload.path];\n    })\n  );\n\nconst storeReducer: React.Reducer<Store, Action> = (state, action) => {\n  return (reducer.handlers as any)[action.type](state, action);\n};\n\nexport const FirestoreStore: React.FC<{ initState?: Store }> = ({\n  initState = INIT_STATE,\n  children,\n}) => {\n  const [store, dispatch] = React.useReducer(storeReducer, initState);\n  return (\n    <firestoreStoreContext.Provider value={{ store, dispatch }}>\n      {children}\n    </firestoreStoreContext.Provider>\n  );\n};\n\nexport function useFirestoreStore(): {\n  store: Store;\n  dispatch: React.Dispatch<Action>;\n} {\n  const context = React.useContext(firestoreStoreContext);\n  if (context === undefined) {\n    throw new Error('useFirestoreStore must be used within a <FirestoreStore>');\n  }\n  return context;\n}\n\nexport function useStore(): Store {\n  const { store } = useFirestoreStore();\n  return React.useMemo(() => store, [store]);\n}\n\nexport function useDispatch(): React.Dispatch<Action> {\n  const { dispatch } = useFirestoreStore();\n  return React.useMemo(() => dispatch, [dispatch]);\n}\n\nexport function useCollectionFilter(\n  path: string\n): CollectionFilter | undefined {\n  const { store } = useFirestoreStore();\n  return store.collectionFilters[path];\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { Controller, useFormContext } from 'react-hook-form';\n\nimport { Field, SelectField } from '../../../components/common/Field';\nimport { NUMBER_REGEX, isBoolean, isNumber } from '../utils';\nimport styles from './CollectionFilter.module.scss';\n\nfunction getConditionEntryType(value: any) {\n  if (isBoolean(value)) {\n    return 'boolean';\n  }\n  if (isNumber(value)) {\n    return 'number';\n  }\n  return 'string';\n}\n\ninterface ConditionEntryProps {\n  name: string;\n  // Error may be undefined; require consumers to still pass or we might end up\n  // in a state where we validate without showing the error message.\n  error: string | undefined;\n}\n\nexport const ConditionEntry: React.FC<ConditionEntryProps> = React.memo(\n  ({ name, error }) => {\n    const { setValue, watch } = useFormContext();\n    const value = watch(name);\n    const [fieldType, setFieldType] = useState(getConditionEntryType(value));\n\n    useEffect(() => {\n      // Essentially setting the defaultValue of this form-field,\n      // specifically when chaning types between Single <--> Multi\n      if (value === undefined) {\n        setValue(name, '');\n      }\n    }, [value, setValue, name]);\n\n    return (\n      <div className={styles.conditionEntry}>\n        <SelectField\n          options={['string', 'number', 'boolean']}\n          value={fieldType}\n          onChange={evt => {\n            setFieldType(evt.currentTarget.value);\n          }}\n          fieldClassName={styles.conditionEntryType}\n        />\n\n        {fieldType === 'string' && (\n          <Controller\n            as={Field}\n            name={name}\n            defaultValue=\"\"\n            error={error}\n            fieldClassName={styles.conditionEntryValue}\n            aria-label=\"Value\"\n          />\n        )}\n\n        {fieldType === 'number' && (\n          <Controller\n            as={Field}\n            name={name}\n            defaultValue={''}\n            rules={{\n              pattern: {\n                value: NUMBER_REGEX,\n                message: 'Must be a number',\n              },\n            }}\n            error={error}\n            onChange={([event]) =>\n              // Cast it back to a number before saving to model\n              event.target.value.match(NUMBER_REGEX)\n                ? parseFloat(event.target.value)\n                : event.target.value\n            }\n            fieldClassName={styles.conditionEntryValue}\n            aria-label=\"Value\"\n          />\n        )}\n\n        {fieldType === 'boolean' && <BooleanCondition name={name} />}\n      </div>\n    );\n  }\n);\n\n// RMWC select-menus do not work well with boolean values, requiring\n// custom-registration w/ the parent form\nconst BooleanCondition: React.FC<{ name: string }> = ({ name }) => {\n  const { register, setValue, unregister, watch } = useFormContext();\n\n  useEffect(() => {\n    register({ name });\n    setValue(name, true);\n\n    return () => unregister(name);\n  }, [register, unregister, setValue, name]);\n\n  const selectValue = watch(name);\n\n  return (\n    <SelectField\n      name={name}\n      options={['true', 'false']}\n      value={selectValue}\n      onChange={evt => setValue(name, evt.currentTarget.value === 'true')}\n      fieldClassName={styles.conditionEntryValue}\n      aria-label=\"Value\"\n    />\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport { IconButton } from '@rmwc/icon-button';\nimport React, { useEffect } from 'react';\nimport { useFieldArray, useFormContext } from 'react-hook-form';\n\nimport styles from './CollectionFilter.module.scss';\nimport { ConditionEntry } from './ConditionEntry';\n\nexport const ConditionEntries: React.FC<{ name: string }> = ({ name }) => {\n  const {\n    errors,\n    formState: { touched },\n  } = useFormContext();\n\n  const { fields, append, remove } = useFieldArray({\n    name,\n  });\n\n  useEffect(() => {\n    if (fields.length < 1) {\n      append({ _: '' });\n    }\n  }, [append, fields]);\n\n  return (\n    <ul className={styles.conditionEntries}>\n      {fields.map((field, index) => {\n        const conditionName = `${name}[${index}]`;\n        return (\n          <li key={field.id}>\n            <ConditionEntry\n              name={conditionName}\n              error={touched[conditionName] && errors[conditionName]}\n            />\n            <IconButton\n              className={\n                fields.length > 1 ? styles.removeFilter : styles.hidden\n              }\n              icon=\"delete\"\n              label=\"Remove filter\"\n              type=\"button\"\n              onClick={() => remove(index)}\n            />\n          </li>\n        );\n      })}\n      <Button type=\"button\" icon=\"add\" onClick={() => append({ _: '' })}>\n        Add value\n      </Button>\n    </ul>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Radio } from '@rmwc/radio';\nimport React, { useEffect } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nexport const SortRadioGroup: React.FC<{ name: string; disabled: boolean }> = ({\n  name,\n  disabled,\n}) => {\n  const { register, setValue, unregister, watch } = useFormContext();\n\n  useEffect(() => {\n    if (!disabled) {\n      register({ name });\n    } else {\n      setValue(name, undefined);\n    }\n\n    return () => unregister(name);\n  }, [register, unregister, disabled, name, setValue]);\n\n  const sort = watch(name);\n\n  return (\n    <>\n      <Radio\n        value=\"asc\"\n        label=\"Ascending\"\n        checked={sort === 'asc'}\n        onChange={() => setValue(name, 'asc')}\n        disabled={disabled}\n      />\n\n      <Radio\n        value=\"desc\"\n        label=\"Descending\"\n        checked={sort === 'desc'}\n        onChange={() => setValue(name, 'desc')}\n        disabled={disabled}\n      />\n    </>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CardActionButton, CardActionButtons, CardActions } from '@rmwc/card';\nimport { CollapsibleList, SimpleListItem } from '@rmwc/list';\nimport { Theme, ThemeProvider } from '@rmwc/theme';\nimport { Typography } from '@rmwc/typography';\nimport { firestore } from 'firebase';\nimport React, { useState } from 'react';\nimport { Controller, FormContext, useForm } from 'react-hook-form';\n\nimport { grey100 } from '../../../colors';\nimport { Field, SelectField } from '../../../components/common/Field';\nimport * as actions from '../actions';\nimport {\n  CollectionFilter as CollectionFilterType,\n  isMultiValueCollectionFilter,\n  isSingleValueCollectionFilter,\n  isSortableCollectionFilter,\n} from '../models';\nimport { useCollectionFilter, useDispatch } from '../store';\nimport styles from './CollectionFilter.module.scss';\nimport { ConditionEntries } from './ConditionEntries';\nimport { ConditionEntry } from './ConditionEntry';\nimport { SortRadioGroup } from './SortRadioGroup';\n\nexport const CollectionFilter: React.FC<{\n  className?: string;\n  path: string;\n  onClose?: () => void;\n}> = ({ className, path, onClose }) => {\n  const collectionFilter = useCollectionFilter(path);\n  const dispatch = useDispatch();\n\n  const formMethods = useForm<CollectionFilterType>({\n    mode: 'onChange',\n    defaultValues: collectionFilter,\n  });\n\n  const cf = formMethods.watch({ nest: true });\n\n  const onSubmit = (data: CollectionFilterType) => {\n    dispatch(\n      actions.addCollectionFilter({\n        path,\n        ...data,\n      })\n    );\n    onClose?.();\n  };\n\n  return (\n    <CollectionFilterTheme>\n      <FormContext {...(formMethods as any)}>\n        <form\n          onSubmit={formMethods.handleSubmit(onSubmit)}\n          className={className}\n        >\n          {/* Field entry */}\n          <FilterItem title=\"Filter by field\" preview={cf.field} defaultOpen>\n            <Controller\n              as={Field}\n              name=\"field\"\n              label=\"Enter field\"\n              rules={{ required: 'Required' }}\n              defaultValue=\"\"\n              error={\n                (formMethods.formState.touched as any)['field'] &&\n                (formMethods.errors as any)['field']?.message\n              }\n            />\n          </FilterItem>\n\n          {/* Condition entry */}\n          <FilterItem\n            title=\"Add condition\"\n            preview={<ConditionPreview cf={cf} />}\n            defaultOpen\n          >\n            <ConditionSelect>\n              {cf && isSingleValueCollectionFilter(cf) && (\n                <ConditionEntry\n                  name=\"value\"\n                  error={\n                    (formMethods.formState.touched as any)['value'] &&\n                    (formMethods.errors as any)['value']?.message\n                  }\n                />\n              )}\n\n              {cf && isMultiValueCollectionFilter(cf) && (\n                <ConditionEntries name=\"values\" />\n              )}\n            </ConditionSelect>\n          </FilterItem>\n\n          {/* Sort entry */}\n          <FilterItem\n            title=\"Sort results\"\n            preview={isSortableCollectionFilter(cf) && cf.sort}\n            defaultOpen\n          >\n            <SortRadioGroup\n              name=\"sort\"\n              disabled={!isSortableCollectionFilter(cf)}\n            />\n          </FilterItem>\n\n          <Preview path={path} cf={cf} />\n\n          <CardActions className={styles.actions}>\n            <CardActionButtons>\n              <CardActionButton\n                type=\"button\"\n                onClick={() => {\n                  dispatch(\n                    actions.removeCollectionFilter({\n                      path,\n                    })\n                  );\n                  onClose?.();\n                }}\n              >\n                Clear\n              </CardActionButton>\n            </CardActionButtons>\n            <CardActionButtons>\n              <CardActionButton type=\"button\" onClick={() => onClose?.()}>\n                Cancel\n              </CardActionButton>\n              <CardActionButton\n                unelevated\n                type=\"submit\"\n                disabled={!formMethods.formState.isValid}\n              >\n                Apply\n              </CardActionButton>\n            </CardActionButtons>\n          </CardActions>\n        </form>\n      </FormContext>\n    </CollectionFilterTheme>\n  );\n};\n\nconst CollectionFilterTheme: React.FC = ({ children }) => (\n  <ThemeProvider options={{ background: grey100, surface: '#fff' }}>\n    <Theme use={['background']} tag=\"div\">\n      {children}\n    </Theme>\n  </ThemeProvider>\n);\n\nconst ConditionPreview: React.FC<{ cf: CollectionFilterType }> = ({ cf }) => {\n  const operator = `\"${cf.operator}\"`;\n  if (isSingleValueCollectionFilter(cf)) {\n    return <span>{`${operator}, \"${cf.value}\"`}</span>;\n  }\n  if (isMultiValueCollectionFilter(cf)) {\n    return <span>{`${operator}, ${JSON.stringify(cf.values)}`}</span>;\n  }\n  return null;\n};\n\nconst Preview: React.FC<{ path: string; cf: CollectionFilterType }> = ({\n  path,\n  cf,\n}) => {\n  const collectionId = path.split('/').pop();\n  return (\n    <code className={styles.preview} aria-label=\"Code preview\">\n      <div>.collection({`${JSON.stringify(collectionId)}`})</div>\n      {(isSingleValueCollectionFilter(cf) ||\n        isMultiValueCollectionFilter(cf)) && (\n        <div className={styles.previewFilter}>\n          .where(\"{cf.field}\", <ConditionPreview cf={cf} />)\n        </div>\n      )}\n      {isSortableCollectionFilter(cf) && !!cf.sort && (\n        <div className={styles.previewFilter}>\n          .orderBy({`\"${cf.field}\", \"${cf.sort}\"`})\n        </div>\n      )}\n    </code>\n  );\n};\n\nconst ConditionSelect: React.FC = ({ children }) => {\n  const options: Array<{ label: string; value: firestore.WhereFilterOp }> = [\n    {\n      label: '(==) equal to',\n      value: '==',\n    },\n    {\n      label: '(>) greater than',\n      value: '>',\n    },\n    {\n      label: '(>=) greater than or equal to',\n      value: '>=',\n    },\n    {\n      label: '(<) less than',\n      value: '<',\n    },\n    {\n      label: '(<=) less than or equal to',\n      value: '<=',\n    },\n    {\n      label: '(in) equal to any of the following',\n      value: 'in',\n    },\n    {\n      label: '(array-contains) an array containing',\n      value: 'array-contains',\n    },\n    {\n      label: '(array-contains-any) an array containing any',\n      value: 'array-contains-any',\n    },\n  ];\n\n  return (\n    <>\n      <Controller\n        as={SelectField}\n        name=\"operator\"\n        label=\"Only show documents where the specified field is...\"\n        placeholder=\"No condition\"\n        options={options}\n        onChange={([selected]) => selected.currentTarget.value || undefined}\n      />\n      {children}\n    </>\n  );\n};\n\n// Accordian-view for expanding/collapsing panels in the query-view\nconst FilterItem: React.FC<{\n  title: string;\n  preview?: React.ReactNode;\n  defaultOpen: boolean;\n}> = ({ title, preview, defaultOpen, children }) => {\n  const [expanded, setExpanded] = useState(defaultOpen);\n\n  return (\n    <CollapsibleList\n      className={styles.listItem}\n      defaultOpen={expanded}\n      handle={\n        <SimpleListItem\n          text={\n            <div className={styles.headerTitle}>\n              <Typography use=\"body1\">{title}</Typography>\n              {!expanded && preview && (\n                <Typography use=\"caption\">{preview}</Typography>\n              )}\n            </div>\n          }\n          metaIcon=\"chevron_right\"\n          className={styles.header}\n        />\n      }\n      onOpen={() => setExpanded(true)}\n      onClose={() => setExpanded(false)}\n    >\n      <div className={styles.children}>{children}</div>\n    </CollapsibleList>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogOnCloseEventT,\n  DialogProps,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport { firestore } from 'firebase';\nimport React, { useCallback, useEffect, useState } from 'react';\n\nimport { Field } from '../../common/Field';\nimport DocumentEditor from '../DocumentEditor';\nimport { FirestoreMap } from '../models';\n\nexport interface AddDocumentDialogValue {\n  id: string;\n  data: any;\n}\n\nexport interface AddDocumentStepProps {\n  collectionRef: firestore.CollectionReference;\n  onChange: (value: AddDocumentDialogValue) => void;\n}\n\nexport const AddDocumentStep: React.FC<AddDocumentStepProps> = ({\n  collectionRef,\n  onChange,\n}) => {\n  const [id, setId] = useState(collectionRef.doc().id);\n  const [data, setData] = useState<FirestoreMap | undefined>();\n\n  // TODO: Validation\n  const getValue = useCallback(() => {\n    try {\n      return { id, data };\n    } catch (e) {\n      return { id, data: { invalidData: true } };\n    }\n  }, [id, data]);\n\n  // emit initial value immediately (to capture auto generated doc id)\n  useEffect(() => {\n    onChange(getValue());\n  }, [getValue, onChange]);\n\n  const updateId = (evt: React.ChangeEvent<HTMLInputElement>) => {\n    setId(evt.target.value);\n    onChange(getValue());\n  };\n\n  return (\n    <>\n      <Field\n        id=\"add-document-path\"\n        fullwidth\n        disabled\n        label=\"Parent path\"\n        value={collectionRef.path}\n      />\n      <Field\n        id=\"add-document-id\"\n        fullwidth\n        label=\"Document ID\"\n        value={id}\n        onChange={updateId}\n        required\n      />\n      <DocumentEditor value={{ '': '' }} onChange={data => setData(data)} />\n    </>\n  );\n};\n\ninterface Props extends DialogProps {\n  collectionRef: firestore.CollectionReference;\n  onValue: (v: AddDocumentDialogValue | null) => void;\n}\n\nexport const AddDocumentDialog: React.FC<Props> = ({\n  collectionRef,\n  onClose,\n  onValue,\n  ...dialogProps\n}) => {\n  const [document, setDocument] = useState<AddDocumentDialogValue>({\n    id: '',\n    data: undefined,\n  });\n\n  const emitValueAndClose = (evt: DialogOnCloseEventT) => {\n    onValue(evt.detail.action === 'accept' ? document : null);\n    onClose && onClose(evt);\n  };\n\n  return (\n    <Dialog {...dialogProps} onClose={emitValueAndClose}>\n      <DialogTitle>Add a document</DialogTitle>\n\n      <DialogContent>\n        <AddDocumentStep collectionRef={collectionRef} onChange={setDocument} />\n      </DialogContent>\n\n      <DialogActions>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton\n          unelevated\n          action=\"accept\"\n          isDefaultAction\n          disabled={!document.data}\n        >\n          Save\n        </DialogButton>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './PanelHeader.scss';\n\nimport { Theme } from '@rmwc/theme';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport { CardActionBar, CardActionBarActions } from '../common/CardActionBar';\n\nexport const PanelHeader: React.FC<{ id: string; icon: React.ReactNode }> = ({\n  id,\n  icon,\n  children,\n}) => {\n  return (\n    <div className=\"Firestore-PanelHeader\">\n      <CardActionBar>\n        <Theme use=\"secondary\">{icon}</Theme>\n        <Typography use=\"body2\" className=\"Firestore-PanelHeader-title\">\n          {id}\n        </Typography>\n        <CardActionBarActions>{children}</CardActionBarActions>\n      </CardActionBar>\n    </div>\n  );\n};\n\nexport default PanelHeader;\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode, useEffect, useState } from 'react';\nimport React from 'react';\nimport { Redirect, useLocation, useRouteMatch } from 'react-router-dom';\n\nconst FIRESTORE_ROUTE = '/firestore';\n\n/**\n * Given a list of collections or documents, auto select the first item. Only\n * works on root (`/firestore`) or top level collections (`/firestore/users`)\n * to prevent deep auto selection.\n */\nexport function useAutoSelect<T extends { id: string }>(list?: T[] | null) {\n  const { url } = useRouteMatch()!;\n  const { pathname } = useLocation();\n  const [autoSelect, setAutoSelect] = useState<ReactNode | null>(null);\n\n  useEffect(() => {\n    const isRootOrRootCollection =\n      url === FIRESTORE_ROUTE ||\n      // /firestore/users\n      (url.startsWith(FIRESTORE_ROUTE) && url.split('/').length === 3);\n    const hasNothingSelected = url === pathname;\n    const firstChild = list?.[0];\n    const shouldAutoSelect = isRootOrRootCollection && hasNothingSelected;\n\n    setAutoSelect(\n      shouldAutoSelect && firstChild ? (\n        <Redirect to={`${url}/${firstChild.id}`} />\n      ) : null\n    );\n  }, [pathname, url, list, setAutoSelect]);\n\n  return autoSelect;\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Button } from '@rmwc/button';\nimport { Icon } from '@rmwc/icon';\nimport { IconButton } from '@rmwc/icon-button';\nimport { List, ListItem } from '@rmwc/list';\nimport { MenuSurface, MenuSurfaceAnchor } from '@rmwc/menu';\nimport { firestore } from 'firebase';\nimport React, { useState } from 'react';\nimport { useCollection } from 'react-firebase-hooks/firestore';\nimport { NavLink, Redirect, Route, useRouteMatch } from 'react-router-dom';\n\nimport styles from './Collection.module.scss';\nimport { CollectionFilter } from './CollectionFilter';\nimport {\n  AddDocumentDialog,\n  AddDocumentDialogValue,\n} from './dialogs/AddDocumentDialog';\nimport { Document } from './Document';\nimport {\n  CollectionFilter as CollectionFilterType,\n  isMultiValueCollectionFilter,\n  isSingleValueCollectionFilter,\n  isSortableCollectionFilter,\n} from './models';\nimport PanelHeader from './PanelHeader';\nimport { useCollectionFilter } from './store';\nimport { useAutoSelect } from './useAutoSelect';\n\nconst NO_DOCS: firestore.QueryDocumentSnapshot<firestore.DocumentData>[] = [];\n\nexport interface Props {\n  collection: firestore.CollectionReference;\n}\n\nexport function withCollectionState(\n  Presentation: React.ComponentType<CollectionPresentationProps>\n): React.ComponentType<Props> {\n  return ({ collection }) => {\n    const [newDocumentId, setNewDocumentId] = useState<string>();\n    const collectionFilter = useCollectionFilter(collection.path);\n    const filteredCollection = applyCollectionFilter(\n      collection,\n      collectionFilter\n    );\n    const [collectionSnapshot, loading, error] = useCollection(\n      filteredCollection\n    );\n\n    const { url } = useRouteMatch()!;\n    // TODO: Fetch missing documents (i.e. nonexistent docs with subcollections).\n    const docs = collectionSnapshot ? collectionSnapshot.docs : NO_DOCS;\n    const redirectIfAutoSelectable = useAutoSelect(docs);\n\n    const addDocument = async (value: AddDocumentDialogValue | null) => {\n      if (value && value.id) {\n        await collection.doc(value.id).set(value.data);\n        setNewDocumentId(value.id);\n      }\n    };\n\n    if (error) return <></>;\n    if (!loading && redirectIfAutoSelectable)\n      return <>{redirectIfAutoSelectable}</>;\n    if (newDocumentId) return <Redirect to={`${url}/${newDocumentId}`} />;\n\n    return (\n      <Presentation\n        collection={collection}\n        collectionFilter={collectionFilter}\n        addDocument={addDocument}\n        docs={docs}\n        url={url}\n      />\n    );\n  };\n}\n\ninterface CollectionPresentationProps {\n  collection: firestore.CollectionReference<firestore.DocumentData>;\n  collectionFilter: ReturnType<typeof useCollectionFilter>;\n  addDocument: (value: AddDocumentDialogValue | null) => Promise<void>;\n  docs: firestore.QueryDocumentSnapshot<firestore.DocumentData>[];\n  url: string;\n}\n\nexport const CollectionPresentation: React.FC<CollectionPresentationProps> = ({\n  collection,\n  collectionFilter,\n  addDocument,\n  docs,\n  url,\n}) => {\n  const [isFilterOpen, setIsFilterOpen] = useState(false);\n  const [isAddDocumentDialogOpen, setAddDocumentDialogOpen] = useState(false);\n\n  return (\n    <>\n      <div className=\"Firestore-Collection\">\n        <PanelHeader\n          id={collection.id}\n          icon={<Icon icon={{ icon: 'collections_bookmark', size: 'small' }} />}\n        >\n          <MenuSurfaceAnchor>\n            <MenuSurface\n              open={isFilterOpen}\n              onClose={() => setIsFilterOpen(false)}\n            >\n              {isFilterOpen && (\n                <CollectionFilter\n                  className={styles['query-panel']}\n                  path={collection.path}\n                  onClose={() => setIsFilterOpen(false)}\n                />\n              )}\n            </MenuSurface>\n\n            <div className={collectionFilter && styles.badge}>\n              <IconButton\n                icon=\"filter_list\"\n                label=\"Filter documents in this collection\"\n                onClick={() => setIsFilterOpen(!isFilterOpen)}\n              />\n            </div>\n          </MenuSurfaceAnchor>\n        </PanelHeader>\n\n        {isAddDocumentDialogOpen && (\n          <AddDocumentDialog\n            collectionRef={collection}\n            open={isAddDocumentDialogOpen}\n            onValue={addDocument}\n            onClose={() => setAddDocumentDialogOpen(false)}\n          />\n        )}\n        <List dense className=\"List-Actions\" tag=\"div\">\n          <ListItem\n            className=\"list-button\"\n            tag={Button}\n            label=\"Add document\"\n            {...{ dense: true, icon: 'add' }} // types get confused\n            onClick={() => setAddDocumentDialogOpen(true)}\n          ></ListItem>\n        </List>\n\n        <List dense className=\"Firestore-Document-List\" tag=\"div\">\n          {docs.map(doc => (\n            <ListItem\n              key={doc.ref.id}\n              className=\"Firestore-List-Item\"\n              tag={NavLink}\n              to={`${url}/${doc.ref.id}`}\n              activeClassName=\"mdc-list-item--activated\"\n            >\n              {doc.ref.id}\n            </ListItem>\n          ))}\n        </List>\n      </div>\n      <Route\n        path={`${url}/:id`}\n        render={({ match }: any) => {\n          const docRef = collection.doc(match.params.id);\n          return <Document reference={docRef} />;\n        }}\n      ></Route>\n    </>\n  );\n};\n\nfunction applyCollectionFilter(\n  collection: firestore.Query<firestore.DocumentData>,\n  collectionFilter?: CollectionFilterType\n): firestore.Query<firestore.DocumentData> {\n  let filteredCollection = collection;\n  if (collectionFilter && isSingleValueCollectionFilter(collectionFilter)) {\n    filteredCollection = filteredCollection.where(\n      collectionFilter.field,\n      collectionFilter.operator,\n      collectionFilter.value\n    );\n  }\n  if (collectionFilter && isMultiValueCollectionFilter(collectionFilter)) {\n    filteredCollection = filteredCollection.where(\n      collectionFilter.field,\n      collectionFilter.operator,\n      collectionFilter.values\n    );\n  }\n  if (collectionFilter && isSortableCollectionFilter(collectionFilter)) {\n    filteredCollection = filteredCollection.orderBy(\n      collectionFilter.field,\n      collectionFilter.sort\n    );\n  }\n  return filteredCollection;\n}\n\nexport const Collection = withCollectionState(CollectionPresentation);\n\nexport default Collection;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogOnCloseEventT,\n  DialogProps,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport { firestore } from 'firebase';\nimport React, { useState } from 'react';\n\nimport { Field } from '../../common/Field';\nimport DatabaseApi from '../api';\nimport { AddDocumentDialogValue, AddDocumentStep } from './AddDocumentDialog';\n\ninterface AddCollectionStepProps {\n  documentRef?: firestore.DocumentReference;\n  onChange: (value: string) => void;\n}\n\nexport const AddCollectionStep = ({\n  documentRef,\n  onChange,\n}: AddCollectionStepProps) => {\n  const [id, setId] = useState('');\n  const updateId = (evt: React.ChangeEvent<HTMLInputElement>) => {\n    setId(evt.target.value);\n    onChange(evt.target.value);\n  };\n\n  return (\n    <>\n      <Field\n        label=\"Parent path\"\n        value={documentRef ? documentRef.path : '/'}\n        disabled\n      />\n\n      <Field label=\"Collection ID\" required value={id} onChange={updateId} />\n    </>\n  );\n};\n\nexport interface AddCollectionDialogValue {\n  collectionId: string;\n  document: AddDocumentDialogValue;\n}\n\ninterface Props extends DialogProps {\n  documentRef?: firestore.DocumentReference;\n  api: DatabaseApi;\n  onValue: (v: AddCollectionDialogValue | null) => void;\n}\n\nenum Step {\n  COLLECTION,\n  DOCUMENT,\n}\n\nexport const AddCollectionDialog: React.FC<Props> = ({\n  documentRef,\n  api,\n  onValue,\n  onClose,\n  ...dialogProps\n}) => {\n  const [step, setStep] = useState(Step.COLLECTION);\n  const [collectionId, setCollectionId] = useState('');\n  const [document, setDocument] = useState<AddDocumentDialogValue>({\n    id: '',\n    data: undefined,\n  });\n\n  const next = () =>\n    step === Step.COLLECTION && collectionId && setStep(step + 1);\n\n  const getValue = () => ({\n    collectionId,\n    document,\n  });\n\n  const emitValueAndClose = (evt: DialogOnCloseEventT) => {\n    onValue(evt.detail.action === 'accept' ? getValue() : null);\n    onClose && onClose(evt);\n  };\n\n  return (\n    <Dialog {...dialogProps} onClose={emitValueAndClose}>\n      <DialogTitle>Start a collection</DialogTitle>\n\n      <DialogContent>\n        {step === Step.COLLECTION ? (\n          <AddCollectionStep\n            documentRef={documentRef}\n            onChange={setCollectionId}\n          />\n        ) : (\n          <AddDocumentStep\n            collectionRef={\n              documentRef\n                ? documentRef.collection(collectionId)\n                : api.database.collection(collectionId)\n            }\n            onChange={setDocument}\n          />\n        )}\n      </DialogContent>\n\n      <DialogActions>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        {step === Step.DOCUMENT ? (\n          <DialogButton\n            unelevated\n            action=\"accept\"\n            isDefaultAction\n            disabled={!document.data}\n          >\n            Save\n          </DialogButton>\n        ) : (\n          <DialogButton unelevated onClick={next}>\n            Next\n          </DialogButton>\n        )}\n      </DialogActions>\n    </Dialog>\n  );\n};\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Button } from '@rmwc/button';\nimport { List, ListItem } from '@rmwc/list';\nimport { firestore } from 'firebase';\nimport React, { useEffect, useState } from 'react';\nimport { NavLink, useHistory, useRouteMatch } from 'react-router-dom';\n\nimport DatabaseApi from './api';\nimport { useApi } from './ApiContext';\nimport {\n  AddCollectionDialog,\n  AddCollectionDialogValue,\n} from './dialogs/AddCollectionDialog';\nimport { useAutoSelect } from './useAutoSelect';\n\nexport interface Props {\n  reference?: firestore.DocumentReference;\n}\n\nexport const CollectionList: React.FC<Props> = ({ reference }) => {\n  const { url } = useRouteMatch()!;\n  const api = useApi();\n  const history = useHistory();\n  const restCollections = useCollections(api, reference);\n  const [collections, setCollections] = useState(restCollections);\n  const redirectIfAutoSelectable = useAutoSelect(collections);\n\n  useEffect(() => {\n    // Update the current list of collections whenever the rest-query resolves\n    // with CollectionRefs\n    setCollections(restCollections);\n  }, [restCollections]);\n\n  const [isAddCollectionDialogOpen, setAddCollectionDialogOpen] = useState(\n    false\n  );\n\n  const addCollection = async (value: AddCollectionDialogValue | null) => {\n    if (value && value.collectionId && value.document.id) {\n      const ref = reference || api.database;\n      const newCollection = ref.collection(value.collectionId);\n\n      await newCollection.doc(value.document.id).set(value.document.data);\n\n      // Append to the current collection-list because the hook is not triggered\n      setCollections([...collections, newCollection]);\n\n      // Redirect to the new collection\n      if (reference) {\n        history.push(`/firestore/${reference.path}/${value.collectionId}`);\n      } else {\n        history.push(`/firestore/${value.collectionId}`);\n      }\n    }\n  };\n\n  return (\n    <div className=\"Firestore-CollectionList\" data-testid=\"collection-list\">\n      {redirectIfAutoSelectable}\n\n      {isAddCollectionDialogOpen && (\n        <AddCollectionDialog\n          documentRef={reference}\n          api={api}\n          open={isAddCollectionDialogOpen}\n          onValue={addCollection}\n          onClose={() => setAddCollectionDialogOpen(false)}\n        />\n      )}\n      {/* Actions */}\n      <List dense className=\"List-Actions\" tag=\"div\">\n        <ListItem\n          className=\"list-button\"\n          tag={Button}\n          {...{ dense: true, icon: 'add' }} // types get confused\n          label=\"Start collection\"\n          onClick={() => setAddCollectionDialogOpen(true)}\n        ></ListItem>\n      </List>\n\n      <List dense tag=\"div\">\n        {collections &&\n          collections.map(coll => (\n            <ListItem\n              key={coll.id}\n              className=\"Firestore-List-Item\"\n              tag={NavLink}\n              to={`${url}/${coll.id}`}\n              activeClassName=\"mdc-list-item--activated\"\n            >\n              {coll.id}\n            </ListItem>\n          ))}\n      </List>\n    </div>\n  );\n};\n\nfunction useCollections(\n  api: DatabaseApi,\n  documentRef?: firestore.DocumentReference\n): firestore.CollectionReference[] | null {\n  const [collections, setCollections] = useState<\n    firestore.CollectionReference[] | null\n  >(null);\n\n  useEffect(() => {\n    async function fetchCollections() {\n      const collections = await api.getCollections(documentRef);\n      setCollections(collections);\n    }\n    fetchCollections();\n  }, [api, documentRef]);\n\n  return collections;\n}\n\nexport default CollectionList;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DialogButton } from '@rmwc/dialog';\nimport { firestore } from 'firebase';\nimport React from 'react';\n\nimport { Callout } from '../../common/Callout';\nimport { confirm } from '../../common/DialogQueue';\nimport { Field } from '../../common/Field';\n\nexport const promptDeleteDocument = (reference: firestore.DocumentReference) =>\n  confirm({\n    title: 'Delete document',\n    body: (\n      <div className=\"Firestore--dialog-body\">\n        <Callout aside type=\"warning\">\n          This will permanently delete the document.\n        </Callout>\n        <Field\n          label=\"Document location\"\n          value={reference.path || '/'}\n          disabled\n        />\n      </div>\n    ),\n    // hide standard buttons so as to use `danger` button\n    acceptLabel: null,\n    cancelLabel: null,\n    footer: (\n      <>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Delete\n        </DialogButton>\n      </>\n    ),\n  });\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DialogButton } from '@rmwc/dialog';\nimport { firestore } from 'firebase';\nimport React from 'react';\n\nimport { Callout } from '../../common/Callout';\nimport { confirm } from '../../common/DialogQueue';\nimport { Field } from '../../common/Field';\n\nexport const promptDeleteDocumentFields = (\n  reference: firestore.DocumentReference\n) =>\n  confirm({\n    title: 'Delete data',\n    body: (\n      <div className=\"Firestore--dialog-body\">\n        <Callout aside type=\"warning\">\n          This will delete all fields of the document, excluding subcollections.\n        </Callout>\n        <Field\n          label=\"Document location\"\n          value={reference.path || '/'}\n          fullwidth\n          disabled\n        />\n      </div>\n    ),\n    // hide standard buttons so as to use `danger` button\n    acceptLabel: null,\n    cancelLabel: null,\n    footer: (\n      <>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Delete\n        </DialogButton>\n      </>\n    ),\n  });\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { firestore } from 'firebase';\n\nimport { FirestoreAny, FirestoreMap } from '../models';\nimport { isArray, isMap, withFieldRemoved, withFieldSet } from '../utils';\n\nconst DELETE_FIELD = firestore.FieldValue.delete();\n\nexport function deleteField(\n  documentRef: firestore.DocumentReference,\n  documentData: FirestoreMap,\n  path: string[]\n) {\n  const payload = adjustPayloadForArray(documentData, path, DELETE_FIELD);\n  documentRef.update(...payload);\n}\n\nexport function updateField(\n  documentRef: firestore.DocumentReference,\n  documentData: FirestoreMap,\n  path: string[],\n  value: FirestoreAny\n) {\n  const payload = adjustPayloadForArray(documentData, path, value);\n  documentRef.update(...payload);\n}\n\nexport async function addFieldToMissingDocument(\n  reference: firestore.DocumentReference,\n  key: string,\n  value: FirestoreAny\n) {\n  const snapshot = await reference.get();\n  if (snapshot.exists) {\n    // TODO: Better surface this to the user.\n    throw new Error('.set() on an existing document would delete other fields');\n  }\n\n  await reference.set({ [key]: value });\n}\n\n/**\n * Firestore does not allow array syntax when updating/deleting fields i.e.\n * .update('obj.array[2]', true)\n *\n * This normalizes a payload's `objectPath` and `updateValue` into a form\n * that writes to the top most array with a reconstructed payload contains the\n * updated (or deleted) value.\n */\nfunction adjustPayloadForArray(\n  doc: FirestoreMap,\n  fieldPath: string[],\n  value: FirestoreAny | firestore.FieldValue\n): [firestore.FieldPath, FirestoreAny] {\n  let cur: FirestoreAny | undefined = doc;\n  let parentPath: string[] = [];\n  for (const key of fieldPath) {\n    if (cur === undefined || !isMap(cur)) {\n      throw new Error(`Tried to set field ${key} on non-map value.`);\n    }\n    cur = cur[key];\n    parentPath.push(key);\n    if (parentPath.length < fieldPath.length && isArray(cur)) {\n      // Note: We're avoiding arrayUnion, arrayRemove, etc. since they may\n      // skip adding or / remove all \"equal\" elements. Checking the edge cases\n      // will require implementing Firestore deep equals locally, which is way\n      // beyond the scope of this function and hard to keep in sync.\n      // Instead, just overwrite the whole array, which may touch more data\n      // than needed, but is always correct.\n      const pathToUpdate = new firestore.FieldPath(...parentPath);\n      const childPath = fieldPath.slice(parentPath.length);\n\n      // Note: FieldValue sentinels are not guaranteed to be\n      // `instanceof FieldValue`, so let's just use type casting here.\n      if (value === DELETE_FIELD || (value as any)?.isEqual?.(DELETE_FIELD)) {\n        return [pathToUpdate, withFieldRemoved(cur, childPath)];\n      } else {\n        return [pathToUpdate, withFieldSet(cur, childPath, value)];\n      }\n    }\n  }\n  return [new firestore.FieldPath(...fieldPath), value];\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport get from 'lodash.get';\nimport React from 'react';\n\nimport { FirestoreAny, FirestoreMap } from '../models';\n\nconst DocumentStateContext = React.createContext<FirestoreMap>({});\n\nexport const DocumentProvider: React.FC<{\n  value: FirestoreMap;\n}> = ({ value, children }) => {\n  return (\n    <DocumentStateContext.Provider value={value}>\n      {children}\n    </DocumentStateContext.Provider>\n  );\n};\n\nexport function useDocumentState(): FirestoreMap {\n  const context = React.useContext(DocumentStateContext);\n  if (context === undefined) {\n    throw new Error('useDocumentState must be used within a DocumentProvider');\n  }\n  return context;\n}\n\nexport function useFieldState(path: string[]): FirestoreAny {\n  const documentState = useDocumentState();\n  if (path.length === 0) return documentState;\n  return get(documentState, path);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './FieldPreview.scss';\n\nimport { Icon } from '@rmwc/icon';\nimport { IconButton } from '@rmwc/icon-button';\nimport { ListItem, ListItemMeta } from '@rmwc/list';\nimport { Theme } from '@rmwc/theme';\nimport classnames from 'classnames';\nimport { firestore } from 'firebase';\nimport React, { useState } from 'react';\n\nimport { supportsEditing } from '../DocumentEditor';\nimport { FieldType, FirestoreAny, FirestoreArray } from '../models';\nimport {\n  getFieldType,\n  getParentPath,\n  isArray,\n  isMap,\n  isPrimitive,\n  lastFieldName,\n} from '../utils';\nimport { deleteField, updateField } from './api';\nimport InlineEditor from './InlineEditor';\nimport { useDocumentState, useFieldState } from './store';\n\nconst FieldPreview: React.FC<{\n  path: string[];\n  documentRef: firestore.DocumentReference;\n  maxSummaryLen: number;\n}> = ({ path, documentRef, maxSummaryLen }) => {\n  const documentData = useDocumentState();\n  const parentState = useFieldState(path.slice(0, -1));\n  const state = useFieldState(path);\n  const [isEditing, setIsEditing] = useState(false);\n  const [isExpanded, setIsExpanded] = useState(true);\n  const [isAddingField, setIsAddingField] = useState(false);\n\n  let childFields = null;\n  if (isMap(state)) {\n    // Inline editor for new field will default to key: ''\n    childFields = Object.keys(state).map(childLeaf => {\n      const childPath = [...path, childLeaf];\n      return (\n        <FieldPreview\n          key={childLeaf}\n          path={childPath}\n          documentRef={documentRef}\n          maxSummaryLen={maxSummaryLen}\n        />\n      );\n    });\n  } else if (isArray(state)) {\n    // Inline editor for new field will default to key: '{index}'\n    childFields = state.map((value, index) => {\n      const childPath = [...path, `${index}`];\n      return (\n        <FieldPreview\n          key={index}\n          path={childPath}\n          documentRef={documentRef}\n          maxSummaryLen={maxSummaryLen}\n        />\n      );\n    });\n  }\n\n  return isEditing ? (\n    <>\n      {isArray(parentState) && (\n        <InlineEditor\n          value={[state] as FirestoreArray}\n          onCancel={() => {\n            setIsEditing(false);\n          }}\n          onSave={(key, value) => {\n            updateField(documentRef, documentData, path, value);\n            setIsEditing(false);\n          }}\n          areRootKeysMutable={false}\n        />\n      )}\n      {isMap(parentState) && (\n        <InlineEditor\n          value={{ [lastFieldName(path)]: state }}\n          onCancel={() => {\n            setIsEditing(false);\n          }}\n          onSave={(key, value) => {\n            updateField(\n              documentRef,\n              documentData,\n              [...getParentPath(path), key],\n              value\n            );\n            setIsEditing(false);\n          }}\n          areRootKeysMutable={false}\n        />\n      )}\n    </>\n  ) : (\n    <>\n      <ListItem\n        onClick={() => setIsExpanded(!isExpanded)}\n        className={classnames('FieldPreview', {\n          'FieldPreview--primitive': isPrimitive(state),\n          'FieldPreview--expanded': !isPrimitive(state) && isExpanded,\n        })}\n      >\n        <Icon\n          className=\"FieldPreview-expand-icon\"\n          icon={{\n            size: 'xsmall',\n            icon: isExpanded ? 'arrow_drop_down' : 'arrow_right',\n          }}\n        />\n        <Theme use=\"secondary\" tag=\"span\" className=\"FieldPreview-key\">\n          {lastFieldName(path)}\n        </Theme>\n        <span className=\"FieldPreview-summary\">\n          {summarize(state, maxSummaryLen)}\n        </span>\n        <ListItemMeta className=\"FieldPreview-actions\">\n          <span className=\"FieldPreview-type\">({getFieldType(state)})</span>\n          {isPrimitive(state) && supportsEditing(state) && (\n            <IconButton\n              icon=\"edit\"\n              label=\"Edit field\"\n              onClick={e => {\n                e.stopPropagation();\n                setIsEditing(true);\n              }}\n            />\n          )}{' '}\n          {(isArray(state) || isMap(state)) && (\n            <IconButton\n              icon=\"add\"\n              label=\"Add field\"\n              onClick={e => {\n                e.stopPropagation();\n                setIsAddingField(true);\n              }}\n            />\n          )}\n          <IconButton\n            icon=\"delete\"\n            label=\"Remove field\"\n            onClick={e => {\n              e.stopPropagation();\n              deleteField(documentRef, documentData, path);\n            }}\n          />\n        </ListItemMeta>\n      </ListItem>\n\n      {isAddingField && isArray(state) && (\n        <InlineEditor\n          value={['']}\n          onCancel={() => {\n            setIsAddingField(false);\n          }}\n          startingIndex={state.length}\n          onSave={(key, value) => {\n            const newPath = [...path, `${state.length}`];\n            updateField(documentRef, documentData, newPath, value);\n            setIsAddingField(false);\n          }}\n          areRootKeysMutable={!isArray(state)}\n        />\n      )}\n\n      {isAddingField && isMap(state) && (\n        <InlineEditor\n          value={{ '': '' }}\n          onCancel={() => {\n            setIsAddingField(false);\n          }}\n          onSave={(key, value) => {\n            const newPath = [...path, key];\n            updateField(documentRef, documentData, newPath, value);\n            setIsAddingField(false);\n          }}\n          areRootKeysMutable={!isArray(state)}\n        />\n      )}\n\n      {!isPrimitive(state) && isExpanded && (\n        <div className=\"FieldPreview-children\">{childFields}</div>\n      )}\n    </>\n  );\n};\n\n// Give a brief text summary of the data.\n// Note: maxLen is soft (at least for now). End result may still be longer.\nfunction summarize(data: FirestoreAny, maxLen: number): string {\n  switch (getFieldType(data)) {\n    case FieldType.ARRAY:\n      return summarizeArray(data as FirestoreAny[], maxLen);\n    case FieldType.MAP:\n      return summarizeMap(data as Record<string, FirestoreAny>, maxLen);\n    case FieldType.BLOB:\n      const base64 = (data as firestore.Blob).toBase64();\n      if (base64.length < maxLen) return base64;\n      else return base64.substr(0, maxLen) + '...';\n    case FieldType.BOOLEAN:\n      return (data as boolean).toString();\n    case FieldType.GEOPOINT:\n      const value = data as firestore.GeoPoint;\n      return `[${latStr(value.latitude)}, ${longStr(value.longitude)}]`;\n    case FieldType.NULL:\n      return 'null';\n    case FieldType.NUMBER:\n      return (data as number).toString();\n    case FieldType.REFERENCE:\n      return (data as firestore.DocumentReference).path;\n    case FieldType.STRING:\n      return `\"${data as string}\"`;\n    case FieldType.TIMESTAMP:\n      // TODO: Better date time formatting.\n      // Note: Not using toLocaleString() since it does not stringify timezone.\n      return (data as firestore.Timestamp).toDate().toString();\n    case FieldType.JSON:\n      throw new Error('JSON field type is input only');\n  }\n}\n\nfunction summarizeArray(array: FirestoreAny[], maxLen: number): string {\n  let output = '[';\n  for (const element of array) {\n    if (output.length > 1) output += ', ';\n    if (output.length > maxLen) {\n      output += '...';\n      break;\n    }\n    output += summarize(element, maxLen - output.length);\n  }\n  output += ']';\n  return output;\n}\n\nfunction summarizeMap(\n  map: Record<string, FirestoreAny>,\n  maxLen: number\n): string {\n  let output = '{';\n  for (const [key, value] of Object.entries(map)) {\n    if (output.length > 1) output += ', ';\n    if (output.length > maxLen) {\n      output += '...';\n      break;\n    }\n    output += `${key}: ${summarize(value, maxLen - output.length)}`;\n  }\n  output += '}';\n  return output;\n}\n\nfunction latStr(lat: number): string {\n  return `${Math.abs(lat)} ${lat >= 0 ? 'N' : 'S'}`;\n}\n\nfunction longStr(long: number): string {\n  return `${Math.abs(long)} ${long >= 0 ? 'E' : 'W'}`;\n}\n\nexport default FieldPreview;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport './HighlightedJSON.scss';\n\nimport React from 'react';\n\nimport { CompiledGetterCache } from './CompiledGetterCache';\n\nexport enum HierarchyReferenceMode {\n  NONE,\n  DOT,\n  BRACKET,\n  INCREMENT,\n}\n\nexport interface HierarchyReference {\n  mode: HierarchyReferenceMode;\n  key: number | string;\n}\n\nconst toHierarchyStep = (key: string) => {\n  if (key.match(/^[A-Z|_]+$/i)) {\n    return {\n      mode: HierarchyReferenceMode.DOT,\n      key,\n    };\n  } else {\n    return {\n      mode: HierarchyReferenceMode.BRACKET,\n      key,\n    };\n  }\n};\n\nconst toHierarchyJS = (hierarchy: HierarchyReference[]) =>\n  hierarchy\n    .map(ref => {\n      switch (ref.mode) {\n        case HierarchyReferenceMode.NONE:\n          return ref.key;\n        case HierarchyReferenceMode.BRACKET:\n          return `[\"${ref.key}\"]`;\n        case HierarchyReferenceMode.DOT:\n          return `.${ref.key}`;\n        case HierarchyReferenceMode.INCREMENT:\n          return `[${JSON.stringify(ref.key)}]`;\n      }\n\n      return '';\n    })\n    .join('');\n\nexport interface Props {\n  data: object;\n  appendToQuery: (key: string, value: string) => void;\n  compiledGetters: CompiledGetterCache;\n}\n\nexport const HighlightedJSON: React.FC<Props> = ({\n  data,\n  appendToQuery,\n  compiledGetters,\n}) => {\n  const lines = JSON.stringify(data, null, 2).split('\\n');\n\n  if (lines.length === 1)\n    return <div className=\"log-message-single\">{data}</div>;\n\n  let isObject = false;\n\n  let hierarchy: HierarchyReference[] = [\n    {\n      mode: HierarchyReferenceMode.NONE,\n      key: 'user',\n    },\n  ];\n\n  const pluck = (obj: any, path: string) => {\n    return compiledGetters.getOrCompile(path, { user: obj });\n  };\n\n  const elements = lines.map((line, index) => {\n    const quote_count = line.split('\"').length - 1;\n\n    const isStart = index === 0 && line.startsWith('{');\n    const isEnd = index === lines.length - 1 && line.endsWith('}');\n    const isKeylessArrayStart = line.trim().length === 1 && line.endsWith('[');\n    const isKeylessObjStart = line.trim().length === 1 && line.endsWith('{');\n    const isKeyedObjStart = quote_count >= 2 && line.endsWith('{');\n    const isLiteral =\n      !line.endsWith('[') &&\n      !line.endsWith('{') &&\n      !line.endsWith('}') &&\n      !line.endsWith('},');\n    const isObjEnd = line.endsWith('}') || line.endsWith('},');\n    const isArrayStart = quote_count >= 2 && line.endsWith('[');\n    const isArrayEnd = line.endsWith(']') || line.endsWith('],');\n\n    if (isStart) {\n      isObject = true;\n      return (\n        <div key={index} className=\"line start\">\n          {line}\n        </div>\n      );\n    }\n\n    if (isEnd) {\n      return (\n        <div key={index} className=\"line end\">\n          {line}\n        </div>\n      );\n    }\n\n    if (isKeylessObjStart || isKeylessArrayStart || isLiteral) {\n      const ref = hierarchy[hierarchy.length - 1];\n      if (ref.mode === HierarchyReferenceMode.INCREMENT) {\n        (ref as any).key += 1;\n      }\n    }\n\n    if (isKeylessObjStart) {\n      hierarchy.push({ mode: HierarchyReferenceMode.NONE, key: '' });\n    }\n\n    if (isKeylessArrayStart) {\n      hierarchy.push({ mode: HierarchyReferenceMode.NONE, key: '' });\n      hierarchy.push({ mode: HierarchyReferenceMode.INCREMENT, key: -1 });\n    }\n\n    if (isKeyedObjStart || isArrayStart) {\n      const [start, ...splat] = line.split(':');\n      const [indent, ...key_chunks] = start.split('\"');\n      const key = key_chunks.filter((v: string) => v).join('\"');\n      const value = splat.join(':');\n\n      hierarchy.push(toHierarchyStep(key));\n      const hierarchy_chain = toHierarchyJS(hierarchy);\n\n      if (isArrayStart) {\n        hierarchy.push({ mode: HierarchyReferenceMode.INCREMENT, key: -1 });\n      }\n\n      return (\n        <div key={index} className=\"line object-start\">\n          {indent}\n          <div\n            className=\"clickable key\"\n            onClick={() => appendToQuery(hierarchy_chain, '*')}\n          >\n            \"{key}\"\n          </div>\n          :{value}\n        </div>\n      );\n    }\n\n    if (isObjEnd) {\n      if (\n        hierarchy[hierarchy.length - 1].mode !==\n        HierarchyReferenceMode.INCREMENT\n      ) {\n        hierarchy.pop();\n      }\n      return (\n        <div key={index} className=\"line object-end\">\n          {line}\n        </div>\n      );\n    }\n\n    if (isArrayEnd) {\n      hierarchy.pop(); // Remove reference with array name (i.e. \"users\")\n      hierarchy.pop(); // Remove reference with array index (i.e. 3)\n\n      return (\n        <div key={index} className=\"line array-end\">\n          {line}\n        </div>\n      );\n    }\n\n    if (isLiteral) {\n      if (!isObject) {\n        return (\n          <div key={index} className=\"line literal\">\n            <div className=\"value clickable\">{line}</div>\n          </div>\n        );\n      }\n\n      const [start, ...splat] = line.split(':');\n      const key_chunks = start.split('\"').slice(1);\n      const key = key_chunks.filter((v: string) => v).join('\"');\n      const value = splat.join(':').trim();\n\n      const new_indent = new Array(line.length - line.trim().length + 1).join(\n        ' '\n      );\n      if (key && value) {\n        const hierarchy_chain = toHierarchyJS([\n          ...hierarchy,\n          toHierarchyStep(key),\n        ]);\n        return (\n          <div key={index} className=\"line literal\">\n            {new_indent}\n            <div\n              className=\"key clickable\"\n              onClick={() => appendToQuery(hierarchy_chain, '*')}\n            >\n              \"{key}\"\n            </div>\n            :{' '}\n            <div\n              className=\"clickable value\"\n              onClick={() =>\n                appendToQuery(hierarchy_chain, pluck(data, hierarchy_chain))\n              }\n            >\n              {value}\n            </div>\n          </div>\n        );\n      } else {\n        const hierarchy_chain = toHierarchyJS(hierarchy);\n        return (\n          <div key={index} className=\"line literal\">\n            {new_indent}\n            <div\n              className=\"clickable value\"\n              onClick={() =>\n                appendToQuery(hierarchy_chain, pluck(data, hierarchy_chain))\n              }\n            >\n              {line.trim()}\n            </div>\n          </div>\n        );\n      }\n    }\n\n    return (\n      <div key={index} className={`line generic`}>\n        {line}\n      </div>\n    );\n  });\n\n  return <div className=\"HighlightedJSON\">{elements}</div>;\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport { List, ListItem } from '@rmwc/list';\nimport { Typography } from '@rmwc/typography';\nimport { firestore } from 'firebase';\nimport React, { useState } from 'react';\nimport { useDocumentData } from 'react-firebase-hooks/firestore';\n\nimport { FirestoreMap } from '../models';\nimport { isMap } from '../utils';\nimport { addFieldToMissingDocument, updateField } from './api';\nimport FieldPreview from './FieldPreview';\nimport InlineEditor from './InlineEditor';\nimport { DocumentProvider } from './store';\n\nexport interface Props {\n  reference: firestore.DocumentReference;\n  maxSummaryLen?: number;\n}\n\nconst DocumentPreview: React.FC<Props> = ({\n  reference,\n  maxSummaryLen = 20,\n}) => {\n  const [data, loading, error] = useDocumentData<FirestoreMap>(reference);\n  const [isAddingField, setIsAddingField] = useState(false);\n\n  if (loading) return <div>Loading document...</div>;\n  if (error) return <div>Error retrieving document</div>;\n\n  return (\n    <>\n      <DocumentProvider value={data || {}}>\n        <List\n          dense\n          className=\"List-Actions Firestore-Document-Fields\"\n          tag=\"div\"\n        >\n          {/* Actions */}\n          <ListItem\n            className=\"list-button\"\n            tag={Button}\n            label=\"Add field\"\n            {...{ dense: true, icon: 'add' }} // types get confused\n            onClick={() => setIsAddingField(true)}\n          ></ListItem>\n\n          {isAddingField && (\n            <InlineEditor\n              value={{ '': '' }}\n              onCancel={() => {\n                setIsAddingField(false);\n              }}\n              onSave={async (key, value) => {\n                if (!data) {\n                  await addFieldToMissingDocument(reference, key, value);\n                } else {\n                  updateField(reference, data, [key], value);\n                }\n                setIsAddingField(false);\n              }}\n              areRootKeysMutable={true}\n            />\n          )}\n\n          {data && isMap(data) ? (\n            <div className=\"Firestore-Field-List\">\n              {Object.keys(data).map(name => (\n                <FieldPreview\n                  key={name}\n                  path={[name]}\n                  documentRef={reference}\n                  maxSummaryLen={maxSummaryLen}\n                />\n              ))}\n            </div>\n          ) : (\n            <Typography\n              theme=\"secondary\"\n              use=\"body2\"\n              className=\"Firestore-Document-Warning\"\n            >\n              <i>\n                This document does not exist, it will not appear in queries or\n                snapshots\n              </i>\n            </Typography>\n          )}\n        </List>\n      </DocumentProvider>\n    </>\n  );\n};\n\nexport default DocumentPreview;\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Icon } from '@rmwc/icon';\nimport { IconButton } from '@rmwc/icon-button';\nimport { ListDivider } from '@rmwc/list';\nimport { MenuItem, SimpleMenu } from '@rmwc/menu';\nimport { firestore } from 'firebase';\nimport React from 'react';\nimport { Route, useRouteMatch } from 'react-router-dom';\n\nimport { FirestoreIcon } from '../common/icons';\nimport { useApi } from './ApiContext';\nimport Collection from './Collection';\nimport CollectionList from './CollectionList';\nimport { promptDeleteDocument } from './dialogs/deleteDocument';\nimport { promptDeleteDocumentFields } from './dialogs/deleteDocumentFields';\nimport DocumentPreview from './DocumentPreview';\nimport PanelHeader from './PanelHeader';\n\nconst Doc: React.FC<{\n  id: string;\n  collectionById: (id: string) => firestore.CollectionReference;\n  children: React.ReactNode;\n}> = ({ collectionById, children }) => {\n  const { url } = useRouteMatch()!;\n\n  return (\n    <>\n      <div className=\"Firestore-Document\">{children}</div>\n\n      <Route\n        path={`${url}/:id`}\n        render={({ match }: any) => (\n          <Collection collection={collectionById(match.params.id)} />\n        )}\n      ></Route>\n    </>\n  );\n};\n\n/** Root node */\nexport const Root: React.FC = () => {\n  const api = useApi();\n\n  return (\n    <Doc\n      id={'Root'}\n      collectionById={(id: string) => api.database.collection(id)}\n    >\n      <PanelHeader id=\"Root\" icon={<FirestoreIcon />} />\n      <CollectionList />\n    </Doc>\n  );\n};\n\n/** Document node */\nexport const Document: React.FC<{ reference: firestore.DocumentReference }> = ({\n  reference,\n}) => {\n  const handleDeleteDocument = async () => {\n    const shouldDelete = await promptDeleteDocument(reference);\n    // TODO: recursively delete sub documents\n    shouldDelete && reference.delete();\n  };\n\n  const handleDeleteFields = async () => {\n    const shouldDelete = await promptDeleteDocumentFields(reference);\n    shouldDelete && reference.set({});\n  };\n\n  return (\n    <Doc\n      id={reference.id}\n      collectionById={(id: string) => reference.collection(id)}\n    >\n      <PanelHeader\n        id={reference.id}\n        icon={<Icon icon={{ icon: 'insert_drive_file', size: 'small' }} />}\n      >\n        <SimpleMenu handle={<IconButton icon=\"more_vert\" />} renderToPortal>\n          <MenuItem onClick={handleDeleteDocument}>Delete document</MenuItem>\n          <MenuItem onClick={handleDeleteFields}>Delete all fields</MenuItem>\n        </SimpleMenu>\n      </PanelHeader>\n\n      <CollectionList reference={reference} />\n      <ListDivider tag=\"div\" />\n      <DocumentPreview reference={reference} />\n    </Doc>\n  );\n};\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Button } from '@rmwc/button';\nimport { Card } from '@rmwc/card';\nimport { Elevation } from '@rmwc/elevation';\nimport { GridCell } from '@rmwc/grid';\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { useHistory, useLocation } from 'react-router-dom';\n\nimport { createStructuredSelector } from '../../store';\nimport { FirestoreConfig } from '../../store/config';\nimport {\n  getFirestoreConfigResult,\n  getProjectIdResult,\n} from '../../store/config/selectors';\nimport { combineData, handle } from '../../store/utils';\nimport { CustomThemeProvider } from '../../themes';\nimport { EmulatorDisabled } from '../common/EmulatorDisabled';\nimport { InteractiveBreadCrumbBar } from '../common/InteractiveBreadCrumbBar';\nimport { Spinner } from '../common/Spinner';\nimport DatabaseApi from './api';\nimport { ApiProvider } from './ApiContext';\nimport { promptClearAll } from './dialogs/clearAll';\nimport { Root } from './Document';\nimport PanelHeader from './PanelHeader';\nimport { FirestoreStore } from './store';\n\nexport const mapStateToProps = createStructuredSelector({\n  projectIdResult: getProjectIdResult,\n  configResult: getFirestoreConfigResult,\n});\n\nexport type PropsFromState = ReturnType<typeof mapStateToProps>;\n\nexport const FirestoreRoute: React.FC<PropsFromState> = ({\n  projectIdResult,\n  configResult,\n}) => {\n  return handle(combineData(projectIdResult, configResult), {\n    onNone: () => <Spinner span={12} message=\"Firestore Emulator Loading...\" />,\n    onError: () => <FirestoreRouteDisabled />,\n    onData: ([projectId, config]) =>\n      config === undefined ? (\n        <FirestoreRouteDisabled />\n      ) : (\n        <Firestore projectId={projectId} config={config} />\n      ),\n  });\n};\n\nexport default connect(mapStateToProps)(FirestoreRoute);\n\nexport interface FirestoreProps {\n  config: FirestoreConfig;\n  projectId: string;\n}\n\nexport const Firestore: React.FC<FirestoreProps> = ({ config, projectId }) => {\n  const [api, setApi] = useState<DatabaseApi | undefined>(undefined);\n  const databaseId = '(default)';\n  const location = useLocation();\n  const history = useHistory();\n  const [isRefreshing, setIsRefreshing] = useState(false);\n\n  // TODO: do something better here!\n  const path = location.pathname.replace(/^\\/firestore/, '');\n  const showCollectionShell = path.split('/').length < 2;\n  const showDocumentShell = path.split('/').length < 3;\n\n  useEffect(() => {\n    const api = new DatabaseApi(projectId, databaseId, config);\n    setApi(api);\n\n    return function cleanup() {\n      api.delete();\n    };\n  }, [projectId, config, setApi]);\n\n  if (!api) {\n    return null;\n  }\n\n  async function handleClearData(api: DatabaseApi) {\n    const shouldNuke = await promptClearAll();\n    if (!shouldNuke) return;\n    setIsRefreshing(true);\n    await api.nukeDocuments();\n    handleNavigate();\n    setIsRefreshing(false);\n  }\n\n  function handleNavigate(path?: string) {\n    // TODO: move to routing constants\n    const root = '/firestore';\n    if (path === undefined) {\n      history.push(root);\n    } else {\n      history.push(`${root}/${path}`);\n    }\n  }\n\n  return isRefreshing ? (\n    <Spinner span={12} data-testid=\"firestore-loading\" />\n  ) : (\n    <FirestoreStore>\n      <ApiProvider value={api}>\n        <GridCell span={12} className=\"Firestore\">\n          <div className=\"Firestore-actions\">\n            <CustomThemeProvider use=\"warning\" wrap>\n              <Button unelevated onClick={() => handleClearData(api)}>\n                Clear all data\n              </Button>\n            </CustomThemeProvider>\n          </div>\n          <Elevation z=\"2\" wrap>\n            <Card className=\"Firestore-panels-wrapper\">\n              <InteractiveBreadCrumbBar\n                base=\"/firestore\"\n                path={path}\n                onNavigate={handleNavigate}\n              />\n              <div className=\"Firestore-panels\">\n                <Root />\n                {/*\n                 * TODO: This should really be handled by the constituent Document/Collection components,\n                 * where those components can conditionally show their nested-child. Doing so will be\n                 * easiest once we move to a Suspense-ful render, where we can always show the\n                 * Document/Collection-skeletons, but lazy-render the lists wihin those components.\n                 */}\n                {showCollectionShell && (\n                  <div\n                    className=\"Firestore-Collection\"\n                    data-testid=\"collection-shell\"\n                  >\n                    <PanelHeader id=\"\" icon={null} />\n                  </div>\n                )}\n                {showDocumentShell && (\n                  <div\n                    className=\"Firestore-Document\"\n                    data-testid=\"document-shell\"\n                  >\n                    <PanelHeader id=\"\" icon={null} />\n                  </div>\n                )}\n              </div>\n            </Card>\n          </Elevation>\n        </GridCell>\n      </ApiProvider>\n    </FirestoreStore>\n  );\n};\n\nexport const FirestoreRouteDisabled: React.FC = () => (\n  <EmulatorDisabled productName=\"Firestore\" />\n);\n","import { useLocalStorage, writeStorage } from '@rehooks/local-storage';\nimport { Button } from '@rmwc/button';\nimport { GridCell } from '@rmwc/grid';\nimport React from 'react';\n\nimport { Callout } from '../common/Callout';\nimport { CONSOLE_ROOT } from '../common/constants';\n\nconst DISMISS_KEY = 'isLocalWarningCalloutDismissed';\n\nexport const LocalWarningCallout: React.FC<{\n  projectId: string;\n}> = ({ projectId }) => {\n  const [isDismissed] = useLocalStorage<boolean>(DISMISS_KEY);\n\n  if (isDismissed) {\n    return null;\n  }\n\n  return (\n    <GridCell span={12}>\n      <Callout\n        type=\"note\"\n        actions={\n          <>\n            <Button\n              tag=\"a\"\n              href={`${CONSOLE_ROOT}/project/${projectId}/overview`}\n              target=\"_blank\"\n              label=\"View project\"\n            />\n            <Button\n              label=\"Dismiss\"\n              onClick={() => writeStorage(DISMISS_KEY, true)}\n            />\n          </>\n        }\n      >\n        Remember this is a local environment. Visit the production version of{' '}\n        <strong>{projectId}</strong> in the console.\n      </Callout>\n    </GridCell>\n  );\n};\n","export const CONSOLE_ROOT = 'https://console.firebase.google.com';\n","import { Icon } from '@rmwc/icon';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport { CustomThemeProvider } from '../../themes';\nimport styles from './StatusLabel.module.scss';\n\nconst ACTIVE_ICON = {\n  icon: 'check_circle',\n  size: 'xsmall',\n};\n\nconst INACTIVE_ICON = {\n  icon: 'block',\n  size: 'xsmall',\n};\n\n/** A basic On/Off label with icon */\nexport const StatusLabel: React.FC<{\n  isActive: boolean;\n}> = ({ isActive }) => {\n  return (\n    <CustomThemeProvider use={isActive ? 'success' : 'note'} wrap>\n      <Typography\n        use=\"headline6\"\n        tag=\"div\"\n        theme={isActive ? 'primary' : 'secondary'}\n        className={styles.container}\n      >\n        {isActive ? 'On' : 'Off'}\n        <Icon\n          icon={isActive ? ACTIVE_ICON : INACTIVE_ICON}\n          className={styles.icon}\n        />\n      </Typography>\n    </CustomThemeProvider>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport {\n  Card,\n  CardActionButton,\n  CardActionIcons,\n  CardActions,\n} from '@rmwc/card';\nimport { GridCell, GridRow } from '@rmwc/grid';\nimport { ListDivider } from '@rmwc/list';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\n\nimport { createStructuredSelector } from '../../store';\nimport { Config, EmulatorConfig } from '../../store/config';\nimport { getConfig } from '../../store/config/selectors';\nimport { squash } from '../../store/utils';\nimport {\n  DatabaseIcon,\n  FirestoreIcon,\n  FunctionsIcon,\n  HostingIcon,\n  PubSubIcon,\n} from '../common/icons';\nimport { Spinner } from '../common/Spinner';\nimport { LocalWarningCallout } from './LocalWarningCallout';\nimport { StatusLabel } from './StatusLabel';\n\nexport const mapStateToProps = createStructuredSelector({\n  configRemote: getConfig,\n});\n\nexport type PropsFromState = ReturnType<typeof mapStateToProps>;\nexport type Props = PropsFromState;\n\nexport const Home: React.FC<Props> = ({ configRemote }) =>\n  squash(configRemote, {\n    onNone: () => <Spinner span={12} message=\"Overview Page Loading...\" />,\n    onData: config => <Overview config={config} />,\n    // Show all emulators as \"off\" on error.\n    onError: () => <Overview config={{}} />,\n  });\n\nexport default connect(mapStateToProps)(Home);\n\nconst Overview: React.FC<{\n  config: Partial<Config>;\n}> = ({ config }) => {\n  return (\n    <GridCell span={12}>\n      <GridRow>\n        {config.projectId && (\n          <LocalWarningCallout projectId={config.projectId} />\n        )}\n        <GridCell span={12}>\n          <Typography use=\"headline5\">Emulator overview</Typography>\n        </GridCell>\n        <EmulatorCard\n          name=\"Firestore emulator\"\n          icon={<FirestoreIcon theme=\"secondary\" />}\n          config={config.firestore}\n          linkTo=\"/firestore\"\n          testId=\"emulator-info-firestore\"\n        />\n        <EmulatorCard\n          name=\"Realtime Database emulator\"\n          icon={<DatabaseIcon theme=\"secondary\" />}\n          config={config.database}\n          linkTo=\"/database\"\n          testId=\"emulator-info-database\"\n        />\n        <EmulatorCard\n          name=\"Functions emulator\"\n          icon={<FunctionsIcon theme=\"secondary\" />}\n          config={config.functions}\n          linkTo=\"/functions\"\n          linkLabel=\"View logs\"\n          testId=\"emulator-info-functions\"\n        />\n        <EmulatorCard\n          name=\"Hosting emulator\"\n          icon={<HostingIcon theme=\"secondary\" />}\n          config={config.hosting}\n          testId=\"emulator-info-hosting\"\n          linkToExternal={\n            config.hosting && `http://${config.hosting.hostAndPort}/`\n          }\n          linkLabel=\"View website\"\n        />\n        <EmulatorCard\n          name=\"PubSub emulator\"\n          icon={<PubSubIcon theme=\"secondary\" />}\n          config={config.pubsub}\n          testId=\"emulator-info-pubsub\"\n        />\n      </GridRow>\n    </GridCell>\n  );\n};\n\nexport const EmulatorCard: React.FC<{\n  name: string;\n  icon: React.ReactElement;\n  config: EmulatorConfig | undefined;\n  linkTo?: string;\n  linkToExternal?: string;\n  linkLabel?: string;\n  testId?: string;\n}> = ({ name, icon, config, linkTo, linkLabel, linkToExternal, testId }) => (\n  <GridCell span={4}>\n    <Card className=\"Home-EmulatorCard\" data-testid={testId}>\n      <div className=\"Home-EmulatorCard-Info\">\n        <Typography use=\"headline6\" tag=\"h3\" className=\"title\">\n          {icon} <span>{name}</span>\n        </Typography>\n        <Typography use=\"body2\" tag=\"h4\" theme=\"secondary\">\n          Status\n        </Typography>\n        <StatusLabel isActive={!!config} />\n        <Typography use=\"body2\" tag=\"h4\" theme=\"secondary\">\n          Port number\n        </Typography>\n        <Typography use=\"headline6\" tag=\"div\">\n          {config ? config.port : 'N/A'}\n        </Typography>\n      </div>\n      {(linkToExternal || linkTo) && <ListDivider tag=\"div\" />}\n      <CardActions>\n        <CardActionIcons>\n          {linkToExternal && (\n            <CardActionButton tag=\"a\" href={linkToExternal} target=\"_blank\">\n              {linkLabel}\n            </CardActionButton>\n          )}\n          {linkTo && (\n            <CardActionButton tag={Link} to={linkTo}>\n              {linkLabel || 'Go to emulator'}\n            </CardActionButton>\n          )}\n        </CardActionIcons>\n      </CardActions>\n    </Card>\n  </GridCell>\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport class CompiledGetterCache {\n  getters: { [path: string]: Function } = {};\n\n  getOrCompile(path: string, obj: any) {\n    if (!this.getters[path]) {\n      try {\n        // eslint-disable-next-line no-new-func\n        this.getters[path] = new Function('obj', 'return obj.' + path + ';');\n      } catch (err) {\n        console.warn(err);\n        return undefined;\n      }\n    }\n\n    try {\n      return this.getters[path](obj);\n    } catch (err) {\n      return undefined;\n    }\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport './QueryBar.scss';\n\nimport { Button } from '@rmwc/button';\nimport React, { useEffect, useState } from 'react';\n\nimport { LogEntry } from '../../store/logviewer';\nimport { CompiledGetterCache } from './CompiledGetterCache';\n\nexport const filtersToQueryString = (filters: {\n  [key: string]: string | number;\n}) => {\n  const formattedQueryLines = [];\n  for (const key in filters) {\n    formattedQueryLines.push(`${key}=${JSON.stringify(filters[key])}`);\n  }\n  return formattedQueryLines.sort().join('\\n');\n};\n\nexport const isQueryMatch = (\n  query: { filters: { [key: string]: string } },\n  log: LogEntry,\n  compiledGetters: CompiledGetterCache\n) => {\n  for (const originalFieldPath of Object.keys(query.filters)) {\n    if (originalFieldPath === 'search') {\n      const stringifedLog = JSON.stringify(log).toLowerCase();\n\n      if (\n        stringifedLog.indexOf(\n          query.filters[originalFieldPath].toLowerCase()\n        ) === -1\n      ) {\n        return false;\n      }\n    } else {\n      let fieldPath = originalFieldPath;\n      if (\n        fieldPath.startsWith('user.') ||\n        fieldPath.startsWith('metadata.') ||\n        fieldPath.startsWith('user[') ||\n        fieldPath.startsWith('metadata[')\n      ) {\n        fieldPath = `data.${fieldPath}`;\n      }\n\n      const fieldValue = query.filters[originalFieldPath];\n      const value = compiledGetters.getOrCompile(fieldPath, log);\n      if (\n        !value ||\n        (fieldValue !== undefined &&\n          fieldValue !== '*' &&\n          fieldValue.toString() !== value.toString())\n      ) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n};\n\nexport interface ParsedQuery {\n  elements: JSX.Element[];\n  filters: { [key: string]: string };\n}\n\nconst queryFields = [\n  'level',\n  'search',\n  'metadata.emulator',\n  'metadata.emulator.name',\n  'metadata.function',\n  'metadata.function.name',\n];\nexport function parseQuery(query: string): ParsedQuery {\n  let escapedQuery = '';\n  let isEscaped = false;\n\n  for (const char of query) {\n    if (isEscaped) {\n      escapedQuery += '';\n      isEscaped = false;\n    } else {\n      escapedQuery += char;\n\n      if (char === '\\\\') {\n        isEscaped = true;\n      }\n    }\n  }\n\n  const quoted_query = escapedQuery\n    .split('\"')\n    .map((t, i) => (i % 2 ? t.replace(/ /g, '') : t))\n    .join('\"');\n\n  const sections: string[] = quoted_query\n    .split('\\n')\n    .reduce((sections, line) => {\n      return [\n        ...sections,\n        ...line.split(/((?:[^\\s]+)\\s?=\\s?(?:[^\\s]+))/),\n        '\\n',\n      ];\n    }, [] as string[]);\n\n  const filters: { [key: string]: string } = {};\n  const queryChunks: string[] = [];\n\n  let position = 0;\n  const elements = sections.map((quoted_section, index) => {\n    const section = query.slice(position, position + quoted_section.length);\n    position += quoted_section.length;\n\n    const equalPosition = section.indexOf('=');\n    const isKeyPair =\n      equalPosition > -1 && section[0] !== '=' && section.slice(-1)[0] !== '=';\n    const isNewline = section === '\\n';\n\n    if (isNewline) {\n      return <br key={index} />;\n    }\n    if (!isKeyPair) {\n      queryChunks.push(section);\n      return (\n        <span key={index} className=\"text\">\n          {section}\n        </span>\n      );\n    }\n\n    const pairKey = section.split('=')[0].trim();\n    if (\n      isKeyPair &&\n      queryFields.indexOf(pairKey) === -1 &&\n      !(pairKey.startsWith('user.') || pairKey.startsWith('user['))\n    ) {\n      return (\n        <span key={index}>\n          <span className=\"invalid_pair\">{section}</span>\n        </span>\n      );\n    }\n\n    const [key, value] = section.split('=');\n    try {\n      filters[key.trim()] = JSON.parse(value);\n    } catch (err) {\n      filters[key.trim()] = value;\n    }\n    return (\n      <span key={index}>\n        <span className=\"key\">{key}=</span>\n        <span className=\"value\">{value}</span>\n      </span>\n    );\n  });\n\n  const search = [\n    filters.search,\n    queryChunks\n      .filter(v => v)\n      .join(' ')\n      .trim(),\n  ]\n    .filter(v => v)\n    .join(' ');\n\n  if (search.length) filters.search = search;\n\n  return {\n    elements,\n    filters,\n  };\n}\n\ninterface Props {\n  query: string;\n  setQuery: (query: string) => void;\n  compiledGetters: CompiledGetterCache;\n}\n\nexport const QueryBar: React.FC<Props> = ({ query, setQuery }) => {\n  const [temporaryQuery, setTemporaryQuery] = useState('');\n\n  useEffect(() => {\n    setTemporaryQuery(query);\n  }, [query]);\n\n  const parsedQuery = parseQuery(temporaryQuery);\n\n  return (\n    <div className=\"QueryBar\">\n      <div className=\"QueryBar-render\">{parsedQuery.elements}</div>\n      <textarea\n        rows={1}\n        className=\"QueryBar-input\"\n        spellCheck={false}\n        value={temporaryQuery}\n        onChange={e => setTemporaryQuery((e.target as any).value)}\n        placeholder=\"Filter or search logs...\"\n      ></textarea>\n      <div className=\"QueryBar-actions\">\n        <Button\n          unelevated\n          onClick={() => setQuery(temporaryQuery)}\n          disabled={query === temporaryQuery}\n        >\n          Apply\n        </Button>\n        <Button\n          unelevated\n          disabled={!temporaryQuery.length}\n          onClick={() => {\n            setTemporaryQuery('');\n            setQuery('');\n          }}\n        >\n          Reset\n        </Button>\n      </div>\n    </div>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EmulatorConfig } from '../../store/config';\n\nexport enum WebSocketState {\n  DISCONNECTED,\n  CONNECTED,\n  PENDING,\n}\n\nexport class ReconnectingWebSocket {\n  state: WebSocketState = WebSocketState.DISCONNECTED;\n  listener: Function | undefined = undefined;\n  interval: number | undefined = undefined;\n  ws: WebSocket | undefined = undefined;\n\n  constructor(config: EmulatorConfig) {\n    this.connect(config);\n    // XXX: The Node.js typings for setInterval is leaking in, which causes the\n    // function to be typed to return NodeJS.Timeout and thus the as-any cast.\n    // TODO: Remove Node.js typings from source files for the web.\n    this.interval = setInterval(() => this.connect(config), 1000) as any;\n  }\n\n  private connect(config: EmulatorConfig) {\n    if (this.state !== WebSocketState.DISCONNECTED) return;\n\n    const ws = new WebSocket(`ws://${config.hostAndPort}`);\n    this.ws = ws;\n    this.state = WebSocketState.PENDING;\n\n    ws.onopen = () => {\n      this.state = WebSocketState.CONNECTED;\n    };\n\n    ws.onclose = () => {\n      this.state = WebSocketState.DISCONNECTED;\n    };\n\n    ws.onmessage = msg => {\n      const data = JSON.parse(msg.data);\n      this.listener && this.listener(data);\n    };\n  }\n\n  cleanup() {\n    this.listener = undefined;\n    if (this.interval) clearInterval(this.interval);\n    if (this.ws) this.ws.close();\n    this.ws = undefined;\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './History.scss';\n\nimport { ThemeProvider } from '@rmwc/theme';\nimport React, { useEffect, useRef } from 'react';\nimport { connect } from 'react-redux';\n\nimport { grey100 } from '../../colors';\nimport { AppState } from '../../store';\nimport { LogEntry, LogState } from '../../store/logviewer';\nimport { CompiledGetterCache } from './CompiledGetterCache';\nimport { HighlightedJSON } from './HighlightedJSON';\nimport { ParsedQuery, filtersToQueryString, isQueryMatch } from './QueryBar';\n\nconst formatTimestamp = (timestamp: number) => {\n  const date = new Date(timestamp);\n  const segments = [date.getHours(), date.getMinutes(), date.getSeconds()];\n\n  return segments\n    .map(segment => {\n      const number = segment.toString();\n\n      if (number.length === 2) return number;\n      else return `0${number}`;\n    })\n    .join(':');\n};\n\nconst FilterTag: React.FC<{ appendToQuery: Function; log: LogEntry }> = ({\n  appendToQuery,\n  log,\n}) => {\n  const metadata = log.data.metadata;\n  let tagButton;\n\n  if (metadata?.function?.name) {\n    tagButton = (\n      <div\n        className=\"log-tag-button\"\n        onClick={() =>\n          appendToQuery('metadata.function.name', metadata.function?.name)\n        }\n      >\n        function[{metadata.function.name}]\n      </div>\n    );\n  } else if (metadata?.emulator?.name) {\n    tagButton = (\n      <div\n        className=\"log-tag-button\"\n        onClick={() =>\n          appendToQuery('metadata.emulator.name', metadata.emulator?.name)\n        }\n      >\n        {metadata.emulator.name}\n      </div>\n    );\n  }\n\n  return <div className=\"log-tag\">{tagButton}</div>;\n};\n\ninterface PropsFromAttributes {\n  parsedQuery: ParsedQuery;\n  setQuery: (query: string) => void;\n  compiledGetters: CompiledGetterCache;\n}\n\ninterface PropsFromState {\n  log: LogState;\n}\n\ntype Props = PropsFromState & PropsFromAttributes;\n\nconst MAX_LOG_LINES = 100;\n\nexport const History: React.FC<Props> = ({\n  parsedQuery,\n  setQuery,\n  log,\n  compiledGetters,\n}) => {\n  const history = log.history.filter(log =>\n    isQueryMatch(parsedQuery, log, compiledGetters)\n  );\n\n  const messagesEndRef = useRef(null);\n\n  const scrollToBottom = () => {\n    if (messagesEndRef && messagesEndRef.current) {\n      (messagesEndRef.current as any).scrollIntoView();\n    }\n  };\n\n  useEffect(scrollToBottom, [history]);\n\n  const appendToQuery = (key: string, value: string) => {\n    setQuery(filtersToQueryString({ ...parsedQuery.filters, [key]: value }));\n  };\n\n  const getUserData = (log: LogEntry) =>\n    log?.data?.user && Object.keys(log?.data?.user).length;\n\n  return (\n    <ThemeProvider options={{ surface: grey100 }} className=\"LogHistory\">\n      {history.length ? (\n        history.slice(-MAX_LOG_LINES).map((log, index) => (\n          <div id={`log_${index}`} className=\"log-entry\" key={index}>\n            <span className=\"log-timestamp\">\n              {formatTimestamp(log.timestamp)}\n            </span>\n            <span\n              className={`log-level ${log.level}`}\n              onClick={() => appendToQuery('level', log.level)}\n            >\n              {log.level[0].toUpperCase()}\n            </span>\n            <FilterTag appendToQuery={appendToQuery} log={log} />\n            {getUserData(log) ? (\n              <HighlightedJSON\n                data={log.data.user}\n                appendToQuery={appendToQuery}\n                compiledGetters={compiledGetters}\n              />\n            ) : (\n              <div className=\"log-message-single\">{log.message}</div>\n            )}\n          </div>\n        ))\n      ) : (\n        <div className=\"LogHistoryEmpty\">\n          No logs are found which match your filters.\n        </div>\n      )}\n      <div ref={messagesEndRef} />\n    </ThemeProvider>\n  );\n};\n\nexport const mapStateToProps = ({ log }: AppState) => ({ log });\nexport const mapDispatchToProps = {};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(History);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Card } from '@rmwc/card';\nimport { Elevation } from '@rmwc/elevation';\nimport { GridCell } from '@rmwc/grid';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { useLocation } from 'react-router-dom';\n\nimport { AppState } from '../../store';\nimport { LoggingConfig } from '../../store/config';\nimport {\n  LogEntry,\n  LogState,\n  logReceived,\n  logReset,\n} from '../../store/logviewer';\nimport { hasData } from '../../store/utils';\nimport { CompiledGetterCache } from './CompiledGetterCache';\nimport History from './History';\nimport { QueryBar, parseQuery } from './QueryBar';\nimport { ReconnectingWebSocket } from './ReconnectingWebSocket';\n\ninterface PropsFromState {\n  log: LogState;\n  config?: LoggingConfig;\n}\n\ninterface PropsFromDispatch {\n  logReceived: Function;\n  logReset: () => void;\n}\n\nexport type Props = PropsFromState & PropsFromDispatch;\n\nconst compiledGetters = new CompiledGetterCache();\n\nfunction useQuery() {\n  const { search } = useLocation();\n  return useMemo(() => new URLSearchParams(search), [search]);\n}\n\nexport const LogViewer: React.FC<Props> = ({\n  logReceived,\n  logReset,\n  config,\n}) => {\n  const qs = useQuery();\n  const [query, setQuery] = useState(qs.get('q') || '');\n\n  useEffect(() => {\n    if (!config) return;\n\n    logReset();\n    const webSocket = new ReconnectingWebSocket(config);\n    webSocket.listener = (log: LogEntry) => {\n      logReceived(log);\n    };\n    return () => webSocket.cleanup();\n  }, [config, logReceived, logReset]);\n\n  const parsedQuery = parseQuery(query);\n\n  return (\n    <GridCell span={12}>\n      <Elevation z={2} wrap>\n        <Card className=\"LogViewer\">\n          <QueryBar\n            query={query}\n            setQuery={setQuery}\n            compiledGetters={compiledGetters}\n          />\n          <History\n            parsedQuery={parsedQuery}\n            setQuery={setQuery}\n            compiledGetters={compiledGetters}\n          />\n        </Card>\n      </Elevation>\n    </GridCell>\n  );\n};\n\nexport const mapStateToProps = ({ config }: AppState) => {\n  return {\n    config: hasData(config.result) ? config.result.data.logging : undefined,\n  };\n};\nexport const mapDispatchToProps = {\n  logReceived,\n  logReset,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(LogViewer);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Database from './components/Database';\nimport Firestore from './components/Firestore';\nimport Home from './components/Home';\nimport LogsViewer from './components/LogViewer';\n\nexport interface Route {\n  path: string;\n  component: React.FC;\n  label: string;\n  exact: boolean;\n  showInNav: boolean;\n}\n\nexport const routes: ReadonlyArray<Route> = [\n  {\n    path: '/',\n    component: Home,\n    label: 'Overview',\n    exact: true,\n    showInNav: true,\n  },\n  {\n    path: '/firestore',\n    component: Firestore,\n    label: 'Firestore',\n    exact: false,\n    showInNav: true,\n  },\n  {\n    path: '/database',\n    component: Database,\n    label: 'Realtime Database',\n    exact: false,\n    showInNav: true,\n  },\n  {\n    path: '/logs',\n    component: LogsViewer as any,\n    label: 'Logs',\n    exact: true,\n    showInNav: true,\n  },\n];\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon } from '@rmwc/icon';\nimport React from 'react';\n\nexport const Logo: React.FC = () => (\n  <Icon\n    className=\"Logo\"\n    icon={{\n      strategy: 'component',\n      icon: (\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 0 192 192\"\n          style={{ width: '24px', height: '24px' }}\n        >\n          <defs>\n            <clipPath id=\"a\">\n              <path d=\"M143.41 47.34a4 4 0 0 0-6.77-2.16L115.88 66 99.54 34.89a4 4 0 0 0-7.08 0l-8.93 17-22.4-41.77a4 4 0 0 0-7.48 1.28L32 150l57.9 32.46a12 12 0 0 0 11.7 0L160 150z\" />\n            </clipPath>\n            <linearGradient\n              id=\"d\"\n              x1=\"-108.63\"\n              y1=\"-692.24\"\n              x2=\"-58.56\"\n              y2=\"-742.31\"\n              gradientTransform=\"matrix(2.67 0 0 -2.67 317.23 -1808)\"\n              gradientUnits=\"userSpaceOnUse\"\n            >\n              <stop offset=\"0\" stopColor=\"#fff\" stopOpacity=\".1\" />\n              <stop offset=\"1\" stopColor=\"#fff\" stopOpacity=\"0\" />\n            </linearGradient>\n            <linearGradient\n              id=\"b\"\n              x1=\"56.9\"\n              y1=\"102.54\"\n              x2=\"48.9\"\n              y2=\"98.36\"\n              gradientUnits=\"userSpaceOnUse\"\n            >\n              <stop offset=\"0\" stopColor=\"#a52714\" />\n              <stop offset=\".4\" stopColor=\"#a52714\" stopOpacity=\".5\" />\n              <stop offset=\".8\" stopColor=\"#a52714\" stopOpacity=\"0\" />\n            </linearGradient>\n            <linearGradient\n              id=\"c\"\n              x1=\"90.89\"\n              y1=\"90.91\"\n              x2=\"87.31\"\n              y2=\"87.33\"\n              gradientUnits=\"userSpaceOnUse\"\n            >\n              <stop offset=\"0\" stopColor=\"#a52714\" stopOpacity=\".8\" />\n              <stop offset=\".5\" stopColor=\"#a52714\" stopOpacity=\".21\" />\n              <stop offset=\"1\" stopColor=\"#a52714\" stopOpacity=\"0\" />\n            </linearGradient>\n          </defs>\n          <g clipPath=\"url(#a)\">\n            <path\n              d=\"M32 150L53.66 11.39a4 4 0 0 1 7.48-1.27l22.4 41.78 8.93-17a4 4 0 0 1 7.08 0L160 150z\"\n              fill=\"#ffa000\"\n            />\n            <path\n              opacity=\".12\"\n              fill=\"url(#b)\"\n              d=\"M106 9L0 0v192l32-42L106 9z\"\n            />\n            <path\n              d=\"M106.83 96.01l-23.3-44.12L32 150l74.83-53.99z\"\n              fill=\"#f57c00\"\n            />\n            <path opacity=\".2\" fill=\"url(#c)\" d=\"M0 0h192v192H0z\" />\n            <path\n              d=\"M160 150L143.41 47.34a4 4 0 0 0-6.77-2.16L32 150l57.9 32.47a12 12 0 0 0 11.7 0z\"\n              fill=\"#ffca28\"\n            />\n            <path\n              d=\"M143.41 47.34a4 4 0 0 0-6.77-2.16L115.88 66 99.54 34.89a4 4 0 0 0-7.08 0l-8.93 17-22.4-41.77a4 4 0 0 0-7.48 1.28L32 150h-.08l.07.08.57.28L115.83 67l20.78-20.8a4 4 0 0 1 6.78 2.16l16.45 101.74.16-.1zM32.19 149.81L53.66 12.39a4 4 0 0 1 7.48-1.28l22.4 41.78 8.93-17a4 4 0 0 1 7.08 0l16 30.43z\"\n              fill=\"#fff\"\n              fillOpacity=\".2\"\n            />\n            <path\n              d=\"M101.6 181.49a12 12 0 0 1-11.7 0l-57.76-32.4-.14.91 57.9 32.46a12 12 0 0 0 11.7 0L160 150l-.15-.92z\"\n              // style=\"isolation:isolate\"\n              fill=\"#a52714\"\n              opacity=\".2\"\n            />\n            <path\n              d=\"M143.41 47.34a4 4 0 0 0-6.77-2.16L115.88 66 99.54 34.89a4 4 0 0 0-7.08 0l-8.93 17-22.4-41.77a4 4 0 0 0-7.48 1.28L32 150l57.9 32.46a12 12 0 0 0 11.7 0L160 150z\"\n              fill=\"url(#d)\"\n            />\n          </g>\n        </svg>\n      ),\n    }}\n  />\n);\n\nexport default Logo;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './AppBar.scss';\n\nimport { Tab, TabBar } from '@rmwc/tabs';\nimport { ThemeProvider } from '@rmwc/theme';\nimport { TopAppBar } from '@rmwc/top-app-bar';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { Link, matchPath, useLocation } from 'react-router-dom';\n\nimport { navBarOnSurface, navBarPrimary, navBarSurface } from '../../colors';\nimport { Route } from '../../routes';\nimport Logo from '../common/Logo';\n\ntype Props = {\n  routes: ReadonlyArray<Route>;\n};\n\nexport const AppBar: React.FC<Props> = ({ routes }) => {\n  let location = useLocation();\n\n  const navRoutes = routes.filter(r => r.showInNav);\n\n  const tabs = navRoutes.map(({ path, label }: Route) => (\n    <Tab\n      key={label}\n      className=\"mdc-tab--min-width\"\n      {...{ tag: Link, to: path }}\n    >\n      {label}\n    </Tab>\n  ));\n\n  const activeTabIndex = navRoutes.findIndex(r =>\n    matchPath(location.pathname, {\n      path: r.path,\n      exact: r.exact,\n    })\n  );\n\n  return (\n    <ThemeProvider\n      options={{\n        primary: navBarPrimary,\n        surface: navBarSurface,\n        onSurface: navBarOnSurface,\n      }}\n      wrap\n    >\n      <TopAppBar fixed className=\"AppBar\" theme=\"surface\">\n        <div className=\"AppBar-title-row\">\n          <div className=\"AppBar-logo-lockup\">\n            <Logo />\n            <Typography use=\"headline5\" className=\"AppBar-title\" tag=\"h1\">\n              Firebase Emulator Suite\n            </Typography>\n          </div>\n        </div>\n        <TabBar theme=\"onSurface\" activeTabIndex={activeTabIndex}>\n          {tabs}\n        </TabBar>\n      </TopAppBar>\n    </ThemeProvider>\n  );\n};\n\nexport default AppBar;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dialog, DialogContent, DialogTitle } from '@rmwc/dialog';\nimport React from 'react';\nimport { connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../store';\nimport { getConfig } from '../../store/config/selectors';\nimport { hasError } from '../../store/utils';\n\nexport const mapStateToProps = createStructuredSelector({\n  configRemote: getConfig,\n});\n\nexport type PropsFromState = ReturnType<typeof mapStateToProps>;\n\nexport const AppDisconnected: React.FC<PropsFromState> = ({ configRemote }) => {\n  if (!hasError(configRemote.result)) {\n    return null;\n  }\n\n  return (\n    <Dialog open preventOutsideDismiss>\n      <DialogTitle>Emulator Suite Disconnected</DialogTitle>\n      <DialogContent>\n        All emulators for this project have stopped running. To restart all\n        emulators, at the command line, run{' '}\n        <code>firebase emulators:start</code>.\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default connect(mapStateToProps)(AppDisconnected);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Portal } from '@rmwc/base';\nimport { DialogQueue } from '@rmwc/dialog';\nimport { Grid } from '@rmwc/grid';\nimport { Theme } from '@rmwc/theme';\nimport React from 'react';\nimport { Redirect, Route, Switch } from 'react-router-dom';\n\nimport { routes } from '../../routes';\nimport { dialogs } from '../common/DialogQueue';\nimport AppBar from './AppBar';\nimport AppDisconnected from './AppDisconnected';\n\nconst App: React.FC = () => {\n  return (\n    <>\n      <DialogQueue dialogs={dialogs} />\n      <Portal />\n      <AppDisconnected />\n      <Theme use=\"background\" wrap>\n        <div className=\"App\">\n          <AppBar routes={routes} />\n          <Grid className=\"App-main\">\n            <Switch>\n              {routes.map(r => (\n                <Route\n                  key={r.path}\n                  path={r.path}\n                  component={r.component}\n                  exact={r.exact}\n                />\n              ))}\n              <Redirect\n                from=\"/functions\"\n                to=\"/logs?q=metadata.emulator.name%3D%22functions%22\"\n              />\n              <Redirect to=\"/\" /> {/* Fallback to redirect to overview. */}\n            </Switch>\n          </Grid>\n        </div>\n      </Theme>\n    </>\n  );\n};\n\nexport default App;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport '@rmwc/tooltip/tooltip.css';\n\n// General + library styling. Should come before all local imports to allow\n// local styling to override them.\nimport './index.scss';\n\nimport { RMWCProvider } from '@rmwc/provider';\nimport { ThemeProvider } from '@rmwc/theme';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { BrowserRouter, Route, Switch } from 'react-router-dom';\n\nimport { background, primary, secondary } from './colors';\nimport App from './components/App';\nimport configureStore from './configureStore';\nimport { subscribe as subscribeToConfig } from './store/config';\nimport { error } from './themes';\n\nconst store = configureStore();\n\nconst RouterWithInit = () => {\n  useEffect(() => {\n    store.dispatch(subscribeToConfig());\n  }, []); // Empty-array means \"run only once on init\": https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects\n  return (\n    <BrowserRouter>\n      <Switch>\n        <Route component={App} />\n      </Switch>\n    </BrowserRouter>\n  );\n};\n\nReactDOM.render(\n  <React.StrictMode>\n    <RMWCProvider\n      // Globally disable ripples\n      ripple={false}\n    >\n      <ThemeProvider\n        options={{\n          background,\n          primary,\n          primaryRgb: '104, 29, 168',\n          secondary,\n          error,\n        }}\n      >\n        <Provider store={store}>\n          <RouterWithInit />\n        </Provider>\n      </ThemeProvider>\n    </RMWCProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Store, applyMiddleware, compose, createStore } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\n\nimport { AppState, rootReducer, rootSaga } from './store';\n\nexport default function configureStore(): Store<AppState> {\n  const composeEnhancers =\n    (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n  const sagaMiddleware = createSagaMiddleware();\n  const store = createStore(\n    rootReducer,\n    composeEnhancers(applyMiddleware(sagaMiddleware))\n  );\n  sagaMiddleware.run(rootSaga);\n  return store;\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"panel\":\"CollectionFilter_panel__3z15Z\",\"header\":\"CollectionFilter_header__1-t0U\",\"headerTitle\":\"CollectionFilter_headerTitle__ebNNW\",\"preview\":\"CollectionFilter_preview__1TWpW\",\"children\":\"CollectionFilter_children__l7ZC9\",\"previewFilter\":\"CollectionFilter_previewFilter__eDMkO\",\"conditionEntries\":\"CollectionFilter_conditionEntries__2CpLn\",\"removeFilter\":\"CollectionFilter_removeFilter__1xNn1\",\"hidden\":\"CollectionFilter_hidden__IoL4U\",\"conditionEntry\":\"CollectionFilter_conditionEntry__xeuMd\",\"conditionEntryType\":\"CollectionFilter_conditionEntryType__3jxWW\",\"conditionEntryValue\":\"CollectionFilter_conditionEntryValue__3N83N\",\"actions\":\"CollectionFilter_actions__1uD4j\"};","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createAction } from 'typesafe-actions';\n\nimport { DatabaseInfo } from './types';\n\nexport const databasesFetchRequest = createAction(\n  '@database/DATABASES_FETCH_REQUEST'\n)();\n\nexport const databasesFetchSuccess = createAction(\n  '@database/DATABASES_FETCH_SUCCESS'\n)<DatabaseInfo[]>();\n\nexport const databasesFetchError = createAction(\n  '@database/DATABASES_FETCH_ERROR'\n)<{ message: string }>();\n\nexport const databasesSubscribe = createAction(\n  '@database/DATABASES_SUBSCRIBE'\n)();\n\nexport const databasesUnsubscribe = createAction(\n  '@database/DATABASES_UNSUBSCRIBE'\n)();\n","import { createSelector } from 'reselect';\n\nimport { map } from '../utils';\nimport { AppState } from '..';\n\n// Get the RemoteResult wrapper for config. If you only care about result,\n// use getConfigResult instead for better caching.\nexport const getConfig = (state: AppState) => state.config;\n\nexport const getConfigResult = (state: AppState) => state.config.result;\n\n// Get whether config is being loaded / refreshed. Note: To check whether config\n// is present, use getConfigResult. This only tells whether we're fetching.\nexport const getConfigLoading = (state: AppState) => state.config.loading;\n\nexport const getProjectIdResult = createSelector(getConfigResult, result =>\n  map(result, config => config.projectId)\n);\n\nexport const getDatabaseConfigResult = createSelector(getConfigResult, result =>\n  map(result, config => config.database)\n);\n\nexport const getFirestoreConfigResult = createSelector(\n  getConfigResult,\n  result => map(result, config => config.firestore)\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createAction } from 'typesafe-actions';\n\nimport { Config } from './types';\n\nexport const fetchRequest = createAction('@config/FETCH_REQUEST')();\nexport const fetchSuccess = createAction('@config/FETCH_SUCCESS')<Config>();\nexport const fetchError = createAction('@config/FETCH_ERROR')<{\n  message: string;\n}>();\n\nexport const subscribe = createAction('@config/SUBSCRIBE')();\n"],"sourceRoot":""}